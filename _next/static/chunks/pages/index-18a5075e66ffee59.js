(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{9865:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(8022)}])},8022:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>t3});var r,a=n(1085),i=n(4041),o={prime:"#555",secondary:"#999",highlight:"#9cedff",button:function(e){return e?"#333":"#999"},background:"#EEE",notes:"#5596a5",notesSelected:"#03A9F4",notesBackground:"#33c8d3",black:"#1A1A1A",critical:"red"},c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},s={button:{fontSize:"10px",outline:"none",background:"none",border:"none",cursor:"pointer",textTransform:"capitalize",display:"block",color:"white",padding:"2px",userSelect:"none"}},l=function(e){var t=e.name,n=e.active,r=e.onClick;return i.createElement("button",{style:c(c({},s.button),{color:o.button(n)}),onClick:r},t)},u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},d={piano:"3d2ba839-ed91-4da5-a02a-01585af6ee4d",clap1:"7dc84f88-9742-417c-bff3-ccd679f145f3",clap2:"7ec4f35f-e1f2-4659-9d6a-b548a0bdad35",clapFast:"5b7aedf0-e12b-40cd-8a73-e296f9aa7181",bass:"ffb50873-e996-4a48-9753-ab5a3899975a",kick:"469e3b68-d1dc-43d0-bd48-da16859ef3e9"},f=function(e){return e.map(function(e){return u(u({},e),{id:crypto.randomUUID(),note:e.id})})},p={prelude:"6931e27b-7266-4116-8480-72d47cb41df0",pluck:"a0fbbda3-1b94-4299-bcb4-89da15809e88",razor:"cc264e6f-76c0-436d-a360-3f9561e7f6d6",wind:"9b1ac378-fe1e-4828-8bd9-a1ab35424ec6",kick:"fdfad340-fdce-46fe-9c9b-a619d4ce7676",bass:"85333e85-2d1c-4b0b-92a2-9de913938b13",clap:"5dc41231-d398-4b49-b785-331023a923aa"},h=function(e){return Object.fromEntries(e.map(function(e){return[e.id,e]}))},m=function(){return(m=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},v=function(){var e={midiRefs:[{id:"9b33ebf4-e5b1-4e7f-bd11-6f0c916af9cb",trackId:0,start:512,end:1024,fragmentId:d.piano},{id:"fdd3f656-653c-4102-892e-4e780d2a511d",trackId:1,start:256,end:1024,fragmentId:d.bass},{id:"b664267b-2ccf-46d7-b728-316418c78bb9",trackId:2,start:0,end:1024,fragmentId:d.kick},{id:"d5258d2b-ebee-4d2a-aab1-c7a535859860",trackId:3,start:128,end:192,fragmentId:d.clap1},{id:"a18324c7-6b3b-48ff-88c6-8b4e455a76b2",trackId:3,start:192,end:256,fragmentId:d.clapFast},{id:"99b389f2-f03a-46b7-b07b-c57e509d4220",trackId:3,start:384,end:448,fragmentId:d.clap2},{id:"0b828d85-dab7-4f43-a6e1-915c678b0d33",trackId:3,start:448,end:512,fragmentId:d.clapFast},{id:"5bbe46ba-2d91-4c62-98e4-c362dc667116",trackId:3,start:768,end:960,fragmentId:d.clap2},{id:"03451cec-a9fa-455e-9606-1d3f1935b1e4",trackId:3,start:960,end:1024,fragmentId:d.clapFast}],tracks:[{name:"Piano",presetId:p.pluck,gain:.4},{name:"Bass",presetId:p.bass,gain:.3},{name:"Kick",presetId:p.kick,gain:1},{name:"Clap",presetId:p.clap,gain:.3}],midiFragments:h([{id:d.piano,name:"Piano",loop:[0,256],notes:f([{length:32,id:"F#2",at:0},{length:32,id:"A#1",at:0},{length:32,id:"F#2",at:32},{length:32,id:"A#1",at:32},{length:32,id:"D#2",at:64},{length:32,id:"C#1",at:64},{length:32,id:"D#2",at:96},{length:32,id:"F#1",at:96},{length:32,id:"F#3",at:128},{length:32,id:"A#2",at:128},{length:32,id:"F#3",at:160},{length:32,id:"A#2",at:160},{length:32,id:"D#3",at:192},{length:32,id:"C#2",at:192},{length:32,id:"D#3",at:224},{length:32,id:"F#2",at:224}])},{id:d.bass,name:"Bass",loop:[0,128],notes:f([{length:4,id:"A#1",at:6},{length:4,id:"A#1",at:12},{length:4,id:"A#1",at:20},{length:4,id:"A#1",at:36},{length:4,id:"A#1",at:44},{length:4,id:"A#1",at:52},{length:4,id:"C#2",at:70},{length:4,id:"C#2",at:76},{length:4,id:"C#2",at:84},{length:4,id:"G#1",at:92},{length:4,id:"F#2",at:100},{length:4,id:"F#2",at:108},{length:4,id:"F#2",at:116},{length:4,id:"D#2",at:124}])},{id:d.clap1,name:"Clap 1",loop:[32,64],notes:f([{length:4,id:"C#1",at:44},{length:4,id:"C#1",at:56}])},{id:d.clapFast,name:"Clap Fast",loop:[0,64],notes:f([{length:2,id:"C#1",at:0},{length:2,id:"C#1",at:4},{length:2,id:"C#1",at:8},{length:2,id:"C#1",at:12},{length:2,id:"C#1",at:16},{length:2,id:"C#1",at:20},{length:2,id:"C#1",at:24},{length:2,id:"C#1",at:28},{length:2,id:"C#1",at:32},{length:2,id:"C#1",at:36},{length:2,id:"C#1",at:40},{length:2,id:"C#1",at:42},{length:2,id:"C#1",at:44},{length:2,id:"C#1",at:46},{length:2,id:"C#1",at:48},{length:2,id:"C#1",at:50},{length:2,id:"C#1",at:52},{length:2,id:"C#1",at:54},{length:2,id:"C#1",at:56},{length:2,id:"C#1",at:58},{length:2,id:"C#1",at:60},{length:2,id:"C#1",at:62}])},{id:d.clap2,name:"Clap 2",loop:[0,32],notes:f([{length:4,id:"C#1",at:4},{length:4,id:"C#1",at:12},{length:4,id:"C#1",at:18},{length:4,id:"C#1",at:24}])},{id:d.kick,name:"Kick",loop:[0,32],notes:f([{length:4,id:"C#1",at:0},{length:4,id:"C#1",at:8},{length:4,id:"C#1",at:16},{length:4,id:"C#1",at:24}])}]),presets:h([{id:p.prelude,name:"prelude",wave:{sine:.2,square:1,saw:1,saw2:1,tech:0,noise:0,fm:0,fmFreq:0,offset:.75,voices:12,octave:1},envelopes:{filter:{attack:0,decay:.4,sustain:.08,release:.1},gain:{attack:0,decay:.05,sustain:.5,release:.3}},filter:{cutoff:.35,resonance:.2,envelope:.6,enabled:!1},sequence:{enabled:!1}},{id:p.pluck,name:"pluck",wave:{sine:1,square:0,saw:.6,saw2:0,tech:.3,noise:0,fm:0,fmFreq:0,offset:0,voices:1,octave:1},envelopes:{filter:{attack:0,decay:.2,sustain:.2,release:.3},gain:{attack:0,decay:.385,sustain:.185,release:.7}},filter:{cutoff:.15,resonance:.3,envelope:.5,enabled:!0},sequence:{enabled:!0,0:[1],2:[2],6:[1],12:[2],13:[3],14:[1]}},{id:p.razor,name:"razor",wave:{sine:1,square:0,saw:0,saw2:.125,tech:1,noise:0,fm:.7,fmFreq:.53125,offset:0,voices:3,octave:0},envelopes:{filter:{attack:0,decay:.4,sustain:.08,release:.1},gain:{attack:0,decay:.2,sustain:1,release:.05}},filter:{enabled:!1,cutoff:.5,resonance:.2,envelope:.6},sequence:{enabled:!1,0:[3],1:[1],3:[3],4:[1],6:[3],7:[1],9:[1],11:[1],12:[1],14:[3]}},{id:p.wind,name:"wind",wave:{sine:1,square:.1,saw:.4,saw2:.125,tech:0,noise:0,fm:0,fmFreq:0,offset:.5,voices:1,octave:0},envelopes:{filter:{attack:.7,decay:.7,sustain:.08,release:.1},gain:{attack:.2,decay:.2,sustain:1,release:.3}},filter:{cutoff:.5,resonance:.2,envelope:.6,enabled:!0},sequence:{enabled:!1}},{id:p.kick,name:"kick",wave:{sine:1,square:.1,saw:.2,saw2:0,tech:0,noise:.5,fm:0,fmFreq:0,offset:.5,voices:1,octave:0},envelopes:{filter:{attack:0,decay:.05,sustain:0,release:0},gain:{attack:0,decay:.3,sustain:.1,release:.2}},filter:{cutoff:.1,resonance:.6,envelope:.8,enabled:!0},sequence:{enabled:!1}},{id:p.bass,name:"bass",wave:{sine:1,square:0,saw:0,saw2:.125,tech:1,noise:0,fm:.7,fmFreq:.53125,offset:0,voices:3,octave:0},envelopes:{filter:{attack:0,decay:.5,sustain:.08,release:.1},gain:{attack:0,decay:.6,sustain:.8,release:.1}},filter:{enabled:!0,cutoff:.1,resonance:.3,envelope:.3},sequence:{enabled:!1}},{id:p.clap,name:"clap",wave:{sine:0,square:0,saw:0,saw2:0,tech:0,noise:.2,fm:0,fmFreq:0,offset:0,voices:1,octave:0},envelopes:{filter:{attack:0,decay:.4,sustain:.08,release:.1},gain:{attack:0,decay:.2,sustain:0,release:0}},filter:{cutoff:.5,resonance:.2,envelope:.6,enabled:!1},sequence:{enabled:!1}}]),bpm:120};return m(m({},e),{currentTrack:0,currentFragment:Object.keys(e.midiFragments)[0]})},g=function(){return(g=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},y=(0,i.createContext)(g(g({},v()),{time:0,isPlaying:!1,dispatch:function(){},keyboard:{startNote:function(){},endNote:function(){}}})),E=function(){return(E=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},k=function(e,t){var n,r=t.row,a=t.column,i=null!==(n=e[a])&&void 0!==n?n:[];e[a]=i;var o=i.indexOf(r);return -1===o?i.push(r):i.splice(o,1),E({},e)},x=function(){return(x=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},b=function(){var e=i.useContext(y),t=e.presets,n=e.currentTrack,r=e.tracks,a=e.dispatch,o=r[n].presetId,c=t[o],s=Object.values(t).map(function(e){var t=e.id;return{id:t,name:e.name,active:t===o,onclick:function(){return a({type:"PRESET/ASSIGN_TO_TRACK",trackId:n,presetId:t})}}});return x(x({},c),{options:s,setWave:function(e,t){return a({trackId:n,presetId:o,type:"PRESET/SET_WAVE",id:e,payload:t})},setFilter:function(e,t){return a({trackId:n,presetId:o,type:"PRESET/SET_FILTER",id:e,payload:t})},toggleARP:function(e){return a({trackId:n,presetId:o,type:"PRESET/SET_SEQUENCE",payload:k(c.sequence,e)})},setEnvelope:function(e){return function(t){return a({trackId:n,presetId:o,type:"PRESET/SET_ENVELOPE",id:e,payload:t})}},getModule:function(e){return{disabled:!c[e].enabled,toggle:function(){return a({trackId:n,presetId:o,type:"PRESET/TOGGLE_MODULE",id:e})}}},newPreset:function(){return a({type:"PRESET/NEW_PRESET",trackId:n})}})},w=function(){var e=b(),t=e.envelopes,n=e.setEnvelope,r=i.useState("gain"),a=r[0],o=r[1],c=Object.keys(t).map(function(e){return{name:e,active:e===a,onclick:function(){return o(e)}}});return{id:a,current:t[a],options:c,setFields:n(a)}},S=function(e){var t=e.color,n=e.width,r=e.height,a="waveGridBig",o="waveGridSmall";return i.createElement(i.Fragment,null,i.createElement("defs",null,i.createElement("pattern",{width:"100",height:"100",patternUnits:"userSpaceOnUse",id:a},i.createElement("g",{stroke:void 0===t?"#FFEB3B":t,fill:"none",strokeWidth:.3,strokeOpacity:.3},i.createElement("pattern",{width:"10",height:"10",patternUnits:"userSpaceOnUse",id:o},i.createElement("path",{strokeWidth:.3,d:"M 10 0 L 0 0 0 10 0 0"})),i.createElement("path",{d:"M 100 0 L 0 0 0 100 0 0"}),i.createElement("rect",{width:"100",height:"100",fill:"url(#".concat(o,")")})))),i.createElement("rect",{width:void 0===n?"100%":n,height:void 0===r?"100%":r,fill:"url(#".concat(a,")")}))},T=n(6721),M=function(e){return Math.min(Math.max(e,0),1)},C=function(e){return Math.max(0,e)},I=function(e,t){var n=t[0];return Math.floor(n+e*(t[1]-n))},R=function(e){var t=e.onClick,n=e.point,r=n.x,a=n.y;return i.createElement("circle",{cx:r,cy:a,onTouchStart:t,onMouseDown:t,r:5,style:{cursor:"grabbing"}})},A=function(e){var t=e.end,n=e.move,r=(0,T.wu)(),a=(0,i.useState)(),o=a[0],c=a[1];return(0,i.useEffect)(function(){if(o){var e=function(e){return n(r(e),o)},a=function(){null==t||t(o),c(void 0)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",a),function(){document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",a)}}},[o]),c},P=function(){return(P=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},O=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)0>t.indexOf(r[a])&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n},F=function(e){var t=e.height,n=e.width,r=e.controlers,a=e.children,c=e.onMove,s=A({move:function(e,r){var a=e.x,i=e.y;return c(r,{x:M(a/n),y:M(1-i/t)})}}),l=r.map(function(e){var r=e.x,a=e.y,i=O(e,["x","y"]);return P({x:r*n,y:(1-a)*t},i)});return i.createElement("g",null,a,i.createElement("g",{stroke:o.prime,fill:"none",strokeOpacity:.7},l.map(function(e,n){return i.createElement("path",{key:n,d:"M"+[e.x,t,e.x,e.y]})})),i.createElement("path",{stroke:o.prime,fill:o.prime,fillOpacity:.1,d:"M"+l.flatMap(function(e){return[e.x,e.y]})}),i.createElement("g",{fillOpacity:.8,fill:"gray",stroke:"#333"},l.map(function(e,t){return e.id?i.createElement(R,{point:e,key:t,onClick:function(){return s(e.id)}}):null})))},N={container:function(e){return{display:"block",margin:"0",opacity:e?.5:1,flexShrink:0,padding:"8px"}},label:function(e){return{color:e,fontSize:"12px",margin:"0",width:"100%",textTransform:"capitalize",userSelect:"none"}},toggle:function(e){return{display:"flex",height:10,cursor:e?"pointer":"default"}},button:function(e){return{display:"block",width:"7px",height:"7px",borderRadius:"50%",margin:"2px",border:"2px solid #888888",padding:"0px",cursor:"pointer",flexShrink:0,background:e?o.black:o.highlight}},grid:function(e){return{display:"grid",margin:0,paddingTop:"12px",gap:"6px",gridTemplateColumns:Array.from({length:e},function(){return"1fr"}).join(" ")}}},D=function(e){var t=e.label,n=e.children,r=e.size,a=e.color,o=e.optional,c=!!(null==o?void 0:o.disabled),s=!!o;return i.createElement("div",{style:N.container(c)},i.createElement("div",{style:N.toggle(s),onClick:null==o?void 0:o.toggle},s?i.createElement("div",{style:N.button(c)}):null,i.createElement("h3",{style:N.label(void 0===a?"#555":a)},t)),i.createElement("div",{style:N.grid(void 0===r?1:r)},n))},_={nav:{display:"flex",gap:"10px"}},L=function(e,t,n,r){var a=r.x,i=r.y;switch(n){case"attack":return{attack:a};case"decay":return{decay:C(a-e),sustain:i};case"release":return{release:C(a-t)};default:return{}}},B=function(e){var t=e.height,n=void 0===t?100:t,r=e.width,a=void 0===r?160:r,o=e.padding,c=void 0===o?5:o,s=w(),u=s.current,d=s.options,f=s.setFields,p=u.attack+u.decay,h=p+.25;return i.createElement(D,{label:"Envelopes"},i.createElement("div",{style:_.nav},d.map(function(e){var t=e.name,n=e.active,r=e.onclick;return i.createElement(l,{key:t,name:t,active:n,onClick:r})})),i.createElement(T.BS,{paddingLeft:c,paddingTop:c,width:a+2*c,height:n+2*c,zoom:.8},i.createElement(F,{height:n,width:.8*a,onMove:function(e,t){return f(L(u.attack,h,e,t))},controlers:[{x:0,y:0},{id:"attack",x:u.attack,y:1},{id:"decay",x:p,y:u.sustain},{x:h,y:u.sustain},{id:"release",x:h+u.release,y:0}]},i.createElement(S,{width:a,height:n}))))},j=function(e){return"M"+Array.from({length:40},function(t,n){return 30+n+" "+(30+40*e(n/40))})},z=function(e){return"M"+e.map(function(e){return 30+40*e}).join(" ")},q={saw:z([0,.5,0,0,1,1,1,.5]),square:z([0,.5,0,0,.5,0,.5,1,1,1,1,.5]),saw2:z([0,.5,0,0,.5,1,.5,0,1,1,1,.5]),noise:z([0,.5,.05,.45,.1,.95,.15,.07,.2,1,.25,.26,.3,1,.35,0,.4,.8,.45,.2,.5,.81,.55,.1,.6,.8,.65,0,.7,1,.75,.46,.8,1,.85,0,.9,.96,.95,0,1,.5]),sine:j(function(e){return Math.sin(2*e*Math.PI)/2+.5}),fm:j(function(e){return Math.sin(2*e*Math.PI)/2+.5}),tech:j(function(e){return e<.15?Math.min((.05-e%.05)*50-.7,1)-.5:.5}),cutoff:"M25.03 34s11 .365 18.093-.415c7.092-.78 8.077-.095 12.153 5.524 4.075 5.618 19.06 29.97 19.06 29.97",resonance:"M25.86 65.488s17.086.177 24.168-30.246c6.56 30.48 25.135 29.14 25.135 29.14",envelope:z([0,1,.1,0,.3,.5,.5,.5,1,1]),fmFreq:"M22 49.8h6.5v20C39 71.3 37.5 30 44.3 30 51 30 50 70 56.7 70c6.7 0 2.6-39.7 6.5-40C67 30 63.8 70 70 70V50h8",offset:"M30 50 l0 10 m10-20 l0 20 m10-30 l0 30 m10-20 l0 20 m10-10 l0 10"},U={play:"M20 0 L 90 50 20 100Z",pause:"M30,100V0 M70,0v100",stop:"M5 5 L 95 5 95 95 5 95z",draw:"M72 15.2L20 68 14 88l19.4-6.6L90 23.6 73.7 7.8",select:"M71 71L25.4 27M58.5 27.4l-33-.7.3 34"},G=function(e){var t=e.value,n=e.color,r=e.steps,a=e.range,o=e.size,c=void 0===o?50:o,s=e.onChange,l=e.x,u=e.y,d=void 0===u?0:u,f=e.bold,p=e.stepOpacity,h=A({move:function(e){var t=1-M((e.y-d)/c-.5);return null==s?void 0:s(a?I(t,a):t)}}),m=c+(void 0===l?0:l),v=c+d,g=c*(void 0===f?.2:f),y=c-g/2,E=6*c;return i.createElement(i.Fragment,null,i.createElement("g",{fill:"none",stroke:void 0===n?"#555":n},i.createElement("circle",{strokeWidth:g,cx:m,cy:v,r:y,strokeDasharray:[1,2*y*Math.PI/(void 0===r?16:r)-1].toString(),opacity:void 0===p?.5:p}),i.createElement("circle",{strokeWidth:1,cx:m,cy:v,r:c,strokeOpacity:.1}),i.createElement("circle",{strokeWidth:g,strokeOpacity:.3,cx:m,cy:v,r:y,strokeDasharray:E,strokeDashoffset:E*(1-(a?(t-a[0])/(a[1]-a[0]):t))})),i.createElement("circle",{cx:m,cy:v,r:c,fillOpacity:0,onMouseDown:function(){return h(!0)},style:{cursor:"grab"}}))},K={label:{color:"#555",width:"100%",textAlign:"center",margin:"0",userSelect:"none"}},W=function(e){var t=e.id,n=e.range,r=e.color,a=e.value,o=e.steps,c=e.onChange;return i.createElement("div",null,i.createElement(T.BS,{width:100,height:100,zoom:.4,style:{margin:"2px"}},n?i.createElement("text",{x:"50",y:"65",fontSize:"40px",textAnchor:"middle",fill:r,style:{userSelect:"none"}},a):i.createElement("path",{fill:"none",d:q[t],strokeWidth:2,stroke:r}),i.createElement(G,{range:n,onChange:c,value:a,steps:o,color:r})),i.createElement("p",{style:K.label},t))},Y=function(e){var t=e.items,n=e.values,r=e.onChange;return i.createElement(i.Fragment,null,t.map(function(e){var t=e.id,a=e.range,o=e.steps;return i.createElement(W,{id:t,key:t,color:"#555",range:a,steps:o,value:n[t],onChange:function(e){return r(t,e)}})}))},X={li:{listStyle:"none",border:"none",outline:"none"},element:function(e,t){return{width:e+"px",border:"0.1px solid #BBB",height:e+"px",background:t?o.secondary:"#2220"}},container:{display:"flex",margin:"0px",padding:"0px"}},H=function(e){var t=e.stepSize,n=e.matrix,r=e.onClick;return i.createElement("ul",{style:X.container},n.map(function(e,n){return i.createElement("li",{style:X.li,key:n},e.map(function(a,o){return i.createElement("div",{style:X.element(t,a),key:o,onClick:function(){return r(n,e.length-o)}})}))}))},V=function(e,t){var n=t.square,r=t.saw,a=t.saw2,i=t.tech,o=t.sine,c=t.noise,s=0;n&&(s+=n*(e>.5?1:-1)),r&&(s+=r*(1-2*e)),a&&(s+=a*(1-2*e%1*2)),i&&(s+=i*(e>.15?0:Math.min((.05-e%.05)*50-.7,1))),o&&(s+=o*Math.sin(e*Math.PI*2)),c>0&&(s+=c*(1-2*Math.random()));var l=n+r+a+i+o+c;return 0===l?0:s/(l+1)},Q=function(e,t){var n,r=t/2,a=function(t){return(1-V((t+e.offset)%1,e))*r},i=(a(1)+a(0))/2,o=[0,i,(n=function(e){return[e,a(e/t)]},Array.from({length:t},function(e,t){return n(t)})).flat(),t,i].flat().map(function(e){return e.toFixed(1)});return"M ".concat(o.join(" "))},J=function(e){var t=e.quality,n=b().wave;return i.createElement("svg",{viewBox:[0,0,t,t].join(" "),width:"80px",height:"80px"},i.createElement("path",{d:Q(n,t),stroke:"#444",strokeWidth:2,fill:"none"}),i.createElement(S,{color:"gray"}))},Z=function(e){return Array.from({length:e},function(e,t){return t})},$={container:{display:"flex",fontSize:"10px",alignItems:"flex-start",padding:"5px"},presets:{maxHeight:"80px",overflowY:"scroll",width:"100%"}},ee=function(){var e=b(),t=e.wave,n=e.options,r=e.filter,a=e.getModule,o=e.setWave,c=e.setFilter,s=e.sequence,u=e.toggleARP,d=e.newPreset;return i.createElement("div",{style:$.container},i.createElement(D,{label:"Presets"},i.createElement(J,{quality:200}),i.createElement("button",{onClick:d}," New "),i.createElement("div",{style:$.presets},n.map(function(e){var t=e.id,n=e.name,r=e.onclick,a=e.active;return i.createElement(l,{key:t,name:n,active:a,onClick:r})}))),i.createElement(D,{label:"Oscillators",size:4},i.createElement(Y,{values:t,items:[{id:"sine"},{id:"square"},{id:"saw"},{id:"saw2"},{id:"tech"},{id:"noise"},{id:"offset"},{id:"fm"},{id:"fmFreq"},{id:"voices",range:[1,12],steps:11},{id:"octave",range:[-4,4],steps:8}],onChange:o})),i.createElement(D,{label:"Filter",optional:a("filter")},i.createElement(Y,{items:[{id:"cutoff"},{id:"resonance"},{id:"envelope"}],values:r,onChange:c})),i.createElement("div",null,i.createElement(B,null),i.createElement(D,{label:"Sequencer",optional:a("sequence")},i.createElement(H,{stepSize:7,matrix:Z(16).map(function(e){return Z(4).map(function(t){return!!(s[e]&&-1!==s[e].indexOf(4-t))})}),onClick:function(e,t){return u({column:e,row:t})}}))))},et=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],en=et.length,er=function(e){var t=et[e%en],n=Math.min(4,Math.floor(e/en));return"".concat(t).concat(n)},ea=function(e){var t=e.length-1,n=Math.min(4,Number(e.charAt(t)));e=e.slice(0,t);var r=et.indexOf(e.toUpperCase());if(-1===r)throw Error("invalid Note");return r+n*en},ei={toNote:function(e){return er(e-1)},fromNote:function(e){return ea(e)+1}},eo=function(e){var t=e.id,n=e.onClick,r=e.color,a=void 0===r?o.prime:r;return i.createElement("svg",{viewBox:"0 0 100 100",width:"20px",height:"20px",onClick:n,style:{cursor:"pointer",padding:"5px"}},i.createElement("path",{stroke:a,strokeWidth:10,strokeLinecap:"round",strokeLinejoin:"round",d:U[t],fill:"none"}))},ec=function(e){var t=e.value,n=e.onChange,r=i.useState(!1),a=r[0],o=r[1],c=i.useState(t),s=c[0],l=c[1];return i.useEffect(function(){l(t)},[t]),i.createElement("div",null,!a&&i.createElement("button",{onClick:function(){return o(!0)}}," Rename "),a&&i.createElement(i.Fragment,null,i.createElement("input",{type:"text",value:s,onChange:function(e){return l(e.target.value)}}),i.createElement("button",{onClick:function(){n(s),o(!1)}}," Ok ")))},es=function(e){var t=e.id,n=e.label,r=e.value,a=e.options,o=e.onChange;return i.createElement("div",null,i.createElement("label",{htmlFor:t},n,": "),i.createElement("select",{id:t,name:n,value:r,onChange:function(e){return o(e.target.value)}},a.map(function(e){var t=e.id,n=e.name;return i.createElement("option",{key:t,value:t},n)})))},el=function(e){var t=i.useContext(y),n=t.currentFragment,r=t.midiFragments,a=t.dispatch,o=null!=e?e:n,c=r[o],s=c.notes,l=c.loop,u=c.name,d=(0,i.useMemo)(function(){return s.map(function(e){var t=e.id,n=e.note,r=e.at,a=e.length;return{id:t,x:r,y:ei.fromNote(n),length:a}})},[s]),f=l[0],p=l[1];return{options:Object.values(r),name:u,loopStart:f,loopEnd:p,loopWidth:p-f,notes:d,loop:l,id:o,setFragment:function(e){return a({type:"MIDI/SET_FRAGMENT",id:o,payload:e})},syncNotes:function(e){return a({id:o,type:"MIDI/SET_FRAGMENT",payload:{notes:e.map(function(e){var t=e.id,n=e.length,r=e.x,a=e.y;return{id:t,at:r,note:ei.toNote(a),length:n}})}})},setCurrent:function(e){return a({type:"MIDI/SET_CURRENT_FRAGMENT",payload:e})},newFragment:function(){return a({type:"MIDI/NEW_FRAGMENT",payload:{id:crypto.randomUUID(),name:"Fragment ".concat(Object.keys(r).length+1),notes:[],loop:[0,64]}})}}},eu={container:{padding:"5px",display:"flex",background:o.background,border:"0.05em solid #BBB",alignItems:"center",gap:"5px"},label:{margin:"0px 16px",fontSize:"16px",padding:"0 24px",borderLeft:"1px solid gray"}},ed=function(e){var t=e.actionType,n=e.manu,r=el(),a=r.name,c=r.id,s=r.options,l=r.setFragment,u=r.setCurrent,d=r.newFragment;return i.createElement("section",{style:eu.container},i.createElement(es,{id:"midi-editor-fragment-selector",label:"Fragment",value:c,options:s,onChange:u}),i.createElement("button",{onClick:d},"New"),i.createElement(ec,{value:a,onChange:function(e){return l({name:e})}}),i.createElement(eo,{id:"draw",color:o.button("draw"===t),onClick:function(){return n("draw")}}),i.createElement(eo,{id:"select",color:o.button("select"===t),onClick:function(){return n("select")}}))},ef=function(e){var t=e.notes,n=e.color,r=void 0===n?o.notes:n,a=e.mouseDown,c=e.scale,s=e.height,l=e.noteHeight;return i.createElement("g",null,t.map(function(e,t){var n=e.x,u=e.length,d=s-e.y*l;return i.createElement("g",{key:t,fill:e.origin?o.notesSelected:r},i.createElement("rect",{x:n,y:d,width:u,height:l,onMouseDown:function(t){return a&&a(t,e)},stroke:"#000",strokeWidth:.25}),i.createElement("rect",{width:1,height:l,fill:"gray",fillOpacity:.1,onMouseDown:function(t){return null==c?void 0:c(t,e)},style:{cursor:"e-resize"},key:"s"+t,x:n+u-1,y:d}))}))},ep=function(e,t){var n=t[0],r=t[1];return n<e&&e<r},eh=function(e,t){return e<t?[e,t]:[t,e]},em=function(e,t){var n=t[0],r=t[1],a=n<e[0]&&e[1]<r;return ep(n,e)||ep(r,e)||a},ev=function e(t,n){var r,a=this;this.map=function(t){return new e(t({x:a.x1,y:a.y1}),t({x:a.x2,y:a.y2}))},this.isOverlaping=function(e){var t=e.x1,n=e.x2,r=e.y1,i=e.y2;return em([a.x1,a.x2],[t,n])&&em([a.y1,a.y2],[r,i])};var i=eh(t.x,n.x),o=eh(t.y,n.y);this.x1=i[0],this.x2=i[1],this.y1=o[0],this.y2=o[1],this.moveX=Math.round(n.x-(null==t?void 0:t.x)),this.moveY=Math.round(n.y-(null!==(r=null==t?void 0:t.y)&&void 0!==r?r:0))},eg=function(e){var t=(0,T.wu)(),n=i.useState(),r=n[0],a=n[1],o=i.useState(void 0),c=o[0],s=o[1],l=A({move:function(t,n){var r=c?new ev(c,t):void 0;switch(n){case"select":return a(r),e.onSelect(r);case"move":return r?e.onMove(r.moveX,r.moveY):void 0;case"scale":return r?e.onScale(r.moveX):void 0}},end:function(t){var n;a(void 0),s(void 0),"select"!==t&&(null===(n=e.onEnd)||void 0===n||n.call(e))}}),u=function(n){return function(r,a){var i;l(n),s(t(r)),void 0!==a&&(null===(i=e.onStart)||void 0===i||i.call(e,a))}};return{area:r,onElement:u,onBackground:function(n){var r,a=null===(r=e.onBackground)||void 0===r?void 0:r.call(e,t(n));a&&u(a)(n)}}},ey=function(e){var t=e.x,n=e.y;return{x1:t,x2:t+e.length,y1:n-1,y2:n+1}},eE=function(){return(eE=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},ek=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)0>t.indexOf(r[a])&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n},ex=function(e){var t=ek(e,[]);return eE(eE({},t),{origin:eE({},t)})},eb=function(e){return e.origin,ek(e,["origin"])},ew=function(e,t){var n=[],r=[];return e.forEach(function(e){return t(e)?n.push(e):r.push(e)}),[n,r]},eS=function(e,t){var n=e.down,r=e.up;void 0===t&&(t=[]),i.useEffect(function(){return document.addEventListener("keydown",n),r&&document.addEventListener("keyup",r),function(){document.removeEventListener("keydown",n),r&&document.removeEventListener("keyup",r)}},t)},eT=function(e,t){void 0===t&&(t=[]),eS({down:function(t){if("Backspace"===t.key)return e()}},t)},eM=function(e,t,n){if(n||2==arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},eC=function(e){return eM(eM([],e.selected,!0),e.inactive,!0)},eI=function(e){var t=new Set(e.selected.map(function(e){return e.id}));return function(e){return t.has(e.id)}},eR=function(e,t){return eA.apply(void 0,ew(e,t))},eA=function(e,t){return{selected:e.map(ex),inactive:t.map(eb)}},eP=function(e){return{selected:[],inactive:e}},eO=function(e,t){var n=(0,i.useState)(eP(e)),r=n[0],a=n[1],o=(0,i.useRef)(eP(e)),c=function(e){var t=e(o.current);o.current=t,a(t)},s=function(e){return c(function(t){return eR(eC(t),e)})},l=function(e){return c(function(t){return eA([],e(t))})};return eT(function(){return l(function(e){return e.inactive})},[r.selected,r.inactive]),(0,i.useEffect)(function(){return c(function(t){return eR(e,eI(t))})},[e]),{selectIn:function(e,t){return function(n){return s(function(r){var a;return null!==(a=null==n?void 0:n.map(t).isOverlaping(e(r)))&&void 0!==a&&a})}},select:function(e){return s(function(t){return t==e})},add:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return c(function(t){return eA(e,eC(t))})},edit:function(e){return c(function(t){var n=t.selected,r=t.inactive;return{selected:n.map(function(t){return t.origin?eE(eE({},t),e(t.origin)):t}),inactive:r}})},all:eC(r),clear:function(){return l(eC)},remove:function(e){return l(function(t){return eC(t).filter(function(t){return t!==e})})},sync:function(){return t(eM(eM([],o.current.selected,!0),o.current.inactive,!0))}}},eF=function(e,t){var n=t.x,r=t.y;return{x:e.accuracyX(n),y:e.accuracyY(r)}},eN=function(e,t){return function(n,r){return t(e.accuracyX(e.scaleX(n)),e.accuracyY(e.scaleY(r)))}},eD=function(e,t){return function(n){return t(e.accuracyX(e.scaleX(n)))}},e_=function(e,t){return function(n){return t(eF(e,eL(e,n)))}},eL=function(e,t){var n=t.x,r=t.y;return{x:e.scaleX(n),y:e.flipWithHeight?e.flipWithHeight-e.scaleY(r):e.scaleY(r)}},eB=function(e){var t=el(),n=eO(t.notes,t.syncNotes),r=n.all,a=n.add,i=n.clear,o=n.edit,c=n.remove,s=n.sync,l=n.select,u=n.selectIn,d=eD(e,function(e){return o(function(t){return{length:t.length+e}})}),f=eN(e,function(e,t){return o(function(n){return{x:n.x+e,y:n.y-t}})}),p=e_(e,function(e){var t=e.x,n=e.y;return a({id:crypto.randomUUID(),length:1,x:t,y:n})});return{selectIn:u(ey,function(t){return eL(e,t)}),all:r,clear:i,sync:s,remove:c,select:l,addAt:p,move:f,scale:d}},ej=function(e){var t=e.area;return i.createElement("rect",{stroke:"red",fill:"red",fillOpacity:.1,x:t.x1,y:t.y1,width:t.x2-t.x1,height:t.y2-t.y1})},ez=function(e){var t=e.opacity,n=e.height;return i.createElement("g",{fill:"black",fillOpacity:void 0===t?1:t},[1,3,5,8,10].map(function(e){return i.createElement("rect",{key:e,y:e*n,width:"100%",height:n,stroke:"none"})}))},eq=function(e){var t=e.width,n=e.ocatveHeight,r=e.count,a=e.noteHeight;return i.createElement("g",null,i.createElement("defs",null,i.createElement("pattern",{width:"100%",height:n,patternUnits:"userSpaceOnUse",id:"start_keys"},i.createElement(ez,{height:a}))),i.createElement("rect",{x:-t,width:t,height:n*r,fill:"url(#start_keys)",stroke:"none"}))},eU=function(e){var t=e.timelineHeight,n=e.loop,r=n[0],a=n[1],c=e.height,s=e.moveStart,l=e.moveEnd,u=e.controlerWidth;return i.createElement(i.Fragment,null,i.createElement("line",{x1:r,y1:0,x2:a,y2:0,stroke:o.critical,strokeWidth:.4}),i.createElement("rect",{fillOpacity:.4,y:-t,height:t,x:r-u/2,width:u,fill:o.critical,stroke:o.critical,strokeWidth:.1,onMouseDown:s}),i.createElement("rect",{fillOpacity:.4,y:-t,height:t,x:a-u/2,width:u,fill:o.critical,stroke:o.critical,strokeWidth:.1,onMouseDown:l}),i.createElement("line",{x1:a,y1:0,x2:a,y2:c,stroke:o.critical,strokeWidth:.4}),i.createElement("line",{x1:r,y1:0,x2:r,y2:c,stroke:o.critical,strokeWidth:.4}))},eG=function(e){return function(t){return Math.round(t/e)*e}},eK=function(e){var t=el(),n=t.loop,r=t.setFragment,a=i.useState(void 0),o=a[0],c=a[1],s=i.useState(void 0),l=s[0],u=s[1],d=i.useState(n),f=d[0],p=d[1];i.useEffect(function(){return p(n)},[n]);var h=f[0],m=f[1];return{target:l,startMove:function(e){c("start"===e?h:m),u(e)},endMove:function(){c(void 0),u(void 0),r({loop:f})},state:f,move:function(t){var n=eG(e)(t);if(void 0!==o){var r=f[0],a=f[1];switch(l){case"start":return p([o+n,a]);case"end":return p([r,o+n])}}}}},eW=function(e){var t=e.at,n=e.strength,r=e.height,a=e.div,o=void 0===a?1:a;return i.createElement("line",{x1:t,x2:t,y1:0,y2:r?r/o:"100%",stroke:"black",fill:"none",strokeWidth:Math.pow(n/o,1.6)})},eY=function(e){var t=e.size,n=e.strength,r=e.height;return i.createElement(i.Fragment,null,i.createElement(eW,{div:1,at:0,strength:n,height:r}),i.createElement(eW,{div:4,at:t,strength:n,height:r}),i.createElement(eW,{div:6,at:2*t,strength:n,height:r}),i.createElement(eW,{div:4,at:3*t,strength:n,height:r}),i.createElement(eW,{div:2,at:4*t,strength:n,height:r}),i.createElement(eW,{div:4,at:5*t,strength:n,height:r}),i.createElement(eW,{div:6,at:6*t,strength:n,height:r}),i.createElement(eW,{div:4,at:7*t,strength:n,height:r}),i.createElement(eW,{div:1,at:8*t,strength:n,height:r}))},eX=function(e){var t=e.strength,n=e.children,r=e.patternHeight,a=e.height,o=e.size,c=i.useId();return i.createElement("g",null,i.createElement("defs",null,i.createElement("pattern",{width:o,height:void 0===r?"100%":r,patternUnits:"userSpaceOnUse",id:c},n,i.createElement(eY,{size:o/8,strength:void 0===t?.4:t}))),i.createElement("rect",{width:"100%",height:void 0===a?"100%":a,fill:"url(#".concat(c,")")}))},eH=function(e){var t=e.onMouseDown,n=(0,T.UT)(),r=n.height,a=n.width;return i.createElement("rect",{y:0,onMouseDown:t,height:r,width:a,opacity:0})},eV=2*en,eQ=4*eV,eJ=function(e){var t=e.actionType,n=e.loopAccuracy,r=eB({accuracyX:Math.floor,accuracyY:Math.round,scaleX:function(e){return e},scaleY:function(e){return e/2},flipWithHeight:4*en}),a=eK(n),o=eg({onSelect:r.selectIn,onScale:r.scale,onMove:a.target?a.move:r.move,onEnd:a.target?a.endMove:r.sync,onBackground:{draw:function(e){return r.addAt(e),"scale"},select:function(){return r.clear(),"select"}}[t],onStart:{draw:function(e){return r.remove(e)},select:function(e){return e.origin?void 0:r.select(e)}}[t]}),c=function(e){return function(t){a.startMove(e),o.onElement("move")(t)}};return i.createElement("g",null,i.createElement(eX,{size:64,patternHeight:eV,height:4*eV},i.createElement(ez,{opacity:.07,height:2})),i.createElement(eq,{width:20,ocatveHeight:eV,count:4,noteHeight:2}),i.createElement(eH,{onMouseDown:o.onBackground}),i.createElement(ef,{noteHeight:2,height:eQ,notes:r.all,mouseDown:o.onElement("move"),scale:o.onElement("scale")}),i.createElement(eU,{controlerWidth:4,timelineHeight:8,loop:a.state,height:eQ,moveStart:c("start"),moveEnd:c("end")}),o.area?i.createElement(ej,{area:o.area}):null)},eZ=function(){var e=i.useState("select"),t=e[0],n=e[1],r=el().loop;return i.createElement(i.Fragment,null,i.createElement(ed,{actionType:t,manu:n}),i.createElement("div",{style:{overflow:"scroll",height:"330px"}},i.createElement(T.BS,{width:r[1]+64,height:eQ,paddingLeft:20,paddingTop:8,zoom:4,style:{background:"#FFF"}},i.createElement(eJ,{actionType:t,loopAccuracy:8}))))},e$=function(){return(e$=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},e0={display:"block",border:"none",borderBottomLeftRadius:"2px",borderBottomRightRadius:"2px",flexGrow:0,boxShadow:"1px 3px 1px rgba(0, 0, 0, 0.2)",width:"4.5%",paddingTop:125,background:"#EEE"},e1={regular:e0,fixed:e$(e$({},e0),{background:o.black,width:"3.5%",position:"absolute",paddingTop:100}),key:function(e,t){var n,r=t?e1.fixed:e1.regular;return e$(e$({},r),{paddingTop:e?(null!==(n=r.paddingTop)&&void 0!==n?n:0)-10:r.paddingTop,left:t})}},e2=function(e){var t=e.pressed,n=e.onKeyDown,r=e.onKeyUp,a=e.fixed;return i.createElement("div",{style:e1.key(t,a),onTouchStart:n,onMouseDown:n,onTouchEnd:r,onMouseUp:r})},e5=["z","s","x","d","c","v","g","b","h","n","j","m","q","2","w","3","e","r","5","t","6","y","7","u"],e4=function(e){if("number"==typeof e)return e;var t=e5.indexOf(e.key);return -1===t?void 0:t+en},e3=function(e,t,n){if(n||2==arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},e6=function(){var e=(0,i.useContext)(y),t=e.currentTrack,n=e.keyboard,r=(0,i.useState)([]),a=r[0],o=r[1],c=function(e){var r=e4(e);r&&(o(function(e){return e3(e3([],e,!0),[r],!1)}),n.startNote(t,r))},s=function(e){var r=e4(e);r&&(n.endNote(t,r),o(function(e){return e.filter(function(e){return e!==r})}))};return eS({down:c,up:s},[t,n]),{notes:a,onKeyDown:c,onKeyUp:s}},e8=[{id:"C",index:0},{id:"D",index:2},{id:"E",index:4},{id:"F",index:5},{id:"G",index:7},{id:"A",index:9},{id:"B",index:11},{id:"C#",fixed:9.2,index:1},{id:"D#",fixed:23.6,index:3},{id:"F#",fixed:52.1,index:6},{id:"G#",fixed:66.5,index:8},{id:"A#",fixed:81.5,index:10}],e9=[1,2,3].flatMap(function(e){return e8.map(function(t){var n=t.index,r=t.fixed;return{key:12*e+n,fixed:r?(e-1)*100/3+r/3+"%":void 0}})}),e7={container:{borderTop:"2px solid #c8c8c8",display:"flex",padding:"0px",margin:"0px",listStyleType:"none",cursor:"pointer",position:"relative",userSelect:"none",justifyContent:"space-between",alignItems:"start"}},te=function(){var e=e6(),t=e.notes,n=e.onKeyDown,r=e.onKeyUp;return i.createElement("ul",{style:e7.container},e9.map(function(e){var a=e.fixed,o=e.key;return i.createElement(e2,{key:o,fixed:a,onKeyDown:function(){return n(o)},onKeyUp:function(){return r(o)},pressed:t.includes(o)})}))},tt=function(){var e=(0,i.useContext)(y),t=e.isPlaying,n=e.bpm,r=e.time,a=e.dispatch;return{isPlaying:t,bpm:n,time:r,setBPM:function(e){return a({type:"PLAYER/SET_BPM",payload:e})},setTime:function(e){return a({type:"PLAYER/SET_TIME",payload:e})},toggle:function(){return a({type:t?"PLAYER/PAUSE":"PLAYER/PLAY"})},stop:function(){return a({type:"PLAYER/STOP"})},save:function(){return a({type:"STORE/SAVE"})},reset:function(){return a({type:"STORE/RESET"})}}},tn={container:{display:"flex",background:o.background,padding:"5px",border:"0.05em solid #BBB",alignItems:"center",gap:"5px"},bpm:{display:"flex",padding:"5px",alignItems:"center",fontFamily:"sans-serif",fontSize:"14px"},bpmInput:{userSelect:"none",outline:"none",border:"0",background:o.secondary,fontSize:"14px",marginLeft:"4px",borderRadius:"3px"}},tr=function(){var e=tt(),t=e.isPlaying,n=e.bpm,r=e.setBPM,a=e.toggle,o=e.stop,c=e.save,s=e.reset;return i.createElement("section",{style:tn.container},i.createElement(eo,{id:t?"pause":"play",onClick:a}),i.createElement(eo,{id:"stop",onClick:o}),i.createElement("div",{style:tn.bpm},i.createElement("label",{htmlFor:"bpm-input"},"BPM"),i.createElement("input",{id:"bpm-input",type:"number",value:n,onChange:function(e){return r(Math.min(Math.max(0,Number(e.target.value)),200))},min:0,max:200,style:tn.bpmInput})),i.createElement("button",{onClick:c}," save"),i.createElement("button",{onClick:s}," reset "))},ta=function(e){var t=e.height,n=e.size,r=e.strength,a=void 0===r?.4:r,c="tapeline-pattern-".concat(t,"-").concat(n,"-").concat(a);return i.createElement("g",null,i.createElement("defs",null,i.createElement("pattern",{width:n,height:t,patternUnits:"userSpaceOnUse",id:c},i.createElement("rect",{width:n,height:t,fill:o.background}),i.createElement(eY,{size:n/8,strength:a,height:t}))),i.createElement("rect",{width:"100%",height:t,y:-t,fill:"url(#".concat(c,")")}))},ti=function(e){var t=e.height,n=e.size,r=tt(),a=r.time,c=r.setTime,s=(0,T.wu)();return i.createElement("g",null,i.createElement(ta,{height:t,size:n}),i.createElement("rect",{y:-t,height:(0,T.UT)().height+t,width:1,x:a,fill:o.critical}),i.createElement("rect",{fillOpacity:"0",y:-t,height:t,width:"100%",onMouseDown:function(e){return c(Math.floor(s(e).x))}}))},to=function(e){var t=e.name,n=e.active,r=e.y,a=e.width,c=e.height,s=e.gain,l=e.levelSize,u=e.setGain,d=e.setTrack;return i.createElement(i.Fragment,null,i.createElement("text",{x:-(.9*a),y:r+c/2,fill:n?o.notes:"gray",fontFamily:"sanf-serif",textAnchor:"center",dominantBaseline:"middle",pointerEvents:"none",style:{userSelect:"none"}},t),i.createElement("rect",{fill:"black",opacity:n?.03:.1,y:r,x:-a,width:a,height:c,onClick:d,style:{border:"none",cursor:"pointer"}}),i.createElement(G,{onChange:u,value:s,color:o.black,size:16,steps:48,y:r+c/6,x:-(3*(void 0===l?16:l)),stepOpacity:.2,bold:.1}))},tc=function(){var e=i.useContext(y),t=e.currentTrack,n=e.tracks,r=e.midiRefs,a=e.dispatch,o=Math.max.apply(Math,r.map(function(e){return e.end})),c=n.length;return{current:n[t],tracks:n,midiRefs:r,currentTrack:t,setMidis:function(e){return a({type:"MIDI/SET_MIDI_REFS",payload:e.map(function(e){var t=e.start,n=e.end,r=e.fragmentId,a=e.trackId;return{id:e.id,start:t,end:n,trackId:a,fragmentId:r}})})},setCurrent:function(e){return a({type:"MIDI/SET_CURRENT_FRAGMENT",payload:e})},length:o,count:c,newTrack:function(){return a({type:"TRACK/NEW_TRACK"})},dispatch:a}},ts=function(e){var t=e.start,n=e.end,r=e.trackId;return{x1:t,x2:n,y1:r,y2:r+1}},tl=function(e){var t=tc(),n=t.midiRefs,r=t.setMidis,a=t.setCurrent,i=t.tracks,o=eO(n,r),c=o.all,s=o.edit,l=o.add,u=o.clear,d=o.sync,f=o.select,p=o.selectIn,h=o.remove,m=eN(e,function(e,t){return s(function(n){var r=n.start,a=n.end,o=n.trackId;return{start:Math.max(r+e,0),end:a+e,trackId:Math.min(i.length-1,Math.max(o+t,0))}})}),v=eD(e,function(e){return s(function(t){return{start:t.start,end:t.end+e}})}),g=e_(e,function(e){var t=e.x,n=e.y;return l({id:crypto.randomUUID(),trackId:n,start:t,end:t+64})});return{all:c,clear:u,sync:d,move:m,scale:v,select:f,setCurrent:a,selectIn:p(ts,function(t){return eL(e,t)}),remove:h,addAt:g}},tu=function(e){var t=e.fragmentId,n=e.start,r=e.end,a=e.startMove,c=e.startScale,s=e.y,l=e.color,u=e.height,d=el(t),f=d.name,p=d.notes,h=d.loopStart,m=d.loopWidth,v="fragment-pattern-".concat(t,"-").concat(s,"-").concat(n,"-").concat(r,"-").concat(u),g=r-n,y=n+g,E=n%m;return i.createElement("g",null,i.createElement("defs",null,i.createElement("pattern",{width:m,height:u,patternUnits:"userSpaceOnUse",id:v,x:E},i.createElement("g",{fill:o.notes},(t?p:[]).map(function(e,t){return i.createElement("rect",{key:t,width:e.length,height:1,x:e.x-h,y:u-e.y})})),i.createElement("rect",{fill:l,opacity:.4,width:"100%",height:"100%"}))),i.createElement("text",{color:o.black,x:n+4,y:s+u/3,fontSize:"8px",textAnchor:"start",fontFamily:"sans-serif",opacity:.6,width:g,cursor:"pointer"},t?f:""),i.createElement("rect",{y:s,onMouseDown:function(e){return null==a?void 0:a(e)},x:n,width:g,height:u,fill:"url(#"+v+")",stroke:o.notesBackground,strokeWidth:.3}),i.createElement("rect",{x:y-5,y:s,width:5,height:u,fill:"gray",fillOpacity:.05,onMouseDown:function(e){return null==c?void 0:c(e)},style:{cursor:"e-resize"}}))},td=function(){var e=i.useContext(y),t=e.currentTrack,n=e.tracks,r=e.dispatch;return{panels:n.map(function(e,a){return{index:a,active:a===t,name:e.name,gain:n[a].gain,setTrack:function(){return r({type:"TRACK/SET_CURRENT",payload:a})},setGain:function(e){return r({type:"TRACK/SET_TRACK",id:a,payload:{gain:e}})}}})}},tf={header:{display:"flex",background:o.background,padding:"5px",border:"0.05em solid #BBB",alignItems:"center",gap:"5px"},bar:{display:"flex",background:o.background,padding:"4px",border:"1px solid gray",alignItems:"center",gap:"10px",borderRadius:"5px"},container:{width:"100%",height:"auto",position:"relative"},canvas:{overflowX:"scroll"}},tp=function(e){var t=e.actionType,n=e.openDropDown,r=tl({scaleX:function(e){return e},accuracyX:eG(8),accuracyY:Math.round,scaleY:function(e){return e/48}}),a=r.all,c=r.clear,s=r.move,l=r.scale,u=r.setCurrent,d=r.select,f=r.selectIn,p=r.sync,h=r.remove,m=r.addAt,v=td().panels,g=eg({onSelect:f,onMove:s,onScale:l,onEnd:p,onStart:{draw:h,select:function(e){e.origin||(e.fragmentId&&u(e.fragmentId),d(e),n(e))}}[t],onBackground:{draw:function(e){return m(e),"scale"},select:function(){return n(void 0),c(),"select"}}[t]});return i.createElement("g",null,i.createElement(eH,{onMouseDown:g.onBackground}),a.map(function(e,t){return i.createElement(tu,{key:t,y:48*e.trackId,start:e.start,end:e.end,fragmentId:e.fragmentId,height:48,startMove:function(t){return g.onElement("move")(t,e)},startScale:function(t){return g.onElement("scale")(t,e)},color:e.origin?o.notesSelected:o.notesBackground})}),v.map(function(e){var t=e.name,n=e.index,r=e.active,a=e.gain,o=e.setGain,c=e.setTrack;return i.createElement(to,{key:n,active:r,name:t,width:160,y:48*n,height:48,gain:a,setGain:o,setTrack:c})}),g.area?i.createElement(ej,{area:g.area}):null)},th=function(){var e,t=tc(),n=t.count,r=t.length,a=t.newTrack,c=t.currentTrack,s=t.current,l=t.dispatch,u=el().options,d=i.useState("select"),f=d[0],p=d[1],h=i.useState(void 0),m=h[0],v=h[1];return i.createElement("div",{style:tf.container},i.createElement("section",{style:tf.header},i.createElement("div",{style:tf.bar},i.createElement("div",null,s.name),i.createElement(ec,{value:s.name,onChange:function(e){return l({type:"TRACK/SET_TRACK",id:c,payload:{name:e}})}}),i.createElement("button",{onClick:a},"New")),i.createElement(eo,{id:"draw",onClick:function(){return p("draw")},color:o.button("draw"===f)}),i.createElement(eo,{id:"select",color:o.button("select"===f),onClick:function(){return p("select")}}),m&&i.createElement("div",{style:tf.bar},i.createElement(es,{id:"tracks-midi-ref-fragment-selector",label:"Fragment",value:null!==(e=m.fragmentId)&&void 0!==e?e:"",options:u,onChange:function(e){l({type:"MIDI/SET_MIDI_REF",id:m.id,payload:{fragmentId:e}}),v(void 0)}})," ")),i.createElement("section",{style:tf.canvas},i.createElement(T.BS,{width:r+64,height:48*n,paddingLeft:160,paddingTop:32},i.createElement(eX,{size:64}),i.createElement(tp,{actionType:f,openDropDown:v}),i.createElement(ti,{height:32,size:64}))))},tm={daw:{display:"flex",position:"relative",justifyContent:"center",fontFamily:"sans-serif"},synth:{position:"relative",width:"540px",height:"340px",borderRadius:"2px",background:o.background,border:"1px solid #CCC"},midi:{position:"relative",width:"20%",flexGrow:1},tracks:{padding:"10px",justifyContent:"center",display:"flex",position:"relative",overflowX:"scroll"},container:{margin:"0 auto",position:"relative",background:"#FFF",border:"1px solid #BBB",display:"block",borderRadius:"5px",maxWidth:"1200px"}},tv=function(){return i.createElement("div",{style:tm.container},i.createElement("div",{style:tm.daw},i.createElement("section",{style:tm.synth},i.createElement(ee,null),i.createElement(te,null)),i.createElement("section",{style:tm.midi},i.createElement(eZ,null))),i.createElement("section",{style:tm.tracks},i.createElement(th,null)),i.createElement(tr,null))},tg=function(){var e=this;this.open=function(t){var n=new AudioContext,r=n.createScriptProcessor(2048,1,1);r.connect(n.destination),r.onaudioprocess=function(e){for(var n=e.outputBuffer.getChannelData(0),r=n.length,a=0;a<r;++a)n[a]=t.next()},e.context=n,e.context.resume()},this.close=function(){var t;null===(t=e.context)||void 0===t||t.close()}},ty=function(e){try{var t=new tg,n=function(){t.open(e),r()},r=function(){document.removeEventListener("click",n),document.removeEventListener("keypress",n)};return document.addEventListener("click",n),document.addEventListener("keypress",n),function(){t.close(),r()}}catch(e){return console.error("could not create audio context: ",e),function(){}}},tE={isPlayingChanged:function(e){return"boolean"==typeof e?e:void 0},timeChanged:function(e){return"number"==typeof e?e:void 0}},tk=function(){var e=this;this.target=new EventTarget,this.dispatch=function(t,n){return e.target.dispatchEvent(new CustomEvent(t,{detail:n}))},this.addEventListener=function(t,n){return e.target.addEventListener(t,function(e){if(e instanceof CustomEvent){var r=tE[t](e.detail);return void 0===r?void 0:n(r)}})}},tx=function(){function e(e){var t=this;this.sampleRate=e,this.counter=0,this.subStep=0,this.size=1,this.setBPM=function(e){t.BPM=e,t.adjust()},this.BPM=130,this.adjust()}return e.prototype.adjust=function(){var e=60*this.sampleRate/(8*this.BPM);this.subStep=1/e},e.prototype.next=function(){return this.counter+=this.subStep,this.counter>this.size&&(this.counter=0,!0)},e}(),tb=function(){function e(e,t,n){var r=this;this.events=e,this.tracks=t,this.sampleRate=n,this.isPlaying=!1,this.time=0,this.tempo=new tx(this.sampleRate),this.setTime=function(e){r.time=e,r.events.dispatch("timeChanged",e)},this.setBPM=this.tempo.setBPM,this.next=function(){return r.tempo.next()&&(r.tracks.nextActions(r.isPlaying,r.time),r.isPlaying&&r.setTime(r.time+r.tempo.size),r.tracks.isDone(r.time)&&r.setTime(0)),r.tracks.next()},this.play=function(){r.setIsPlaying(!0)},this.pause=function(){r.setIsPlaying(!1),r.tracks.clear()}}return e.prototype.setIsPlaying=function(e){this.isPlaying=e,this.events.dispatch("isPlayingChanged",e)},e.prototype.stop=function(){this.setTime(0),this.pause()},e}(),tw=function(){function e(){var e=this;this.index=0,this.notes=new Set([]),this.next=function(t){var n,r=e.notes;if(t.enabled){if(e.index%2!=0){e.index++,e.index>=32&&(e.index=0);return}var a=e.index/2,i=r.size,o=Array.from(r).sort(function(e,t){return e>t?1:-1}),c=i?null===(n=t[a])||void 0===n?void 0:n.map(function(e){return o[--e%i]+12*Math.floor(e/i)}):void 0;e.index++,e.index>=32&&(e.index=0);var s=e.last;return e.last=c,{start:c,end:s}}}}return e.prototype.startNote=function(e){this.notes.has(e)||(this.index=0),this.notes.add(e)},e.prototype.endNote=function(e){this.notes.delete(e)},e.prototype.clear=function(){this.notes.clear()},e}(),tS=function(e,t){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=c(0),o.throw=c(1),o.return=c(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(e){c=[6,e],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},tT=function(e,t){return Array.from({length:e},t)};function tM(e,t,n,r){void 0===e&&(e=.5),void 0===t&&(t=1),void 0===n&&(n=0);var a,i,o=void 0===r?{}:r,c=o.power,s=void 0===c?3:c,l=o.steps,u=void 0===l?2048:l;return tS(this,function(r){switch(r.label){case 0:if(0===e)return[2,n];a=0,i=n-t,e*=u,r.label=1;case 1:if(!(++a<e))return[3,3];return[4,t+i*Math.pow(a/e,s)];case 2:return r.sent(),[3,1];case 3:return[2,n]}})}!function(e){e[e.ATTACK=0]="ATTACK",e[e.DEACY=1]="DEACY",e[e.SUSTAIN=2]="SUSTAIN",e[e.RELEASE=3]="RELEASE"}(r||(r={}));var tC=function(e){return Math.min(Math.pow(3*e,3),200)},tI=function(){var e=this;this.stage=r.ATTACK,this.level=0,this.live=!1,this.next=function(t){if(!e.live||!e.iter)return 0;switch(e.stage){case r.ATTACK:var n=e.iter.next(),a=n.value,i=n.done;return i&&(e.iter=tM(tC(t.decay),a,t.sustain),e.stage=r.DEACY,e.level=a),a;case r.DEACY:var o=e.iter.next(),a=o.value,i=o.done;return e.level=a,i&&(e.stage=r.SUSTAIN),a;case r.SUSTAIN:return e.level;default:var c=e.iter.next();return e.live=!c.done,c.value}},this.open=function(t){e.live=!0,e.stage=r.ATTACK,e.iter=tM(tC(t.attack),0,1)},this.close=function(t){var n=tC(t.release);e.iter=tM(n,e.level,0),e.stage=r.RELEASE},this.kill=function(){e.live=!1}},tR=function(){function e(e){this.sampleRate=e,this.phase=0,this.length=.1,this.fmPhase=0,this.freq=0}return e.prototype.set=function(e){this.freq=e,this.phase=Math.random(),this.length=this.freq/this.sampleRate,this.fmPhase=Math.random()},e.prototype.next=function(e){var t,n=this.length,r=e.fm;if(this.phase=(this.phase+n)%1,0===r)return V(this.phase,e);var a=0===e.fmFreq?1/16:4*e.fmFreq;return this.fmPhase=this.fmPhase+n*a,V(this.phase*((Math.sin(this.fmPhase)+(t=2/Math.pow(t=r,2)))/t),e)},e}(),tA=function(){function e(e){var t=this;this.sampleRate=e,this.all=tT(12,function(){return new tR(t.sampleRate)}),this.poly=[]}return e.prototype.open=function(e,t){var n=Math.min(11,Math.max(1,e.voices)),r=440*Math.pow(2,(Math.max(t+12*Math.floor(e.octave),0)-49)/12),a=Math.floor((n+1)/2),i=2*e.offset;this.poly=this.all.slice(n-1),this.poly.forEach(function(e,t){return e.set(r+(t-a)*i)})},e.prototype.next=function(e){for(var t=0,n=0,r=this.poly;n<r.length;n++)t+=r[n].next(e);return t/(this.poly.length+1)},e}(),tP=function(){function e(){var e=this;this.frequency=0,this.diff=0,this.input=new Float32Array(5).fill(0),this.output=new Float32Array(5).fill(0),this.pole=function(t){return .3*e.input[t]+e.diff*e.output[t]},this.compute=function(t,n,r){var a=Math.pow(n,2);e.diff=1-n,e.frequency=4*r*(1-.15*a),t-=e.output[4]*e.frequency,e.output[0]=.35013*Math.pow(a,2)*t;for(var i=0;i<5;i++){var o=i+1;e.output[o]=e.output[i]+e.pole(o),e.input[o]=e.output[i]}return e.output[4]}}return e.prototype.next=function(e,t,n){var r=e.enabled,a=e.cutoff,i=e.envelope,o=e.resonance;return r?this.compute(t,Math.min(1,Math.max(a+n*i,.002)),o):t},e}(),tO=function(e){var t=this;this.sampleRate=e,this.gainEnvelope=new tI,this.filterEnvelope=new tI,this.oscillators=new tA(this.sampleRate),this.filter=new tP,this.open=function(e,n){t.oscillators.open(e.wave,n),t.gainEnvelope.open(e.envelopes.gain),t.filterEnvelope.open(e.envelopes.filter)},this.next=function(e){var n=e.filter,r=e.wave,a=e.envelopes;return t.gainEnvelope.next(a.gain)*t.filter.next(n,t.oscillators.next(r),Math.pow(t.filterEnvelope.next(a.filter),4))},this.close=function(e){t.gainEnvelope.close(e.envelopes.gain),t.filterEnvelope.close(e.envelopes.filter)},this.kill=function(){t.gainEnvelope.kill(),t.filterEnvelope.kill()},this.isLive=function(){return t.gainEnvelope.live}},tF=function(){function e(e){var t=this;this.sampleRate=e,this.osc=function(e){return t.stack.filter(function(t){return e===t.isLive()})},this.clear=function(){t.stack.forEach(function(e){return e.kill()}),t.notes={}},this.next=function(e){return Math.min(Math.max(t.osc(!0).reduce(function(t,n){return t+n.next(e)},0),-1),1)},this.setNotes=function(e,n,r){null==n||n.forEach(function(n){return t.open(e,n)}),null==r||r.forEach(function(n){return t.close(e,n)})},this.stack=tT(6,function(){return new tO(t.sampleRate)}),this.notes={}}return e.prototype.newEvent=function(){var e=new tO(this.sampleRate);return this.stack.push(e),e},e.prototype.open=function(e,t){if(!this.notes[t]){var n,r=null!==(n=this.osc(!1)[0])&&void 0!==n?n:this.newEvent();this.notes[t]=r,r.open(e,t)}},e.prototype.close=function(e,t){this.notes[t]&&(this.notes[t].close(e),delete this.notes[t])},e}(),tN=function(e,t){return e.sequence.enabled?void 0:[t]},tD=function(){function e(e){this.sampleRate=e,this.sound=new tF(this.sampleRate),this.arp=new tw,this.next=this.sound.next}return e.prototype.startNote=function(e,t){this.arp.startNote(t),this.sound.setNotes(e,tN(e,t))},e.prototype.endNote=function(e,t){this.arp.endNote(t),this.sound.setNotes(e,void 0,tN(e,t))},e.prototype.destroy=function(){this.sound.clear()},e.prototype.clear=function(){this.sound.clear(),this.arp.clear()},e.prototype.nextActions=function(e,t){var n,r,a,i=this;null===(n=null==t?void 0:t.start)||void 0===n||n.forEach(function(e){return i.arp.startNote(e)}),null===(r=null==t?void 0:t.end)||void 0===r||r.forEach(function(e){return i.arp.endNote(e)});var o=null!==(a=this.arp.next(e.sequence))&&void 0!==a?a:t;this.sound.setNotes(e,null==o?void 0:o.start,null==o?void 0:o.end)},e}(),t_={id:"default",name:"prelude",wave:{sine:.2,square:1,saw:1,saw2:1,tech:0,noise:0,fm:0,fmFreq:0,offset:.75,voices:12,octave:1},envelopes:{filter:{attack:0,decay:.4,sustain:.08,release:.1},gain:{attack:0,decay:.05,sustain:.5,release:.3}},filter:{cutoff:.35,resonance:.2,envelope:.6,enabled:!1},sequence:{enabled:!1}},tL=function(){function e(e){var t=this;this.synth=e,this.loops=[],this.gain=1,this.size=0,this.preset=t_,this.startNote=function(e){return t.synth.startNote(t.preset,e)},this.endNote=function(e){return t.synth.endNote(t.preset,e)},this.nextActions=function(e,n){if(e&&n>t.size){t.clear();return}for(var r=0,a=t.loops;r<a.length;r++){var i=a[r];(i.start<=n&&n<=i.end||!e)&&t.synth.nextActions(t.preset,e?i.get(n):void 0)}},this.next=function(){return t.synth.next(t.preset)*t.gain},this.clear=function(){return t.synth.clear()},this.setNoteLoops=function(e){var n=e.loops,r=e.size;t.loops=n,t.size=r},this.setPreset=function(e){t.preset=e}}return e.prototype.setGain=function(e){this.gain=e},e}(),tB=function(e,t,n){var r=this;this.start=e,this.end=t,this.size=n,this.samples=4,this.get=function(e){var t=(e-r.offset)%r.size;return r.buffer[r.samples*t]},this.startKey=function(e,t){var n,a=r.lookup(e);a.start=null!==(n=a.start)&&void 0!==n?n:[],a.start.push(t)},this.endKey=function(e,t){var n,a=r.lookup(e);a.end=null!==(n=a.end)&&void 0!==n?n:[],a.end.push(t)},this.lookup=function(e){var t,n=e*r.samples;return r.buffer[n]=null!==(t=r.buffer[n])&&void 0!==t?t:{}},this.offset=e%n,this.buffer=Array(n*this.samples).fill(void 0)},tj=function(e,t){var n=e.flatMap(function(e){var t=e.fragmentId,n=e.start,r=e.end;return t?[{start:n,end:r,fragmentId:t}]:[]});return{loops:n.map(function(e){var n=e.end,r=e.start,a=t[e.fragmentId],i=a.notes,o=a.loop,c=o[0],s=new tB(r,n,o[1]-c);return i.forEach(function(e){var t=e.at-c;if(!(t<0)){var n=ea(e.note);s.startKey(t,n),s.endKey(t+e.length-1,n)}}),s}),size:Math.max.apply(Math,n.map(function(e){return e.end}))}},tz=function(e){var t=this;this.sampleRate=e,this.tracks=[],this.size=0,this.get=function(e){return t.tracks[e]},this.set=function(e){var n=e.tracks,r=e.midiFragments,a=e.presets,i=e.midiRefs;t.tracks=n.map(function(e,n){var r,i=e.presetId,o=e.gain,c=null!==(r=t.get(n))&&void 0!==r?r:new tL(new tD(t.sampleRate));return c.setGain(o),c.setPreset(a[i]),c}),t.setMidis(i,r)},this.nextActions=function(e,n){for(var r=0,a=t.tracks;r<a.length;r++)a[r].nextActions(e,n)},this.next=function(){for(var e=0,n=0,r=t.tracks;n<r.length;n++)e+=r[n].next();return e},this.clear=function(){for(var e=0,n=t.tracks;e<n.length;e++)n[e].clear()},this.isDone=function(e){return e>=t.size},this.setGain=function(e,n){t.tracks[e].setGain(n)},this.setMidis=function(e,n){t.tracks.forEach(function(t,r){t.setNoteLoops(tj(e.filter(function(e){return e.trackId===r}),n))}),t.size=Math.max.apply(Math,t.tracks.map(function(e){return e.size}))},this.setPreset=function(e,n){return t.get(e).setPreset(n)}},tq=function(){var e=this;this.sampleRate=44100,this.events=new tk,this.tracks=new tz(this.sampleRate),this.player=new tb(this.events,this.tracks,this.sampleRate),this.addEventListener=this.events.addEventListener,this.play=this.player.play,this.pause=this.player.pause,this.stop=this.player.stop,this.setBPM=this.player.setBPM,this.setTime=this.player.setTime,this.setGain=this.tracks.setGain,this.setMidis=this.tracks.setMidis,this.setTracks=this.tracks.set,this.setPreset=this.tracks.setPreset,this.startNote=function(t,n){return e.tracks.get(t).startNote(n)},this.endNote=function(t,n){return e.tracks.get(t).endNote(n)},this.destroy=function(){e.tracks.clear(),e.closeContext()},this.closeContext=ty(this.player)},tU=function(){return(tU=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},tG="daw-local-storage-state-v1",tK=function(e){localStorage.setItem(tG,JSON.stringify(e))},tW=function(){var e=localStorage.getItem(tG);return e?JSON.parse(e):void 0},tY=function(e,t,n){var r;return tU(tU({},e),((r={})[t]=tU(tU({},e[t]),n(e[t])),r))},tX=function(e,t,n){return{presets:tY(e,t,n)}},tH=function(e,t,n){return{tracks:e.map(function(e,r){return t===r?tU(tU({},e),n(e)):e})}},tV=function(){return(tV=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},tQ=function(e,t,n){if(n||2==arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))},tJ=function(e,t){var n,r,a,i,o=e.tracks,c=e.midiRefs,s=e.midiFragments,l=e.presets,u=e.bpm;switch(t.type){case"PRESET/SET_SEQUENCE":return tX(l,t.presetId,function(){return{sequence:t.payload}});case"PRESET/TOGGLE_MODULE":return tX(l,t.presetId,function(e){var n;return(n={})[t.id]=tV(tV({},e[t.id]),{enabled:!e[t.id].enabled}),n});case"PRESET/SET_ENVELOPE":return tX(l,t.presetId,function(e){var n,r=e.envelopes;return{envelopes:tV(tV({},r),((n={})[t.id]=tV(tV({},r[t.id]),t.payload),n))}});case"PRESET/SET_WAVE":return tX(l,t.presetId,function(e){var n,r=e.wave;return{wave:tV(tV({},r),((n={})[t.id]=t.payload,n))}});case"PRESET/SET_FILTER":return tX(l,t.presetId,function(e){var n,r=e.filter;return{filter:tV(tV({},r),((n={})[t.id]=t.payload,n))}});case"PRESET/NEW_PRESET":var d={id:crypto.randomUUID(),name:"new preset",wave:{sine:0,square:1,saw:0,saw2:0,tech:0,noise:0,fm:0,fmFreq:0,offset:0,voices:1,octave:1},envelopes:{filter:{attack:0,decay:1,sustain:1,release:1},gain:{attack:0,decay:.5,sustain:.5,release:.5}},filter:{cutoff:0,resonance:0,envelope:0,enabled:!1},sequence:{enabled:!1}};return tV(tV({},tH(o,t.trackId,function(){return{presetId:d.id}})),{presets:tV(tV({},l),((a={})[d.id]=d,a))});case"PRESET/ASSIGN_TO_TRACK":return tH(o,t.trackId,function(){return{presetId:t.presetId}});case"MIDI/SET_MIDI_REFS":return{midiRefs:t.payload};case"MIDI/SET_MIDI_REF":return n=t.id,r=function(){return t.payload},{midiRefs:c.map(function(e){return e.id===n?tU(tU({},e),r(e)):e})};case"MIDI/SET_FRAGMENT":return{midiFragments:tY(s,t.id,function(){return t.payload})};case"MIDI/NEW_FRAGMENT":return{midiFragments:tV(tV({},s),((i={})[t.payload.id]=t.payload,i))};case"TRACK/SET_TRACK":return tH(o,t.id,function(){return t.payload});case"TRACK/NEW_TRACK":return{tracks:tQ(tQ([],o,!0),[{name:"track ".concat(o.length+5),gain:1,presetId:Object.keys(l)[0]}],!1)};case"PLAYER/SET_BPM":return{bpm:t.payload};case"STORE/SAVE":return tK({tracks:o,midiRefs:c,midiFragments:s,presets:l,bpm:u});case"STORE/RESET":return localStorage.removeItem(tG),v();case"STORE/LOAD":return tV({},t.payload);default:return}},tZ=function(e){switch(e.type){case"MIDI/SET_CURRENT_FRAGMENT":return{currentFragment:e.payload};case"MIDI/NEW_FRAGMENT":return{currentFragment:e.payload.id};case"TRACK/SET_CURRENT":return{currentTrack:e.payload};default:return}},t$=function(e,t,n){var r=e.tracks,a=e.midiFragments,i=e.presets,o=e.midiRefs;switch(n.type){case"PLAYER/PLAY":return t.play();case"PLAYER/PAUSE":return t.pause();case"PLAYER/STOP":return t.stop();case"PLAYER/SET_TIME":return t.setTime(n.payload);case"PLAYER/SET_BPM":return t.setBPM(n.payload);case"MIDI/SET_MIDI_REF":case"MIDI/SET_FRAGMENT":case"MIDI/SET_MIDI_REFS":return t.setMidis(o,a);case"TRACK/SET_TRACK":return n.payload.gain?t.setGain(n.id,n.payload.gain):void 0;case"TRACK/NEW_TRACK":t.setTracks({tracks:r,midiFragments:a,presets:i,midiRefs:o});return;case"PRESET/SET_SEQUENCE":case"PRESET/TOGGLE_MODULE":case"PRESET/SET_ENVELOPE":case"PRESET/SET_WAVE":case"PRESET/SET_FILTER":case"PRESET/ASSIGN_TO_TRACK":return t.setPreset(n.trackId,i[n.presetId]);case"STORE/LOAD":t.setTracks(n.payload),t.setBPM(n.payload.bpm);return}},t0=function(e){return function(t,n){var r=tJ(t,n),a=r?tV(tV({},t),r):t;t$(a,e,n);var i=tZ(n);return i?tV(tV({},a),i):a}},t1=function(){return(t1=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},t2=function(){var e=(0,i.useRef)(function(e){return e}),t=(0,i.useRef)({startNote:function(){},endNote:function(){}}),n=(0,i.useState)(0),r=n[0],a=n[1],o=(0,i.useState)(!1),c=o[0],s=o[1];(0,i.useEffect)(function(){var n,r=new tq;return r.addEventListener("isPlayingChanged",s),r.addEventListener("timeChanged",a),t.current=r,e.current=t0(r),d({type:"STORE/LOAD",payload:null!==(n=tW())&&void 0!==n?n:u}),r.destroy},[t0]);var l=(0,i.useReducer)(e.current,v()),u=l[0],d=l[1];return t1(t1({},u),{time:r,isPlaying:c,dispatch:d,keyboard:t.current})};let t5=function(){var e=t2();return i.createElement(y.Provider,{value:e},i.createElement(tv,null))},t4=()=>(0,a.jsx)("div",{children:(0,a.jsx)(t5,{})});function t3(){return(0,a.jsx)(t4,{})}},6721:(e,t,n)=>{"use strict";n.d(t,{BS:()=>s,UT:()=>i,wu:()=>c});var r=n(4041),a=r.createContext({toPoint:function(){return{x:0,y:0}},width:0,height:0,left:0,top:0}),i=function(){return r.useContext(a)},o=function(){return{x:0,y:0}},c=function(){return r.useContext(a).toPoint},s=function(e){var t,n=e.width,i=e.height,c=e.style,s=e.children,l=e.paddingLeft,u=void 0===l?0:l,d=e.paddingTop,f=void 0===d?0:d,p=e.zoom,h=void 0===p?1:p,m=r.useState(!1)[1],v=r.useRef(null);r.useEffect(function(){return m(!0)},[]);var g=n+u,y=f+i;return r.createElement("svg",{width:g*h,height:y*h,style:c,ref:v,viewBox:[-u,-f,g,y].join(" ")},r.createElement(a.Provider,{value:{left:u,top:f,width:n,height:i,toPoint:v.current?(t=v.current,function(e){var n,r=e.clientX,a=e.clientY,i=t.createSVGPoint();return i.x=r,i.y=a,i.matrixTransform(null===(n=t.getScreenCTM())||void 0===n?void 0:n.inverse())}):o}},s))}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(9865)),_N_E=e.O()}]);