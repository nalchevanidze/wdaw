(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{9865:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(1873)}])},1873:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>t0});var r,i,o,a=n(1085),c=n(4041),s=function(e){var t=e.color,n="waveGridBig",r="waveGridSmall";return c.createElement(c.Fragment,null,c.createElement("defs",null,c.createElement("pattern",{width:"100",height:"100",patternUnits:"userSpaceOnUse",id:n},c.createElement("g",{stroke:void 0===t?"#FFEB3B":t,fill:"none",strokeWidth:.3,strokeOpacity:.3},c.createElement("pattern",{width:"10",height:"10",patternUnits:"userSpaceOnUse",id:r},c.createElement("path",{strokeWidth:.3,d:"M 10 0 L 0 0 0 10 0 0"})),c.createElement("path",{d:"M 100 0 L 0 0 0 100 0 0"}),c.createElement("rect",{width:"100",height:"100",fill:"url(#".concat(r,")")})))),c.createElement("rect",{width:"100%",height:"100%",fill:"url(#".concat(n,")")}))},l={prime:"#555",secondary:"#999",highlight:"#9cedff",button:function(e){return e?"#333":"#999"},background:"#EEE",notes:"#5596a5",notesSelected:"#03A9F4",notesBackground:"#33c8d3",black:"#1A1A1A",critical:"red"},u=[{name:"prelude",wave:{sine:.2,square:1,saw:1,saw2:1,tech:0,noise:0,fm:0,fmFreq:0,offset:.75,voices:12,octave:1},envelopes:{filter:{attack:0,decay:.4,sustain:.08,release:.1},gain:{attack:0,decay:.05,sustain:.5,release:.3}},filter:{cutoff:.35,resonance:.2,envelope:.6,enabled:!1},sequence:{enabled:!1}},{name:"pluck",wave:{sine:1,square:0,saw:.6,saw2:0,tech:.3,noise:0,fm:0,fmFreq:0,offset:0,voices:1,octave:1},envelopes:{filter:{attack:0,decay:.2,sustain:.2,release:.3},gain:{attack:0,decay:.385,sustain:.185,release:.7}},filter:{cutoff:.15,resonance:.3,envelope:.5,enabled:!0},sequence:{enabled:!0,0:[1],2:[2],6:[1],12:[2],13:[3],14:[1]}},{name:"razor",wave:{sine:1,square:0,saw:0,saw2:.125,tech:1,noise:0,fm:.7,fmFreq:.53125,offset:0,voices:3,octave:0},envelopes:{filter:{attack:0,decay:.4,sustain:.08,release:.1},gain:{attack:0,decay:.2,sustain:1,release:.05}},filter:{enabled:!1,cutoff:.5,resonance:.2,envelope:.6},sequence:{enabled:!1,0:[3],1:[1],3:[3],4:[1],6:[3],7:[1],9:[1],11:[1],12:[1],14:[3]}},{name:"wind",wave:{sine:1,square:.1,saw:.4,saw2:.125,tech:0,noise:0,fm:0,fmFreq:0,offset:.5,voices:1,octave:0},envelopes:{filter:{attack:.7,decay:.7,sustain:.08,release:.1},gain:{attack:.2,decay:.2,sustain:1,release:.3}},filter:{cutoff:.5,resonance:.2,envelope:.6,enabled:!0},sequence:{enabled:!1}},{name:"kick",wave:{sine:1,square:.1,saw:.2,saw2:0,tech:0,noise:.5,fm:0,fmFreq:0,offset:.5,voices:1,octave:0},envelopes:{filter:{attack:0,decay:.05,sustain:0,release:0},gain:{attack:0,decay:.3,sustain:.1,release:.2}},filter:{cutoff:.1,resonance:.6,envelope:.8,enabled:!0},sequence:{enabled:!1}},{name:"bass",wave:{sine:1,square:0,saw:0,saw2:.125,tech:1,noise:0,fm:.7,fmFreq:.53125,offset:0,voices:3,octave:0},envelopes:{filter:{attack:0,decay:.5,sustain:.08,release:.1},gain:{attack:0,decay:.6,sustain:.8,release:.1}},filter:{enabled:!0,cutoff:.1,resonance:.3,envelope:.3},sequence:{enabled:!1}},{name:"clap",wave:{sine:0,square:0,saw:0,saw2:0,tech:0,noise:.2,fm:0,fmFreq:0,offset:0,voices:1,octave:0},envelopes:{filter:{attack:0,decay:.4,sustain:.08,release:.1},gain:{attack:0,decay:.2,sustain:0,release:0}},filter:{cutoff:.5,resonance:.2,envelope:.6,enabled:!1},sequence:{enabled:!1}}],f=function(e,t,n){if(n||2==arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},d=function(e){var t;return null!==(t=u.find(function(t){return t.name===e}))&&void 0!==t?t:{name:e,wave:{sine:0,square:1,saw:0,saw2:0,tech:0,noise:0,fm:0,fmFreq:0,offset:0,voices:1,octave:1},envelopes:{filter:{attack:0,decay:1,sustain:1,release:1},gain:{attack:0,decay:.5,sustain:.5,release:.5}},filter:{cutoff:0,resonance:0,envelope:0,enabled:!1},sequence:{enabled:!1}}},h=function(){var e=[{name:"piano",preset:d("pluck"),midi:{start:256,end:512,loop:[0,256],notes:[{length:32,id:"F#2",at:0},{length:32,id:"A#1",at:0},{length:32,id:"F#2",at:32},{length:32,id:"A#1",at:32},{length:32,id:"D#2",at:64},{length:32,id:"C#1",at:64},{length:32,id:"D#2",at:96},{length:32,id:"F#1",at:96},{length:32,id:"F#3",at:128},{length:32,id:"A#2",at:128},{length:32,id:"F#3",at:160},{length:32,id:"A#2",at:160},{length:32,id:"D#3",at:192},{length:32,id:"C#2",at:192},{length:32,id:"D#3",at:224},{length:32,id:"F#2",at:224}]},gain:.4},{name:"bass",preset:d("bass"),gain:.3,midi:{start:0,end:512,loop:[0,128],notes:[{length:4,id:"A#1",at:6},{length:4,id:"A#1",at:12},{length:4,id:"A#1",at:20},{length:4,id:"A#1",at:36},{length:4,id:"A#1",at:44},{length:4,id:"A#1",at:52},{length:4,id:"C#2",at:70},{length:4,id:"C#2",at:76},{length:4,id:"C#2",at:84},{length:4,id:"G#1",at:92},{length:4,id:"F#2",at:100},{length:4,id:"F#2",at:108},{length:4,id:"F#2",at:116},{length:4,id:"D#2",at:124}]}},{name:"kick",preset:d("kick"),midi:{loop:[0,32],start:0,end:512,notes:[{length:4,id:"C#1",at:0},{length:4,id:"C#1",at:8},{length:4,id:"C#1",at:16},{length:4,id:"C#1",at:24}]},gain:1},{name:"clap",preset:d("clap"),midi:{loop:[32,64],start:128,end:512,notes:[{length:4,id:"C#1",at:44},{length:4,id:"C#1",at:56}]},gain:.3}];return{presets:f([],u,!0),player:{isPlaying:!1,time:0,notes:[]},bpm:120,tracks:{currentTrack:0,tracks:e}}},p=(0,c.createContext)([h(),function(){}]),v=function(){return(v=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},y=function(){var e=c.useContext(p),t=e[0],n=t.presets,r=t.tracks,i=r.currentTrack,o=r.tracks,a=e[1],s=o[i];return[v(v({},s.preset),{names:n.map(function(e){return e.name})}),a]},m=function(){return(m=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},g={label:{fontSize:"12px",margin:"0",width:"100%",textAlign:"center",textTransform:"uppercase"},toggle:function(e){return{display:"flex",height:10,cursor:e?"pointer":"default"}},button:function(e){return{display:"block",width:"7px",height:"7px",borderRadius:"50%",margin:"2px",border:"2px solid #888888",padding:"0px",cursor:"pointer",flexShrink:0,background:e?l.highlight:l.black}},grid:function(e,t){return{display:"flex",margin:"5px",justifyContent:"space-around",flexWrap:"wrap",flexShrink:"0",width:"".concat(50*e+(e-1)*20,"px"),opacity:t?1:.5}}},E=function(e){var t=e.children,n=e.label,r=e.size,i=e.color,o=e.optional,a=e.id,s=y(),l=s[0],u=s[1],f=a?l[a]:void 0,d=o&&f&&"enabled"in f&&f.enabled||!o,h=g.grid(void 0===r?1:r,d);return c.createElement("div",{style:h},c.createElement("div",{style:g.toggle(o),onClick:o?function(){return a?u({type:"TOGGLE_PANEL",id:a}):void 0}:void 0},o?c.createElement("div",{style:g.button(d)}):null,c.createElement("h3",{style:m(m({},g.label),{color:void 0===i?"#555":i})},n)),c.createElement("div",{style:h},t))},k=function(){return(k=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},x={container:{margin:"5px",flexWrap:"wrap",flexShrink:0,padding:"5px"},label:{fontSize:"12px",margin:0,width:"100%",textAlign:"center",textTransform:"uppercase",color:"#555",padding:"5px 0px"},list:{maxHeight:"70px",overflowY:"scroll",padding:"6px 20px"},button:{display:"block",color:"white",outline:"none",border:"none",padding:"2px",width:"100%",cursor:"pointer"}};let w=function(){var e=y(),t=e[0],n=t.name,r=t.names,i=e[1],o=c.useState(void 0),a=o[0],s=o[1];return c.createElement("div",{style:x.container,onMouseLeave:function(){return s(void 0)}},c.createElement("h3",{style:x.label},"Presets"),c.createElement("div",{style:x.list},r.map(function(e){return c.createElement("button",{key:e,onMouseOver:function(){return s(e)},style:k(k({},x.button),{background:a===e?"#00000010":"none",color:l.button(e===n)}),onClick:function(){return i({type:"SET_PRESET",payload:e})}},e)})))};var b=function(e){return"M"+Array.from({length:40},function(t,n){return 30+n+" "+(30+40*e(n/40))})},M=function(e){return"M"+e.map(function(e){return 30+40*e}).join(" ")},S={saw:M([0,.5,0,0,1,1,1,.5]),square:M([0,.5,0,0,.5,0,.5,1,1,1,1,.5]),saw2:M([0,.5,0,0,.5,1,.5,0,1,1,1,.5]),noise:M([0,.5,.05,.45,.1,.95,.15,.07,.2,1,.25,.26,.3,1,.35,0,.4,.8,.45,.2,.5,.81,.55,.1,.6,.8,.65,0,.7,1,.75,.46,.8,1,.85,0,.9,.96,.95,0,1,.5]),sine:b(function(e){return Math.sin(2*e*Math.PI)/2+.5}),fm:b(function(e){return Math.sin(2*e*Math.PI)/2+.5}),tech:b(function(e){return e<.15?Math.min((.05-e%.05)*50-.7,1)-.5:.5}),cutoff:"M25.03 34s11 .365 18.093-.415c7.092-.78 8.077-.095 12.153 5.524 4.075 5.618 19.06 29.97 19.06 29.97",resonance:"M25.86 65.488s17.086.177 24.168-30.246c6.56 30.48 25.135 29.14 25.135 29.14",envelope:M([0,1,.1,0,.3,.5,.5,.5,1,1]),fmFreq:"M22 49.8h6.5v20C39 71.3 37.5 30 44.3 30 51 30 50 70 56.7 70c6.7 0 2.6-39.7 6.5-40C67 30 63.8 70 70 70V50h8",offset:"M30 50 l0 10 m10-20 l0 20 m10-30 l0 30 m10-20 l0 20 m10-10 l0 10"},O=n(6721),T=function(e){return Math.min(Math.max(e,0),1)},C=function(e){return Math.max(0,e)},P=function(e,t){var n=t[0];return Math.floor(n+e*(t[1]-n))},A=function(e){var t=e.value,n=e.color,r=e.steps,i=e.range,o=e.size,a=void 0===o?50:o,s=e.onChange,l=e.x,u=e.y,f=void 0===u?0:u,d=e.bold,h=e.stepOpacity,p=c.useState(!1),v=p[0],y=p[1],m=(0,O.wu)(),g=function(){return y(!1)},E=a+(void 0===l?0:l),k=a+f,x=a*(void 0===d?.2:d),w=a-x/2,b=6*a;return c.createElement(c.Fragment,null,c.createElement("g",{fill:"none",stroke:n},c.createElement("circle",{strokeWidth:x,cx:E,cy:k,r:w,strokeDasharray:[1,2*w*Math.PI/(void 0===r?16:r)-1].toString(),opacity:void 0===h?.5:h}),c.createElement("circle",{strokeWidth:1,cx:E,cy:k,r:a,strokeOpacity:.1}),c.createElement("circle",{strokeWidth:x,strokeOpacity:.3,cx:E,cy:k,r:w,strokeDasharray:b,strokeDashoffset:b*(1-(i?(t-i[0])/(i[1]-i[0]):t))})),c.createElement("circle",{cx:E,cy:k,r:a,fillOpacity:0,onMouseLeave:g,onMouseUp:g,onMouseDown:function(){return y(!0)},onMouseMove:function(e){if(v&&s){var t=1-T(1.5*(m(e).y-f-a/2)/a);s(i?P(t,i):t)}},style:{cursor:"grab"}}))},j=function(){return(j=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},N={p:{width:"100%",textAlign:"center",margin:"0",userSelect:"none"}},B=function(e){var t=e.id,n=e.range,r=e.color,i=e.value,o=e.steps,a=e.onChange;return c.createElement("div",null,c.createElement(O.BS,{width:100,height:100,zoom:.5,style:{margin:"5px",flexShrink:0}},n?c.createElement("text",{x:"50",y:"65",fontSize:"40px",textAnchor:"middle",fill:r,style:{userSelect:"none"}},i):c.createElement("path",{fill:"none",d:S[t],strokeWidth:2,stroke:r}),c.createElement(A,{range:n,onChange:a,value:i,steps:o,color:r})),c.createElement("p",{style:j(j({},N.p),{color:r})},t))},F=function(e,t){var n=t.square,r=t.saw,i=t.saw2,o=t.tech,a=t.sine,c=t.noise,s=0;n&&(s+=n*(e>.5?1:-1)),r&&(s+=r*(1-2*e)),i&&(s+=i*(1-2*e%1*2)),o&&(s+=o*(e>.15?0:Math.min((.05-e%.05)*50-.7,1))),a&&(s+=a*Math.sin(e*Math.PI*2)),c>0&&(s+=c*(1-2*Math.random()));var l=n+r+i+o+a+c;return 0===l?0:s/(l+1)},D={main:{display:"flex",fontSize:"10px",alignItems:"flex-start"}},_=[{id:"sine"},{id:"square"},{id:"saw"},{id:"saw2"},{id:"tech"},{id:"noise"},{id:"offset"},{id:"voices",range:[1,12],steps:11},{id:"octave",range:[-4,4],steps:8}],q=[{id:"fm"},{id:"fmFreq"}],z=[{id:"cutoff"},{id:"resonance"},{id:"envelope"}],I=function(){var e=y(),t=e[0],n=t.wave,r=t.filter,i=e[1],o=function(e){return(1-F((e+n.offset)%1,n))*100},a=o(0),l=(o(1)+a)/2,u=Array.from({length:200},function(e,t){return t+" "+o(t/200)});return c.createElement("div",{style:D.main},c.createElement(E,{label:"Global",size:2},c.createElement("svg",{viewBox:"-1 0 202 200",width:"90px",height:"90px"},c.createElement("path",{d:"M 0 "+l+" "+u+" 200 "+l,stroke:"#444",strokeWidth:2,fill:"none"}),c.createElement(s,{color:"gray"})),c.createElement(w,null)),c.createElement(E,{id:"wave",label:"Oscillator",size:3},_.map(function(e){var t=e.id,r=e.range,o=e.steps;return c.createElement(B,{key:t,id:t,range:r,steps:o,color:"#555",value:n[t],onChange:function(e){return i({type:"SET_WAVE",id:t,payload:e})}})})),c.createElement(E,{id:"wave",label:"FM"},q.map(function(e){var t=e.id,r=e.range,o=e.steps;return c.createElement(B,{id:t,key:t,range:r,steps:o,color:"#555",value:n[t],onChange:function(e){return i({type:"SET_WAVE",id:t,payload:e})}})})),c.createElement(E,{id:"filter",label:"Filter",optional:!0},z.map(function(e){var t=e.id,n=e.range,o=e.steps;return c.createElement(B,{id:t,key:t,range:n,steps:o,color:"#555",value:r[t],onChange:function(e){return i({type:"SET_FILTER",id:t,payload:e})}})})))},L=function(e){var t=e.onClick,n=e.xy,r=n[0],i=n[1];return c.createElement("circle",{cx:r,cy:i,onTouchStart:t,onMouseDown:t,r:5,style:{cursor:"grabbing"}})},W=function(){return(W=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},U=function(e,t,n){if(n||2==arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},R=function(e){var t=e.attack,n=e.release,r=e.sustain,i=e.decay;return{start:[0,100],attack:[t,0],sustain:[e.sustainX,r],decay:[i,r],release:[n,100]}},G=function(e){var t=100*e.attack,n=t+100*e.decay,r=n+10,i=(1-e.sustain)*100;return{attack:t,release:r+100*e.release,sustain:i,decay:n,sustainX:r}},H="SET_ENVELOPE",K=function(e){var t=e.id,n=y(),r=n[0].envelopes,i=n[1],o=(0,O.wu)(),a=(0,c.useState)(),u=a[0],f=a[1],d=r[t],h=G(d),p=function(){return f(void 0)},v=function(e){return function(){return f(e)}},m=R(h),g=m.start,E=m.attack,k=m.decay,x=m.release,w=m.sustain;return c.createElement("g",{onMouseMove:function(e){var n=o(e),r=C(n.x/100);switch(u){case"attack":return i({type:H,id:t,payload:{attack:r}});case"decay":return i({type:"SET_ENVELOPE",id:t,payload:{decay:C(r-d.attack),sustain:1-T(n.y/100)}});case"release":return i({type:H,id:t,payload:{release:C(r-h.sustainX/100)}})}},onMouseLeave:p,onTouchEnd:p,onMouseUp:p},c.createElement(s,null),c.createElement("g",null,c.createElement("path",{stroke:l.prime,fill:l.prime,fillOpacity:"0.10",d:"M"+[g,E,k,w,x]}),c.createElement("g",{stroke:l.prime,fill:"none",strokeWidth:"0.75",strokeOpacity:.2},c.createElement("path",{d:"M"+U(U([],k,!0),[k[0],100],!1)}),c.createElement("path",{d:"M"+U([w[0],100],w,!0)}))),c.createElement("g",{fillOpacity:.8,fill:"gray",stroke:"#333"},c.createElement(L,{xy:E,onClick:v("attack")}),c.createElement(L,{xy:k,onClick:v("decay")}),c.createElement(L,{xy:x,onClick:v("release")})))};let Y=function(e){return c.createElement(O.BS,{paddingLeft:5,paddingTop:5,width:180,height:120,zoom:.8},c.createElement(K,W({},e)))};var V=function(){return(V=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},X={button:{fontSize:"11px",outline:"none",background:"none",border:"none",width:"50%",cursor:"pointer",textTransform:"uppercase"},nav:{marginTop:"10px",width:"80%"}},Q=function(e){var t=e.id,n=e.active,r=e.onClick;return c.createElement("button",{style:V(V({},X.button),{color:l.button(t===n)}),onClick:function(){return r(t)}},t)},Z=function(){var e=c.useState("gain"),t=e[0],n=e[1];return c.createElement(E,{label:"envelopes",size:3},c.createElement("div",{style:X.nav},c.createElement(Q,{id:"gain",active:t,onClick:n}),c.createElement(Q,{id:"filter",active:t,onClick:n})),c.createElement(Y,{id:t}))},J=function(){return(J=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},$=function(e,t){var n,r=t.row,i=t.column,o=null!==(n=e[r])&&void 0!==n?n:[];e[r]=o;var a=o.indexOf(i);return -1===a?o.push(i):o.splice(a,1),J({},e)},ee=function(){return(ee=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},et={li:{listStyle:"none",border:"none",outline:"none"},element:{width:"10px",border:"0.025em solid #BBB",height:"10px"},container:{display:"flex",margin:"0px",padding:"0px"}},en=function(e){var t=e.chord,n=e.onClick;return c.createElement("li",{style:et.li},[1,2,3,4].reverse().map(function(e){return c.createElement("div",{style:ee(ee({},et.element),{background:-1!==t.indexOf(e)?l.secondary:"#2220"}),key:e,onClick:function(){return n(e)}})}))},er=Array.from({length:16},function(e,t){return t}),ei=function(){var e=y(),t=e[0].sequence,n=e[1];return c.createElement(E,{label:"sequencer",size:3,optional:!0,id:"sequence"},c.createElement("ul",{style:et.container},er.map(function(e){var r;return c.createElement(en,{key:e,chord:null!==(r=t[e])&&void 0!==r?r:[],onClick:function(r){return n({type:"SET_SEQUENCE",payload:$(t,{row:e,column:r})})}})})))},eo=function(){return c.createElement("div",{style:{display:"flex",padding:"5px"}},c.createElement(I,null),c.createElement("div",null,c.createElement(Z,null),c.createElement(ei,null)))},ea=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],ec=ea.length,es=function(e){var t=ea[e%ec],n=Math.min(4,Math.floor(e/ec));return"".concat(t).concat(n)},el=function(e){var t=e.length-1,n=Math.min(4,Number(e.charAt(t)));e=e.slice(0,t);var r=ea.indexOf(e.toUpperCase());if(-1===r)throw Error("invalid Note");return r+n*ec},eu={toNote:function(e){return es(e-1)},fromNote:function(e){return el(e)+1}},ef={play:"M20 0 L 90 50 20 100Z",pause:"M30,100V0 M70,0v100",stop:"M5 5 L 95 5 95 95 5 95z",draw:"M72 15.2L20 68 14 88l19.4-6.6L90 23.6 73.7 7.8",select:"M71 71L25.4 27M58.5 27.4l-33-.7.3 34"};let ed=function(e){var t=e.id,n=e.onClick,r=e.color,i=void 0===r?l.prime:r;return c.createElement("svg",{viewBox:"0 0 100 100",width:"20px",height:"20px",onClick:n,style:{cursor:"pointer",padding:"5px"}},c.createElement("path",{stroke:i,strokeWidth:10,strokeLinecap:"round",strokeLinejoin:"round",d:ef[t],fill:"none"}))};var eh={display:"flex",background:l.background,padding:"5px",border:"0.05em solid #BBB"},ep=function(e){var t=e.actionType,n=e.dispatch;return c.createElement("section",{style:eh},c.createElement(ed,{id:"draw",color:l.button("draw"===t),onClick:function(){return n("draw")}}),c.createElement(ed,{id:"select",color:l.button("select"===t),onClick:function(){return n("select")}}))},ev=function(e){var t=e.at,n=e.strength,r=e.height,i=e.div,o=void 0===i?1:i;return c.createElement("line",{x1:t,x2:t,y1:0,y2:r?r/o:"100%",stroke:"black",fill:"none",strokeWidth:Math.pow(n/o,1.6)})},ey=function(e){var t=e.size,n=e.strength,r=e.height;return c.createElement(c.Fragment,null,c.createElement(ev,{div:1,at:0,strength:n,height:r}),c.createElement(ev,{div:4,at:t,strength:n,height:r}),c.createElement(ev,{div:6,at:2*t,strength:n,height:r}),c.createElement(ev,{div:4,at:3*t,strength:n,height:r}),c.createElement(ev,{div:2,at:4*t,strength:n,height:r}),c.createElement(ev,{div:4,at:5*t,strength:n,height:r}),c.createElement(ev,{div:6,at:6*t,strength:n,height:r}),c.createElement(ev,{div:4,at:7*t,strength:n,height:r}),c.createElement(ev,{div:1,at:8*t,strength:n,height:r}))},em=function(e){var t=e.height,n=e.size,r=e.strength,i=c.useId();return c.createElement("g",null,c.createElement("defs",null,c.createElement("pattern",{width:n,height:t,patternUnits:"userSpaceOnUse",id:i},c.createElement("rect",{width:n,height:t,fill:l.background}),c.createElement(ey,{size:n/8,strength:void 0===r?.4:r,height:t}))),c.createElement("rect",{width:"100%",height:t,y:-t,fill:"url(#".concat(i,")")}))},eg=function(e){var t=e.time,n=e.timeline,r=e.height,i=e.size;return c.createElement("g",null,c.createElement(em,{height:n,size:i}),c.createElement("line",{x1:t,x2:t,y1:-n,y2:r,stroke:"red",strokeWidth:.6}))},eE=function(e){var t=e.notes,n=e.color,r=void 0===n?l.notes:n,i=e.mouseDown,o=e.scale,a=e.height,s=e.noteHeight;return c.createElement("g",null,t.map(function(e,t){var n=e.x,u=e.length,f=a-e.y*s;return c.createElement("g",{key:t,fill:e.origin?l.notesSelected:r},c.createElement("rect",{x:n,y:f,width:u,height:s,onMouseDown:function(t){return i&&i(t,e)},stroke:"#000",strokeWidth:.25}),c.createElement("rect",{width:1,height:s,fill:"gray",fillOpacity:.1,onMouseDown:function(t){return null==o?void 0:o(t,e)},style:{cursor:"e-resize"},key:"s"+t,x:n+u-1,y:f}))}))},ek=function(e,t){var n=t[0],r=t[1];return n<e&&e<r},ex=function(e,t){return e<t?[e,t]:[t,e]},ew=function(e,t){var n=t[0],r=t[1],i=n<e[0]&&e[1]<r;return ek(n,e)||ek(r,e)||i},eb=function e(t,n){var r=this;this.map=function(t){return new e(t({x:r.x1,y:r.y1}),t({x:r.x2,y:r.y2}))},this.isOverlaping=function(e){var t=e.x1,n=e.x2,i=e.y1,o=e.y2;return ew([r.x1,r.x2],[t,n])&&ew([r.y1,r.y2],[i,o])};var i=ex(t.x,n.x),o=ex(t.y,n.y);this.x1=i[0],this.x2=i[1],this.y1=o[0],this.y2=o[1]},eM=function(e,t){return function(n){return e(eS(n,t))}},eS=function(e,t){return Math.round(e/t)*t},eO=function(e){var t,n=e[0];return Math.round(e[1].x-(null!==(t=null==n?void 0:n.x)&&void 0!==t?t:0))},eT=function(e){var t,n=e[0];return Math.round(e[1].y-(null!==(t=null==n?void 0:n.y)&&void 0!==t?t:0))},eC=function(e,t,n){if(n||2==arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},eP=function(e){var t=(0,O.wu)(),n=c.useState(),r=n[0],i=n[1],o=c.useState(void 0),a=o[0],s=o[1],l=c.useState(void 0),u=l[0],f=l[1],d=function(e,n){s(e),f(t(n))};return{area:r,start:d,end:function(){var t;i(void 0),s(void 0),f(void 0),null===(t=e.onEnd)||void 0===t||t.call(e,a)},onMove:function(n){if(a){var r=u?[u,t(n)]:void 0;switch(a){case"select":var o=r?new(eb.bind.apply(eb,eC([void 0],r,!1))):void 0;return i(o),e.onMove.select(o);case"move":if(!r)return;return e.onMove.move(eO(r),eT(r));case"scale":if(!r)return;return e.onMove.scale(eO(r))}}},onBackground:function(n){var r,i=null===(r=e.onBackground)||void 0===r?void 0:r.call(e,t(n));i&&d(i,n)},onStart:function(t){return function(n,r){var i;d(t,n),void 0!==r&&(null===(i=e.onStart)||void 0===i||i.call(e,r))}}}},eA=function(e){var t=e.x,n=e.y;return{x1:t,x2:t+e.length,y1:n-1,y2:n+1}},ej=function(e){return e.notes.map(function(e){var t=e.id,n=e.at,r=e.length;return{x:n,y:eu.fromNote(t),length:r}})},eN=function(){return(eN=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},eB=function(){var e=c.useContext(p),t=e[0].tracks,n=t.currentTrack,r=t.tracks,i=e[1],o=r[n];return[eN({id:n},o),i]},eF=function(){return(eF=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},eD=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},e_=function(e){var t=eD(e,[]);return eF(eF({},t),{origin:eF({},t)})},eq=function(e){return e.origin,eD(e,["origin"])},ez=function(e,t){void 0===t&&(t=[]);var n=e("KEY_UP"),r=e("KEY_DOWN");c.useEffect(function(){return document.addEventListener("keydown",r),document.addEventListener("keyup",n),function(){document.removeEventListener("keydown",r),document.removeEventListener("keyup",n)}},t)},eI=function(e,t){void 0===t&&(t=[]),ez(function(){return function(t){if("Backspace"===t.key)return e()}},t)},eL=function(e,t){var n=[],r=[];return e.forEach(function(e){return t(e)?n.push(e):r.push(e)}),[n,r]},eW=function(e,t,n){if(n||2==arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},eU=function(e){var t=(0,c.useState)({selected:[],inactive:e}),n=t[0],r=n.selected,i=n.inactive,o=t[1],a=eW(eW([],r,!0),i,!0),s=function(e){return o({selected:[],inactive:e.map(eq)})};return eI(function(){return s(i)},[r,i]),{reset:s,add:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o({selected:e.map(e_),inactive:a.map(eq)})},edit:function(e){return o({selected:r.map(function(t){return t.origin?eF(eF({},t),e(t.origin)):t}),inactive:i})},all:a,clear:function(){return s(a)},selectWith:function(e){var t=eL(a,e),n=t[0],r=t[1];o({selected:n.map(e_),inactive:r.map(eq)})},removeWith:function(e){return s(a.filter(function(t){return!e(t)}))},selected:r}},eR=function(){var e=eB(),t=e[0],n=t.midi,r=t.id,i=e[1],o=eU(ej(n)),a=o.all,s=o.add,l=o.clear,u=o.edit,f=o.selectWith,d=o.removeWith,h=o.reset;return c.useEffect(function(){return h(ej(n))},[n]),{clear:l,selectIn:function(e){return f(function(t){var n;return null!==(n=null==e?void 0:e.isOverlaping(eA(t)))&&void 0!==n&&n})},remove:function(e){return d(function(t){return t===e})},select:function(e){return f(function(t){return t==e})},addAt:function(e){return s({length:1,x:e.x,y:e.y})},move:function(e,t){return u(function(n){return{x:n.x+e,y:n.y-t}})},scale:function(e){return u(function(t){return{length:t.length+e}})},sync:function(){return i({id:r,type:"SET_MIDI",payload:{notes:a.map(function(e){var t=e.length,n=e.x,r=e.y;return{at:n,id:eu.toNote(r),length:t}})}})},all:a}},eG=function(){var e=(0,c.useContext)(p)[0],t=e.player,n=e.tracks,r=n.tracks[n.currentTrack].midi,i=r.start,o=r.end,a=r.loop,s=a[0],l=a[1]-s;return t.time<i||t.time>o?0:s-i%l+t.time%l},eH=function(e){var t=e.area;return c.createElement("rect",{stroke:"red",fill:"red",fillOpacity:.1,x:t.x1,y:t.y1,width:t.x2-t.x1,height:t.y2-t.y1})},eK=function(e){var t=e.opacity,n=e.height;return c.createElement("g",{fill:"black",fillOpacity:void 0===t?1:t},[1,3,5,8,10].map(function(e){return c.createElement("rect",{key:e,y:e*n,width:"100%",height:n,stroke:"none"})}))},eY=function(e){var t=e.width,n=e.ocatveHeight,r=e.count,i=e.noteHeight;return c.createElement("g",null,c.createElement("defs",null,c.createElement("pattern",{width:"100%",height:n,patternUnits:"userSpaceOnUse",id:"start_keys"},c.createElement(eK,{height:i}))),c.createElement("rect",{x:-t,width:t,height:n*r,fill:"url(#start_keys)",stroke:"none"}))},eV=function(e){var t=e.timelineHeight,n=e.loop,r=n[0],i=n[1],o=e.height,a=e.moveStart,s=e.moveEnd,u=e.controlerWidth;return c.createElement(c.Fragment,null,c.createElement("line",{x1:r,y1:0,x2:i,y2:0,stroke:l.critical,strokeWidth:.4}),c.createElement("rect",{fillOpacity:.4,y:-t,height:t,x:r-u/2,width:u,fill:l.critical,stroke:l.critical,strokeWidth:.1,onMouseDown:a}),c.createElement("rect",{fillOpacity:.4,y:-t,height:t,x:i-u/2,width:u,fill:l.critical,stroke:l.critical,strokeWidth:.1,onMouseDown:s}),c.createElement("line",{x1:i,y1:0,x2:i,y2:o,stroke:l.critical,strokeWidth:.4}),c.createElement("line",{x1:r,y1:0,x2:r,y2:o,stroke:l.critical,strokeWidth:.4}))},eX=function(){var e=eB(),t=e[0],n=t.id,r=t.midi,i=e[1],o=c.useState(void 0),a=o[0],s=o[1],l=c.useState(void 0),u=l[0],f=l[1],d=c.useState(r.loop),h=d[0],p=d[1];c.useEffect(function(){p(r.loop)},[r.loop]);var v=h[0],y=h[1];return{target:u,startMove:function(e){s("start"===e?v:y),f(e)},endMove:function(){s(void 0),f(void 0),i({id:n,type:"SET_MIDI",payload:{loop:h}})},state:h,move:function(e){if(void 0!==a){var t=h[0],n=h[1];switch(u){case"start":return p([a+e,n]);case"end":return p([t,a+e])}}}}},eQ=function(e){var t=e.strength,n=e.children,r=e.patternHeight,i=e.height,o=e.size,a=c.useId();return c.createElement("g",null,c.createElement("defs",null,c.createElement("pattern",{width:o,height:void 0===r?"100%":r,patternUnits:"userSpaceOnUse",id:a},n,c.createElement(ey,{size:o/8,strength:void 0===t?.4:t}))),c.createElement("rect",{width:"100%",height:void 0===i?"100%":i,fill:"url(#".concat(a,")")}))},eZ=function(e){var t=e.onMouseDown,n=(0,O.UT)(),r=n.height,i=n.width;return c.createElement("rect",{y:0,onMouseDown:t,height:r,width:i,opacity:0})},eJ=2*ec,e$=4*eJ,e0=(r={noteHeight:2,canvasHeight:e$},function(e){var t=e.x,n=e.y;return{x:Math.floor(t),y:Math.floor(1+(r.canvasHeight-n)/r.noteHeight)}}),e1=function(e){var t=e.actionType,n=e.loopAccuracy,r=eG(),i=eR(),o=eX(),a={draw:function(e){return i.remove(e)},select:function(e){return i.select(e)}},s=eP({onMove:{select:function(e){return i.selectIn(e?e.map(e0):void 0)},scale:i.scale,move:function(e,t){return o.target?o.move(eS(e,n)):i.move(e,Math.round(t/2))}},onBackground:{draw:function(e){return i.addAt(e0(e)),"scale"},select:function(){return i.clear(),"select"}}[t],onStart:function(e){return e.origin?void 0:a[t](e)},onEnd:function(e){return o.target?o.endMove():"select"!==e?i.sync():void 0}}),l=function(e){return function(t){o.startMove(e),s.start("move",t)}};return c.createElement("g",{onMouseMove:s.onMove,onMouseLeave:s.end,onMouseUp:s.end},c.createElement(eQ,{size:64,patternHeight:eJ,height:4*eJ},c.createElement(eK,{opacity:.07,height:2})),c.createElement(eY,{width:20,ocatveHeight:eJ,count:4,noteHeight:2}),c.createElement(eZ,{onMouseDown:s.onBackground}),c.createElement("g",null,c.createElement(eE,{noteHeight:2,height:e$,notes:i.all,mouseDown:s.onStart("move"),scale:s.onStart("scale")})),c.createElement(eg,{size:64,time:r,timeline:8,height:8+e$}),c.createElement(eV,{controlerWidth:4,timelineHeight:8,loop:o.state,height:e$,moveStart:l("start"),moveEnd:l("end")}),s.area?c.createElement(eH,{area:s.area}):null)},e2=function(){var e=c.useState("select"),t=e[0],n=e[1],r=eB()[0].midi.loop,i=(r[0],r[1]);return c.createElement(c.Fragment,null,c.createElement(ep,{actionType:t,dispatch:n}),c.createElement("div",{style:{width:"560px",overflow:"scroll",height:"350px"}},c.createElement(O.BS,{width:i+64,height:e$,paddingLeft:20,paddingTop:8,zoom:4,style:{background:"#FFF"}},c.createElement(e1,{actionType:t,loopAccuracy:8}))))},e5=function(){return(e5=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},e3=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},e4=function(e,t,n){if(n||2==arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},e6=[{id:"C"},{semi:!0,id:"C#",left:9.2},{id:"D"},{semi:!0,id:"D#",left:23.6},{id:"E"},{id:"F"},{semi:!0,id:"F#",left:52.1},{id:"G"},{semi:!0,id:"G#",left:66.5},{id:"A"},{semi:!0,id:"A#",left:81.5},{id:"B"}].map(function(e,t){return e5(e5({},e),{index:t,left:e.left?e.left+"%":void 0})}),e8=e4(e4([],e6.filter(function(e){return!e.semi}),!0),e6.filter(function(e){return e.semi}),!0),e7={display:"block",border:"none",borderBottomLeftRadius:"2px",borderBottomRightRadius:"2px",flexGrow:0,boxShadow:"1px 3px 1px rgba(0, 0, 0, 0.2)",width:"14%",paddingTop:125,background:"#EEE"},e9={li:{listStyleType:"none",cursor:"pointer",display:"flex",position:"relative",width:"300px",userSelect:"none",justifyContent:"space-between",alignItems:"start"},black:{pressedColor:"#333",base:e5(e5({},e7),{background:l.black,width:"10%",position:"absolute",paddingTop:100})},white:{base:e7,pressedColor:"#DDD"}},te=function(e){var t,n=e.index,r=e.active,i=e.keyPress,o=e.keyUp,a=e.left,s=e.semi,l=function(){return i(n)},u=function(){return o(n)},f=r.includes(n),d=s?e9.black:e9.white,h=d.base,p=d.pressedColor;return c.createElement("div",{style:e5(e5({},h),{paddingTop:f?(null!==(t=h.paddingTop)&&void 0!==t?t:0)-10:h.paddingTop,background:f?p:h.background,left:a}),onTouchStart:l,onMouseDown:l,onTouchEnd:u,onMouseUp:u})},tt=function(e){var t=e.octave,n=e3(e,["octave"]);return c.createElement("li",{style:e9.li},e8.map(function(e){var r=e.index,i=e.left,o=e.semi;return c.createElement(te,e5({key:r,semi:o,index:12*t+r,left:i},n))}))},tn=["z","s","x","d","c","v","g","b","h","n","j","m","q","2","w","3","e","r","5","t","6","y","7","u"],tr=function(e){if("number"==typeof e)return e;var t=tn.indexOf(e.key);return -1===t?void 0:t+ec},ti=function(){var e=c.useContext(p),t=e[0].player,n=e[1],r=function(e){return function(t){var r=tr(t);r&&n({type:e,payload:r})}};return ez(r),c.createElement("ul",{style:{borderTop:"2px solid #c8c8c8",display:"flex",padding:"0px",margin:"0px"}},[1,2,3].map(function(e){return c.createElement(tt,{key:e,octave:e,keyPress:r("KEY_DOWN"),keyUp:r("KEY_UP"),active:t.notes})}))},to={container:{display:"flex",background:l.background,padding:"5px",border:"0.05em solid #BBB",alignItems:"center",gap:"5px"},bpm:{display:"flex",padding:"5px",alignItems:"center",fontFamily:"sans-serif",fontSize:"14px"},bpmInput:{userSelect:"none",outline:"none",border:"0",background:l.secondary,fontSize:"14px",marginLeft:"4px",borderRadius:"3px"}},ta=function(){var e=(0,c.useContext)(p),t=e[0],n=t.player.isPlaying,r=t.bpm,i=e[1],o=function(e){return i({type:"PLAYER",payload:e})},a=function(e){i({type:"SET_BPM",payload:Math.min(Math.max(0,Number(e)),200)})};return c.createElement("section",{style:to.container},c.createElement(ed,{id:n?"pause":"play",onClick:function(){return o(n?"pause":"play")}}),c.createElement(ed,{id:"stop",onClick:function(){return o("stop")}}),c.createElement("div",{style:to.bpm},c.createElement("label",{htmlFor:"bpm-input"},"BPM"),c.createElement("input",{id:"bpm-input",type:"number",value:r,onChange:function(e){return a(e.target.value)},min:0,max:200,style:to.bpmInput})))},tc=function(e){var t=e.height,n=e.size,r=(0,O.wu)(),i=c.useContext(p),o=(i[0],i[1]),a=c.useContext(p)[0].player;return c.createElement("g",null,c.createElement(em,{height:t,size:n}),c.createElement("rect",{y:-t,height:(0,O.UT)().height+t,width:1,x:a.time,fill:l.critical}),c.createElement("rect",{fillOpacity:"0",y:-t,height:t,width:"100%",onMouseDown:function(e){return o({type:"SET_TIME",payload:Math.floor(r(e).x)})}}))},ts=function(e){var t=e.name,n=e.id,r=e.active,i=e.y,o=e.width,a=e.height,s=c.useContext(p),u=s[0].tracks,f=s[1],d=u.tracks[n].gain;return c.createElement(c.Fragment,null,c.createElement("text",{x:-(.9*o),y:i+a/2,fill:r?l.notes:"gray",fontFamily:"sanf-serif",textAnchor:"center",dominantBaseline:"middle",pointerEvents:"none",style:{userSelect:"none"}},t),c.createElement("rect",{fill:"black",opacity:r?.03:.1,y:i,x:-o,width:o,height:a,onClick:function(){return f({type:"SET_TRACK",payload:n})},style:{border:"none",cursor:"pointer"}}),c.createElement(A,{onChange:function(e){return f({type:"SET_GAIN",id:n,payload:e})},value:d,color:l.black,size:16,steps:48,y:i+a/6,x:-48,stepOpacity:.2,bold:.1}))},tl=function(){return(tl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},tu=function(e){var t=c.useContext(p),n=(t[0],t[1]),r=eU(e.map(function(e,t){return tl(tl({},e.midi),{id:t})}));c.useEffect(function(){return r.reset(e.map(function(e,t){return tl(tl({},e.midi),{id:t})}))},[e]);var i=function(){return r.selected.forEach(function(e){var t=e.start,r=e.end;n({type:"SET_MIDI",id:e.id,payload:{start:t,end:r}})})};return{all:r.all,clear:function(){i(),r.clear()},move:function(e){return r.edit(function(t){return{start:t.start+e,end:t.end+e}})},scale:function(e){return r.edit(function(t){return{start:t.start,end:t.end+e}})},select:function(e){return r.selectWith(function(t){return t.id===e})},selectIn:function(e){return function(t){return r.selectWith(function(n){var r;return null!==(r=null==t?void 0:t.isOverlaping(e(n)))&&void 0!==r&&r})}},selection:!!r.selected.length,sync:i}},tf=function(e){var t=e.midi,n=e.start,r=e.end,i=e.startMove,o=e.startScale,a=e.y,s=e.color,u=e.height,f=c.useMemo(function(){return ej(t)},[t]),d=t.loop,h=d[0],p=d[1],v=c.useId(),y=p-h,m=r-n,g=n+m;return c.createElement("g",null,c.createElement("defs",null,c.createElement("pattern",{width:y,height:u,patternUnits:"userSpaceOnUse",id:v,x:n%y},c.createElement("g",{fill:l.notes},f.map(function(e,t){return c.createElement("rect",{key:t,width:e.length,height:1,x:e.x-h,y:u-e.y})})),c.createElement("rect",{fill:s,opacity:.4,width:"100%",height:"100%"}))),c.createElement("rect",{y:a,onMouseDown:function(e){return null==i?void 0:i(e)},x:n,width:m,height:u,fill:"url(#"+v+")",stroke:l.notesBackground,strokeWidth:.3}),c.createElement("rect",{x:g-5,y:a,width:5,height:u,fill:"gray",fillOpacity:.05,onMouseDown:function(e){return null==o?void 0:o(e)},style:{cursor:"e-resize"}}))},td={container:{width:"100%",height:"auto",position:"relative"}},th=function(e){var t=e.start,n=e.end,r=e.id;return{x1:t,x2:n,y1:48*r,y2:(r+1)*48}},tp=function(){var e=c.useContext(p)[0].tracks,t=tu(e.tracks),n=t.all,r=t.clear,i=t.move,o=t.scale,a=t.select,s=t.selectIn,u=t.selection,f=t.sync,d=eP({onMove:{select:s(th),move:eM(i,8),scale:eM(o,8)},onEnd:function(e){return"select"!==e?f():void 0},onStart:function(e){u||a(e)},onBackground:function(){return console.log("background"),r(),"select"}});return c.createElement("g",{onMouseMove:d.onMove,onMouseUp:d.end},c.createElement(eZ,{onMouseDown:d.onBackground}),e.tracks.map(function(t,r){var i,o,a=t.midi,s=t.name,u=48*r,f=n.find(function(e){return e.id===r});return c.createElement("g",{key:r},c.createElement(tf,{y:u,start:null!==(i=null==f?void 0:f.start)&&void 0!==i?i:a.start,end:null!==(o=null==f?void 0:f.end)&&void 0!==o?o:a.end,midi:a,height:48,startMove:function(e){return d.onStart("move")(e,r)},startScale:function(e){return d.onStart("scale")(e,r)},color:(null==f?void 0:f.origin)?l.notesSelected:l.notesBackground}),c.createElement(ts,{active:r===e.currentTrack,name:s,id:r,width:160,y:u,height:48}))}),d.area?c.createElement(eH,{area:d.area}):null)},tv=function(){var e=c.useContext(p)[0].tracks,t=Math.max.apply(Math,e.tracks.map(function(e){return e.midi.end})),n=48*e.tracks.length;return c.createElement("div",{style:td.container},c.createElement(O.BS,{width:t+64,height:n,paddingLeft:160,paddingTop:32},c.createElement(eQ,{size:64}),c.createElement(tp,null),c.createElement(tc,{height:32,size:64})))},ty={container:{position:"relative",background:"#FFF",border:"1px solid #BBB",display:"block",borderRadius:"5px"}},tm=function(){return c.createElement("div",{style:ty.container},c.createElement(tv,null),c.createElement(ta,null))},tg={daw:{display:"flex",position:"relative",justifyContent:"center",fontFamily:"sans-serif"},synth:{position:"relative",width:"660px",height:"350px",borderRadius:"2px",background:l.background,border:"1px solid #CCC"},midi:{position:"relative"},tracks:{padding:"10px",justifyContent:"center",display:"flex",position:"relative"}},tE=function(){return c.createElement("div",null,c.createElement("div",{style:tg.daw},c.createElement("section",{style:tg.synth},c.createElement(eo,null),c.createElement(ti,null)),c.createElement("section",{style:tg.midi},c.createElement(e2,null))),c.createElement("section",{style:tg.tracks},c.createElement(tm,null)))},tk=function(){var e=this;this.open=function(t){var n=new AudioContext,r=n.createScriptProcessor(2048,1,1);r.connect(n.destination),r.onaudioprocess=function(e){for(var n=e.outputBuffer.getChannelData(0),r=n.length,i=0;i<r;++i)n[i]=t.next()},e.context=n,e.context.resume()},this.close=function(){var t;null===(t=e.context)||void 0===t||t.close()}},tx=function(e){try{var t=new tk,n=function(){t.open(e),r()},r=function(){document.removeEventListener("click",n),document.removeEventListener("keypress",n)};return document.addEventListener("click",n),document.addEventListener("keypress",n),function(){t.close(),r()}}catch(e){return console.error("could not create audio context: ",e.message),function(){}}},tw=function(){function e(e){var t=this;this.counter=0,this.subStep=0,this.setBPM=function(e){t.BPM=e,t.adjust()},this.BPM=130,this.sampleRate=e,this.adjust()}return e.prototype.adjust=function(){this.subStep=1/(60*this.sampleRate/(8*this.BPM))},e.prototype.next=function(){return this.counter+=this.subStep,this.counter>1&&(this.counter=0,!0)},e}(),tb=function(){function e(e){var t=this;this.track=e,this.current=0,this.tempo=new tw(44100),this.isPlaying=!1,this.setBPM=this.tempo.setBPM,this.next=function(){return t.tempo.next()&&(t.track.nextActions(t.isPlaying,t.current),t.isPlaying&&t.refresh(),t.isPlaying&&(t.current=t.current+1),t.track.isDone(t.current)&&(t.current=0)),t.track.next()},this.setTime=function(e){t.current=e,t.onChange({isPlaying:t.isPlaying,time:e,notes:t.track.notes()})},this.play=function(){t.isPlaying=!0,t.refresh()},this.pause=function(){t.isPlaying=!1,t.track.clear(),t.refresh()}}return e.prototype.refresh=function(){var e=this;requestAnimationFrame(function(){return e.onChange({isPlaying:e.isPlaying,time:e.current,notes:e.track.notes()})})},e.prototype.stop=function(){this.pause(),this.current=0,this.onChange({isPlaying:!1,time:0,notes:[]})},e}(),tM=function(){function e(){var e=this;this.notes=new Set([]),this.getNotes=function(){return Array.from(e.notes)},this.next=function(t){var n,r=e.notes;if(t.enabled){if(e.index%2!=0){e.index++,e.index>=32&&(e.index=0);return}var i=e.index/2,o=r.size,a=Array.from(r).sort(function(e,t){return e>t?1:-1}),c=o?null===(n=t[i])||void 0===n?void 0:n.map(function(e){return a[--e%o]+12*Math.floor(e/o)}):void 0;e.index++,e.index>=32&&(e.index=0);var s=e.last;return e.last=c,{start:c,end:s}}}}return e.prototype.startNote=function(e){this.notes.has(e)||(this.index=0),this.notes.add(e)},e.prototype.endNote=function(e){this.notes.delete(e)},e.prototype.clear=function(){this.notes.clear()},e}(),tS=function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=c(0),a.throw=c(1),a.return=c(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(c){return function(s){return function(c){if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},tO=function(e,t){return Array.from({length:e},t)};function tT(e,t,n,r){void 0===e&&(e=.5),void 0===t&&(t=1),void 0===n&&(n=0);var i,o,a=void 0===r?{}:r,c=a.power,s=void 0===c?3:c,l=a.steps,u=void 0===l?2048:l;return tS(this,function(r){switch(r.label){case 0:if(0===e)return[2,n];i=0,o=n-t,e*=u,r.label=1;case 1:if(!(++i<e))return[3,3];return[4,t+o*Math.pow(i/e,s)];case 2:return r.sent(),[3,1];case 3:return[2,n]}})}!function(e){e[e.ATTACK=0]="ATTACK",e[e.DEACY=1]="DEACY",e[e.SUSTAIN=2]="SUSTAIN",e[e.RELEASE=3]="RELEASE"}(i||(i={}));var tC=function(e){return Math.min(Math.pow(3*e,3),200)},tP=function(){var e=this;this.stage=i.ATTACK,this.level=0,this.live=!1,this.next=function(t){if(!e.live)return 0;switch(e.stage){case i.ATTACK:var n=e.iter.next(),r=n.value,o=n.done;return o&&(e.iter=tT(tC(t.decay),r,t.sustain),e.stage=i.DEACY,e.level=r),r;case i.DEACY:var a=e.iter.next(),r=a.value,o=a.done;return e.level=r,o&&(e.stage=i.SUSTAIN),r;case i.SUSTAIN:return e.level;default:var c=e.iter.next();return e.live=!c.done,c.value}},this.open=function(t){e.live=!0,e.stage=i.ATTACK,e.iter=tT(tC(t.attack),0,1)},this.close=function(t){var n=tC(t.release);e.iter=tT(n,e.level,0),e.stage=i.RELEASE},this.kill=function(){e.live=!1}},tA=function(){function e(){this.phase=0,this.length=.1,this.fmPhase=0}return e.prototype.set=function(e){this.freq=e,this.phase=Math.random(),this.length=this.freq/44100,this.fmPhase=Math.random()},e.prototype.next=function(e){var t,n=this.length,r=e.fm;if(this.phase=(this.phase+n)%1,0===r)return F(this.phase,e);var i=0===e.fmFreq?1/16:4*e.fmFreq;return this.fmPhase=this.fmPhase+n*i,F(this.phase*((Math.sin(this.fmPhase)+(t=2/Math.pow(t=r,2)))/t),e)},e}(),tj=function(){function e(){this.all=tO(12,function(){return new tA}),this.poly=[]}return e.prototype.open=function(e,t){var n=Math.min(11,Math.max(1,e.voices)),r=440*Math.pow(2,(Math.max(t+12*Math.floor(e.octave),0)-49)/12),i=Math.floor((n+1)/2),o=2*e.offset;this.poly=this.all.slice(n-1),this.poly.forEach(function(e,t){return e.set(r+(t-i)*o)})},e.prototype.next=function(e){for(var t=0,n=0,r=this.poly;n<r.length;n++)t+=r[n].next(e);return t/(this.poly.length+1)},e}(),tN=function(){function e(){var e=this;this.frequency=0,this.diff=0,this.input=new Float32Array(5).fill(0),this.output=new Float32Array(5).fill(0),this.pole=function(t){return .3*e.input[t]+e.diff*e.output[t]},this.compute=function(t,n,r){var i=Math.pow(n,2);e.diff=1-n,e.frequency=4*r*(1-.15*i),t-=e.output[4]*e.frequency,e.output[0]=.35013*Math.pow(i,2)*t;for(var o=0;o<5;o++){var a=o+1;e.output[a]=e.output[o]+e.pole(a),e.input[a]=e.output[o]}return e.output[4]}}return e.prototype.next=function(e,t,n){var r=e.enabled,i=e.cutoff,o=e.envelope,a=e.resonance;return r?this.compute(t,Math.min(1,Math.max(i+n*o,.002)),a):t},e}(),tB=function(){var e=this;this.gainEnvelope=new tP,this.filterEnvelope=new tP,this.oscillators=new tj,this.filter=new tN,this.open=function(t,n){e.oscillators.open(t.wave,n),e.gainEnvelope.open(t.envelopes.gain),e.filterEnvelope.open(t.envelopes.filter)},this.next=function(t){var n=t.filter,r=t.wave,i=t.envelopes;return e.gainEnvelope.next(i.gain)*e.filter.next(n,e.oscillators.next(r),Math.pow(e.filterEnvelope.next(i.filter),4))},this.close=function(t){e.gainEnvelope.close(t.envelopes.gain),e.filterEnvelope.close(t.envelopes.filter)},this.kill=function(){e.gainEnvelope.kill(),e.filterEnvelope.kill()},this.isLive=function(){return e.gainEnvelope.live}},tF=function(){function e(){var e=this;this.osc=function(t){return e.stack.filter(function(e){return t===e.isLive()})},this.clear=function(){e.stack.forEach(function(e){return e.kill()}),e.notes={}},this.next=function(t){return Math.min(Math.max(e.osc(!0).reduce(function(e,n){return e+n.next(t)},0),-1),1)},this.setNotes=function(t,n,r){null==n||n.forEach(function(n){return e.open(t,n)}),null==r||r.forEach(function(n){return e.close(t,n)})},this.stack=tO(6,function(){return new tB}),this.notes={}}return e.prototype.newEvent=function(){var e=new tB;return this.stack.push(e),e},e.prototype.open=function(e,t){if(!this.notes[t]){var n,r=null!==(n=this.osc(!1)[0])&&void 0!==n?n:this.newEvent();this.notes[t]=r,r.open(e,t)}},e.prototype.close=function(e,t){this.notes[t]&&(this.notes[t].close(e),delete this.notes[t])},e}(),tD=function(e,t){return e.sequence.enabled?void 0:[t]},t_=function(){function e(){var e=this;this.sound=new tF,this.arp=new tM,this.getNotes=function(){return e.arp.getNotes()},this.next=this.sound.next}return e.prototype.startNote=function(e,t){this.arp.startNote(t),this.sound.setNotes(e,tD(e,t))},e.prototype.endNote=function(e,t){this.arp.endNote(t),this.sound.setNotes(e,void 0,tD(e,t))},e.prototype.destroy=function(){this.sound.clear()},e.prototype.clear=function(){this.sound.clear(),this.arp.clear()},e.prototype.nextActions=function(e,t){var n,r,i,o=this;null===(n=null==t?void 0:t.start)||void 0===n||n.forEach(function(e){return o.arp.startNote(e)}),null===(r=null==t?void 0:t.end)||void 0===r||r.forEach(function(e){return o.arp.endNote(e)});var a=null!==(i=this.arp.next(e.sequence))&&void 0!==i?i:t;this.sound.setNotes(e,null==a?void 0:a.start,null==a?void 0:a.end)},e}();!function(e){e[e.START=0]="START",e[e.END=1]="END"}(o||(o={}));var tq=function(e,t,n){var r,i,a,c=e[t]=null!==(r=e[t])&&void 0!==r?r:{};switch(n){case o.START:var s=null!==(i=c.start)&&void 0!==i?i:[];return c.start=s,s;case o.END:var l=null!==(a=c.end)&&void 0!==a?a:[];return c.end=l,l}},tz=function(e){var t=e.notes,n=e.loop,r=n[0],i=Array(n[1]-r).fill(void 0);return t.forEach(function(e){var t=e.at-r;if(!(t<0)){var n=t+e.length-1,a=el(e.id);tq(i,t,o.START).push(a),tq(i,n,o.END).push(a)}}),i},tI=function(){function e(e){var t=this;this.synth=e,this.actions=[],this.gain=1,this.startNote=function(e){return t.synth.startNote(t.preset,e)},this.endNote=function(e){return t.synth.endNote(t.preset,e)},this.nextActions=function(e,n){var r=t.midi,i=r.start,o=r.end;if(e&&(n<i||n>o)){t.clear();return}var a=(n-t.offset)%t.loopSize;t.synth.nextActions(t.preset,e?t.actions[a]:void 0)},this.next=function(){return t.synth.next(t.preset)*t.gain},this.notes=function(){return t.synth.getNotes()},this.clear=function(){return t.synth.clear()},this.size=function(){return t.midi.end},this.setMidi=function(e){t.midi=e;var n=t.midi,r=n.start,i=n.loop,o=i[0],a=i[1];t.loopSize=a-o,t.offset=r%t.loopSize,t.actions=tz(e)},this.setPreset=function(e){t.preset=e}}return e.prototype.setGain=function(e){this.gain=e},e}(),tL=function(){function e(e){var t=this;this.tracks=e,this.setTrack=function(e){t.current=t.tracks[e],t.refresh()},this.set=function(e){var n=e.currentTrack,r=e.tracks;t.tracks=r.map(function(e){var t=new tI(new t_);return t.setMidi(e.midi),t.setPreset(e.preset),t.setGain(e.gain),t}),t.setTrack(n)},this.nextActions=function(e,n){for(var r=0,i=t.tracks;r<i.length;r++)i[r].nextActions(e,n)},this.next=function(){for(var e=0,n=0,r=t.tracks;n<r.length;n++)e+=r[n].next();return e},this.notes=function(){return t.current.notes()},this.clear=function(){for(var e=0,n=t.tracks;e<n.length;e++)n[e].clear()},this.isDone=function(e){return e>=t.size},this.setGain=function(e,n){t.tracks[e].setGain(n)},this.setMidi=function(e,n){t.tracks[e].setMidi(n),t.refresh()},this.setPreset=function(e){return t.current.setPreset(e)},this.setTrack(0)}return e.prototype.refresh=function(){this.size=Math.max.apply(Math,this.tracks.map(function(e){return e.size()}))},e}(),tW=function(){function e(){var e=this;this.tracks=new tL([]),this.player=new tb(this.tracks),this.setMidi=this.tracks.setMidi,this.setBPM=this.player.setBPM,this.setTrack=this.tracks.setTrack,this.setGain=this.tracks.setGain,this.setPreset=this.tracks.setPreset,this.setTracks=this.tracks.set,this.setTime=function(t){return e.player.setTime(t)},this.next=this.player.next,this.closeContext=tx(this)}return e.prototype.setMidiCallback=function(e){this.player.onChange=e},e.prototype.setPlay=function(e){switch(e){case"play":return this.player.play();case"pause":return this.player.pause();case"stop":return this.player.stop()}},e.prototype.startNote=function(e){this.tracks.current.startNote(e),this.player.refresh()},e.prototype.endNote=function(e){this.tracks.current.endNote(e),this.player.refresh()},e.prototype.destroy=function(){this.player.setTime(0),this.tracks.clear(),this.closeContext()},e}(),tU=function(e){var t=(0,c.useState)({reducer:function(e,t){return e}}),n=t[0],r=t[1];(0,c.useEffect)(function(){var t=new tW;return t.setTracks(o.tracks),t.setBPM(o.bpm),t.setMidiCallback(function(e){return a({type:"REFRESH",payload:e})}),r({reducer:e(t)}),function(){return t.destroy()}},[e]);var i=(0,c.useReducer)(n.reducer,h()),o=i[0],a=i[1];return[o,a]},tR=function(){return(tR=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},tG=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},tH=function(e,t,n){var r=t.tracks,i=r.tracks;return{tracks:{currentTrack:r.currentTrack,tracks:i.map(function(t,r){return e===r?n(t):t})}}},tK=function(e,t){var n;return n=function(e){var n=e.preset,r=tG(e,["preset"]);return tR(tR({},r),{preset:tR(tR({},n),t(n))})},tH(e.tracks.currentTrack,e,n)},tY=function(){return(tY=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},tV=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},tX=function(e,t){switch(t.type){case"SET_TRACK":return{tracks:tY(tY({},e.tracks),{currentTrack:t.payload})};case"SET_BPM":return{bpm:t.payload};case"SET_SEQUENCE":return tK(e,function(){return{sequence:t.payload}});case"TOGGLE_PANEL":return tK(e,function(e){var n;return"wave"===t.id?{}:((n={})[t.id]=tY(tY({},e[t.id]),{enabled:!e[t.id].enabled}),n)});case"SET_MIDI":return tH(t.id,e,function(e){var n=e.midi,r=tV(e,["midi"]);return tY(tY({},r),{midi:tY(tY({},n),t.payload)})});case"SET_GAIN":return tH(t.id,e,function(e){return tY(tY({},e),{gain:t.payload})});case"SET_ENVELOPE":return tK(e,function(e){var n,r=e.envelopes;return{envelopes:tY(tY({},r),((n={})[t.id]=tY(tY({},r[t.id]),t.payload),n))}});case"SET_WAVE":return tK(e,function(e){var n,r=e.wave;return{wave:tY(tY({},r),((n={})[t.id]=t.payload,n))}});case"SET_FILTER":return tK(e,function(e){var n,r=e.filter;return{filter:tY(tY({},r),((n={})[t.id]=t.payload,n))}});case"SET_PRESET":var n=e.presets.find(function(e){return e.name===t.payload});return n?tK(e,function(){return n}):void 0;case"REFRESH":return{player:tY(tY({},e.player),t.payload)};default:return}},tQ=function(e,t,n){switch(n.type){case"PLAYER":return t.setPlay(n.payload);case"KEY_UP":return t.endNote(n.payload);case"KEY_DOWN":return t.startNote(n.payload);case"SET_TIME":return t.setTime(n.payload);case"SET_MIDI":return t.setMidi(n.id,e.tracks.tracks[n.id].midi);case"SET_TRACK":return t.setTrack(n.payload);case"SET_GAIN":return t.setGain(n.id,n.payload);case"SET_BPM":return t.setBPM(n.payload);default:return}},tZ=function(e){return function(t,n){var r=tX(t,n);if(r){var i=t.tracks.tracks[t.tracks.currentTrack];e.setPreset(i.preset)}var o=r?tY(tY({},t),r):t;return tQ(o,e,n),o}};let tJ=function(){var e=tU(tZ),t=e[0],n=e[1];return c.createElement(p.Provider,{value:[t,n]},c.createElement(tE,null))},t$=()=>(0,a.jsx)("div",{children:(0,a.jsx)(tJ,{})});function t0(){return(0,a.jsx)(t$,{})}},6721:(e,t,n)=>{"use strict";n.d(t,{BS:()=>s,UT:()=>o,wu:()=>c});var r=n(4041),i=r.createContext({toPoint:function(){return{x:0,y:0}},width:0,height:0,left:0,top:0}),o=function(){return r.useContext(i)},a=function(){return{x:0,y:0}},c=function(){return r.useContext(i).toPoint},s=function(e){var t,n=e.width,o=e.height,c=e.style,s=e.children,l=e.paddingLeft,u=void 0===l?0:l,f=e.paddingTop,d=void 0===f?0:f,h=e.zoom,p=void 0===h?1:h,v=r.useState(!1)[1],y=r.useRef(null);r.useEffect(function(){return v(!0)},[]);var m=n+u,g=d+o;return r.createElement("svg",{width:m*p,height:g*p,style:c,ref:y,viewBox:[-u,-d,m,g].join(" ")},r.createElement(i.Provider,{value:{left:u,top:d,width:n,height:o,toPoint:y.current?(t=y.current,function(e){var n,r=e.clientX,i=e.clientY,o=t.createSVGPoint();return o.x=r,o.y=i,o.matrixTransform(null===(n=t.getScreenCTM())||void 0===n?void 0:n.inverse())}):a}},s))}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(9865)),_N_E=e.O()}]);