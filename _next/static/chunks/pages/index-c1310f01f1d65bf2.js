(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{9865:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(2019)}])},2019:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>t3});var r,i,a=n(1085),o=n(4041),c={prime:"#555",secondary:"#999",highlight:"#9cedff",button:function(e){return e?"#333":"#999"},background:"#EEE",notes:"#5596a5",notesSelected:"#03A9F4",notesBackground:"#33c8d3",black:"#1A1A1A",critical:"red"},s=function(){var e;return(e={piano:{loop:[0,256],notes:[{length:32,id:"F#2",at:0},{length:32,id:"A#1",at:0},{length:32,id:"F#2",at:32},{length:32,id:"A#1",at:32},{length:32,id:"D#2",at:64},{length:32,id:"C#1",at:64},{length:32,id:"D#2",at:96},{length:32,id:"F#1",at:96},{length:32,id:"F#3",at:128},{length:32,id:"A#2",at:128},{length:32,id:"F#3",at:160},{length:32,id:"A#2",at:160},{length:32,id:"D#3",at:192},{length:32,id:"C#2",at:192},{length:32,id:"D#3",at:224},{length:32,id:"F#2",at:224}]},bass:{loop:[0,128],notes:[{length:4,id:"A#1",at:6},{length:4,id:"A#1",at:12},{length:4,id:"A#1",at:20},{length:4,id:"A#1",at:36},{length:4,id:"A#1",at:44},{length:4,id:"A#1",at:52},{length:4,id:"C#2",at:70},{length:4,id:"C#2",at:76},{length:4,id:"C#2",at:84},{length:4,id:"G#1",at:92},{length:4,id:"F#2",at:100},{length:4,id:"F#2",at:108},{length:4,id:"F#2",at:116},{length:4,id:"D#2",at:124}]},clap1:{loop:[32,64],notes:[{length:4,id:"C#1",at:44},{length:4,id:"C#1",at:56}]}})["clap-fast"]={loop:[0,64],notes:[{length:2,id:"C#1",at:0},{length:2,id:"C#1",at:4},{length:2,id:"C#1",at:8},{length:2,id:"C#1",at:12},{length:2,id:"C#1",at:16},{length:2,id:"C#1",at:20},{length:2,id:"C#1",at:24},{length:2,id:"C#1",at:28},{length:2,id:"C#1",at:32},{length:2,id:"C#1",at:36},{length:2,id:"C#1",at:40},{length:2,id:"C#1",at:42},{length:2,id:"C#1",at:44},{length:2,id:"C#1",at:46},{length:2,id:"C#1",at:48},{length:2,id:"C#1",at:50},{length:2,id:"C#1",at:52},{length:2,id:"C#1",at:54},{length:2,id:"C#1",at:56},{length:2,id:"C#1",at:58},{length:2,id:"C#1",at:60},{length:2,id:"C#1",at:62}]},e.clap2={loop:[0,32],notes:[{length:4,id:"C#1",at:4},{length:4,id:"C#1",at:12},{length:4,id:"C#1",at:18},{length:4,id:"C#1",at:24}]},e.kick={loop:[0,32],notes:[{length:4,id:"C#1",at:0},{length:4,id:"C#1",at:8},{length:4,id:"C#1",at:16},{length:4,id:"C#1",at:24}]},e},l=function(){var e=Object.fromEntries([{name:"prelude",wave:{sine:.2,square:1,saw:1,saw2:1,tech:0,noise:0,fm:0,fmFreq:0,offset:.75,voices:12,octave:1},envelopes:{filter:{attack:0,decay:.4,sustain:.08,release:.1},gain:{attack:0,decay:.05,sustain:.5,release:.3}},filter:{cutoff:.35,resonance:.2,envelope:.6,enabled:!1},sequence:{enabled:!1}},{name:"pluck",wave:{sine:1,square:0,saw:.6,saw2:0,tech:.3,noise:0,fm:0,fmFreq:0,offset:0,voices:1,octave:1},envelopes:{filter:{attack:0,decay:.2,sustain:.2,release:.3},gain:{attack:0,decay:.385,sustain:.185,release:.7}},filter:{cutoff:.15,resonance:.3,envelope:.5,enabled:!0},sequence:{enabled:!0,0:[1],2:[2],6:[1],12:[2],13:[3],14:[1]}},{name:"razor",wave:{sine:1,square:0,saw:0,saw2:.125,tech:1,noise:0,fm:.7,fmFreq:.53125,offset:0,voices:3,octave:0},envelopes:{filter:{attack:0,decay:.4,sustain:.08,release:.1},gain:{attack:0,decay:.2,sustain:1,release:.05}},filter:{enabled:!1,cutoff:.5,resonance:.2,envelope:.6},sequence:{enabled:!1,0:[3],1:[1],3:[3],4:[1],6:[3],7:[1],9:[1],11:[1],12:[1],14:[3]}},{name:"wind",wave:{sine:1,square:.1,saw:.4,saw2:.125,tech:0,noise:0,fm:0,fmFreq:0,offset:.5,voices:1,octave:0},envelopes:{filter:{attack:.7,decay:.7,sustain:.08,release:.1},gain:{attack:.2,decay:.2,sustain:1,release:.3}},filter:{cutoff:.5,resonance:.2,envelope:.6,enabled:!0},sequence:{enabled:!1}},{name:"kick",wave:{sine:1,square:.1,saw:.2,saw2:0,tech:0,noise:.5,fm:0,fmFreq:0,offset:.5,voices:1,octave:0},envelopes:{filter:{attack:0,decay:.05,sustain:0,release:0},gain:{attack:0,decay:.3,sustain:.1,release:.2}},filter:{cutoff:.1,resonance:.6,envelope:.8,enabled:!0},sequence:{enabled:!1}},{name:"bass",wave:{sine:1,square:0,saw:0,saw2:.125,tech:1,noise:0,fm:.7,fmFreq:.53125,offset:0,voices:3,octave:0},envelopes:{filter:{attack:0,decay:.5,sustain:.08,release:.1},gain:{attack:0,decay:.6,sustain:.8,release:.1}},filter:{enabled:!0,cutoff:.1,resonance:.3,envelope:.3},sequence:{enabled:!1}},{name:"clap",wave:{sine:0,square:0,saw:0,saw2:0,tech:0,noise:.2,fm:0,fmFreq:0,offset:0,voices:1,octave:0},envelopes:{filter:{attack:0,decay:.4,sustain:.08,release:.1},gain:{attack:0,decay:.2,sustain:0,release:0}},filter:{cutoff:.5,resonance:.2,envelope:.6,enabled:!1},sequence:{enabled:!1}}].map(function(e){return[e.name,e]}));return{bpm:120,midiFragments:s(),presets:e,isPlaying:!1,time:0,tracks:[{name:"piano",presetId:"pluck",midi:[{start:256,end:512,fragmentId:"piano"}],gain:.4},{name:"bass",presetId:"bass",gain:.3,midi:[{start:0,end:512,fragmentId:"bass"}]},{name:"kick",presetId:"kick",midi:[{start:0,end:512,fragmentId:"kick"}],gain:1},{name:"clap",presetId:"clap",midi:[{start:128,end:192,fragmentId:"clap1"},{start:192,end:256,fragmentId:"clap-fast"},{start:384,end:512,fragmentId:"clap2"}],gain:.3}]}},u=function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},d=function(){return u(u({},l()),{currentTrack:0,currentFragment:"bass",notes:[]})},f=(0,o.createContext)([d(),function(){}]),h=function(){return(h=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},p=function(){var e=o.useContext(f),t=e[0],n=t.presets,r=t.currentTrack,i=t.tracks,a=e[1],c=i[r].presetId;return[h(h({},n[c]),{names:Object.keys(n)}),a]},v={container:function(e){return{display:"block",margin:"0",opacity:e?1:.5,flexShrink:0,padding:"8px"}},label:function(e){return{color:e,fontSize:"12px",margin:"0",width:"100%",textTransform:"capitalize",userSelect:"none"}},toggle:function(e){return{display:"flex",height:10,cursor:e?"pointer":"default"}},button:function(e){return{display:"block",width:"7px",height:"7px",borderRadius:"50%",margin:"2px",border:"2px solid #888888",padding:"0px",cursor:"pointer",flexShrink:0,background:e?c.highlight:c.black}},grid:function(e){return{display:"grid",margin:0,paddingTop:"12px",gap:"6px",gridTemplateColumns:Array.from({length:e},function(){return"1fr"}).join(" ")}}},m=function(e){var t=e.children,n=e.label,r=e.size,i=e.color,a=e.optional,c=e.id,s=p(),l=s[0],u=s[1],d=c?l[c]:void 0,f=a&&d&&"enabled"in d&&d.enabled||!a;return o.createElement("div",{style:v.container(f)},o.createElement("div",{style:v.toggle(a),onClick:a?function(){return c?u({type:"TOGGLE_PANEL",id:c}):void 0}:void 0},a?o.createElement("div",{style:v.button(f)}):null,o.createElement("h3",{style:v.label(void 0===i?"#555":i)},n)),o.createElement("div",{style:v.grid(void 0===r?1:r)},t))},y=function(){return(y=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},g={button:{fontSize:"10px",outline:"none",background:"none",border:"none",cursor:"pointer",textTransform:"capitalize",display:"block",color:"white",padding:"2px",userSelect:"none"}},E=function(e){var t=e.name,n=e.active,r=e.onClick;return o.createElement("button",{style:y(y({},g.button),{color:c.button(n)}),onClick:r},t)},x=function(){var e=p(),t=e[0].envelopes,n=e[1],r=o.useState("gain"),i=r[0],a=r[1],c=Object.keys(t).map(function(e){return{name:e,active:e===i}});return[{current:t[i],id:i,setEnvelope:a,options:c},n]},k=function(e){var t=e.color,n=e.width,r=e.height,i="waveGridBig",a="waveGridSmall";return o.createElement(o.Fragment,null,o.createElement("defs",null,o.createElement("pattern",{width:"100",height:"100",patternUnits:"userSpaceOnUse",id:i},o.createElement("g",{stroke:void 0===t?"#FFEB3B":t,fill:"none",strokeWidth:.3,strokeOpacity:.3},o.createElement("pattern",{width:"10",height:"10",patternUnits:"userSpaceOnUse",id:a},o.createElement("path",{strokeWidth:.3,d:"M 10 0 L 0 0 0 10 0 0"})),o.createElement("path",{d:"M 100 0 L 0 0 0 100 0 0"}),o.createElement("rect",{width:"100",height:"100",fill:"url(#".concat(a,")")})))),o.createElement("rect",{width:void 0===n?"100%":n,height:void 0===r?"100%":r,fill:"url(#".concat(i,")")}))},w=n(6721),b=function(e){return Math.min(Math.max(e,0),1)},M=function(e){return Math.max(0,e)},S=function(e,t){var n=t[0];return Math.floor(n+e*(t[1]-n))},C=function(e){var t=e.onClick,n=e.point,r=n.x,i=n.y;return o.createElement("circle",{cx:r,cy:i,onTouchStart:t,onMouseDown:t,r:5,style:{cursor:"grabbing"}})},T=function(e){var t=e.end,n=e.move,r=(0,w.wu)(),i=(0,o.useState)(),a=i[0],c=i[1];return(0,o.useEffect)(function(){if(a){var e=function(e){n(r(e),a)},i=function(){null==t||t(a),c(void 0)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",i),function(){document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",i)}}},[a]),c},O=function(){return(O=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},A=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},P=function(e){var t=e.height,n=e.width,r=e.controlers,i=e.children,a=e.onMove,s=T({move:function(e,t){return a(t,l(e))}}),l=function(e){var r=e.x,i=e.y;return{x:b(r/n),y:b(1-i/t)}},u=r.map(function(e){var r=e.x,i=e.y,a=A(e,["x","y"]);return O({x:r*n,y:(1-i)*t},a)});return o.createElement("g",null,i,o.createElement("g",{stroke:c.prime,fill:"none",strokeOpacity:.7},u.map(function(e,n){return o.createElement("path",{key:n,d:"M"+[e.x,t,e.x,e.y]})})),o.createElement("path",{stroke:c.prime,fill:c.prime,fillOpacity:.1,d:"M"+u.flatMap(function(e){return[e.x,e.y]})}),o.createElement("g",{fillOpacity:.8,fill:"gray",stroke:"#333"},u.map(function(e,t){return e.id?o.createElement(C,{point:e,key:t,onClick:function(){return s(e.id)}}):null})))},I={nav:{display:"flex",gap:"10px"}},_=function(e,t,n,r){var i=r.x,a=r.y;switch(n){case"attack":return{attack:i};case"decay":return{decay:M(i-e),sustain:a};case"release":return{release:M(i-t)};default:return{}}},N=function(e){var t=e.height,n=void 0===t?100:t,r=e.width,i=void 0===r?160:r,a=e.padding,c=void 0===a?5:a,s=x(),l=s[0],u=l.current,d=l.id,f=l.options,h=l.setEnvelope,p=s[1],v=u.attack+u.decay,y=v+.25;return o.createElement(m,{label:"envelopes",size:1},o.createElement("div",{style:I.nav},f.map(function(e){var t=e.name,n=e.active;return o.createElement(E,{key:t,name:t,active:n,onClick:function(){return h(t)}})})),o.createElement(w.BS,{paddingLeft:c,paddingTop:c,width:i+2*c,height:n+2*c,zoom:.8},o.createElement(P,{height:n,width:.8*i,onMove:function(e,t){return p({type:"SET_ENVELOPE",id:d,payload:_(u.attack,y,e,t)})},controlers:[{x:0,y:0},{id:"attack",x:u.attack,y:1},{id:"decay",x:v,y:u.sustain},{x:y,y:u.sustain},{id:"release",x:y+u.release,y:0}]},o.createElement(k,{width:i,height:n}))))},F=function(){return(F=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},R=function(e,t){var n,r=t.row,i=t.column,a=null!==(n=e[r])&&void 0!==n?n:[];e[r]=a;var o=a.indexOf(i);return -1===o?a.push(i):a.splice(o,1),F({},e)},L=Array.from({length:16},function(e,t){return t}),j=[4,3,2,1],z={li:{listStyle:"none",border:"none",outline:"none"},element:function(e){return{width:"8px",border:"0.1px solid #BBB",height:"8px",background:e?c.secondary:"#2220"}},container:{display:"flex",margin:"0px",padding:"0px"}},B=function(e){var t=e.chord,n=e.onClick;return o.createElement("li",{style:z.li},j.map(function(e){return o.createElement("div",{style:z.element(-1!==t.indexOf(e)),key:e,onClick:function(){return n(e)}})}))},D=function(){var e=p(),t=e[0].sequence,n=e[1];return o.createElement(m,{label:"sequencer",size:1,optional:!0,id:"sequence"},o.createElement("ul",{style:z.container},L.map(function(e){var r;return o.createElement(B,{key:e,chord:null!==(r=t[e])&&void 0!==r?r:[],onClick:function(r){return n({type:"SET_SEQUENCE",payload:R(t,{row:e,column:r})})}})})))},q=function(e,t){var n=t.square,r=t.saw,i=t.saw2,a=t.tech,o=t.sine,c=t.noise,s=0;n&&(s+=n*(e>.5?1:-1)),r&&(s+=r*(1-2*e)),i&&(s+=i*(1-2*e%1*2)),a&&(s+=a*(e>.15?0:Math.min((.05-e%.05)*50-.7,1))),o&&(s+=o*Math.sin(e*Math.PI*2)),c>0&&(s+=c*(1-2*Math.random()));var l=n+r+i+a+o+c;return 0===l?0:s/(l+1)},U=function(e,t){var n=function(n){return(1-q((n+e.offset)%1,e))*(t/2)},r=(n(1)+n(0))/2;return"M 0 "+r+" "+Array.from({length:t},function(e,r){return r+" "+n(r/t)})+" ".concat(t)+r},G=function(e){var t=e.quality,n=p()[0].wave;return o.createElement("svg",{viewBox:[0,0,t,t].join(" "),width:"80px",height:"80px"},o.createElement("path",{d:U(n,t),stroke:"#444",strokeWidth:2,fill:"none"}),o.createElement(k,{color:"gray"}))},W={items:{maxHeight:"100px",overflowY:"scroll",width:"100%"}},K=function(){var e=p(),t=e[0],n=t.name,r=t.names,i=e[1];return o.createElement(m,{label:"presets",size:1},o.createElement(G,{quality:200}),o.createElement("div",{style:W.items},r.map(function(e){return o.createElement(E,{name:e,key:e,active:e===n,onClick:function(){return i({type:"SET_PRESET",payload:e})}})})))},H=function(e){return"M"+Array.from({length:40},function(t,n){return 30+n+" "+(30+40*e(n/40))})},Y=function(e){return"M"+e.map(function(e){return 30+40*e}).join(" ")},V={saw:Y([0,.5,0,0,1,1,1,.5]),square:Y([0,.5,0,0,.5,0,.5,1,1,1,1,.5]),saw2:Y([0,.5,0,0,.5,1,.5,0,1,1,1,.5]),noise:Y([0,.5,.05,.45,.1,.95,.15,.07,.2,1,.25,.26,.3,1,.35,0,.4,.8,.45,.2,.5,.81,.55,.1,.6,.8,.65,0,.7,1,.75,.46,.8,1,.85,0,.9,.96,.95,0,1,.5]),sine:H(function(e){return Math.sin(2*e*Math.PI)/2+.5}),fm:H(function(e){return Math.sin(2*e*Math.PI)/2+.5}),tech:H(function(e){return e<.15?Math.min((.05-e%.05)*50-.7,1)-.5:.5}),cutoff:"M25.03 34s11 .365 18.093-.415c7.092-.78 8.077-.095 12.153 5.524 4.075 5.618 19.06 29.97 19.06 29.97",resonance:"M25.86 65.488s17.086.177 24.168-30.246c6.56 30.48 25.135 29.14 25.135 29.14",envelope:Y([0,1,.1,0,.3,.5,.5,.5,1,1]),fmFreq:"M22 49.8h6.5v20C39 71.3 37.5 30 44.3 30 51 30 50 70 56.7 70c6.7 0 2.6-39.7 6.5-40C67 30 63.8 70 70 70V50h8",offset:"M30 50 l0 10 m10-20 l0 20 m10-30 l0 30 m10-20 l0 20 m10-10 l0 10"},Q={play:"M20 0 L 90 50 20 100Z",pause:"M30,100V0 M70,0v100",stop:"M5 5 L 95 5 95 95 5 95z",draw:"M72 15.2L20 68 14 88l19.4-6.6L90 23.6 73.7 7.8",select:"M71 71L25.4 27M58.5 27.4l-33-.7.3 34"},X=function(e){var t=e.value,n=e.color,r=e.steps,i=e.range,a=e.size,c=void 0===a?50:a,s=e.onChange,l=e.x,u=e.y,d=void 0===u?0:u,f=e.bold,h=e.stepOpacity,p=T({move:function(e){var t=1-b((e.y-d)/c-.5);return null==s?void 0:s(i?S(t,i):t)}}),v=c+(void 0===l?0:l),m=c+d,y=c*(void 0===f?.2:f),g=c-y/2,E=6*c;return o.createElement(o.Fragment,null,o.createElement("g",{fill:"none",stroke:void 0===n?"#555":n},o.createElement("circle",{strokeWidth:y,cx:v,cy:m,r:g,strokeDasharray:[1,2*g*Math.PI/(void 0===r?16:r)-1].toString(),opacity:void 0===h?.5:h}),o.createElement("circle",{strokeWidth:1,cx:v,cy:m,r:c,strokeOpacity:.1}),o.createElement("circle",{strokeWidth:y,strokeOpacity:.3,cx:v,cy:m,r:g,strokeDasharray:E,strokeDashoffset:E*(1-(i?(t-i[0])/(i[1]-i[0]):t))})),o.createElement("circle",{cx:v,cy:m,r:c,fillOpacity:0,onMouseDown:function(){return p(!0)},style:{cursor:"grab"}}))},Z={label:{color:"#555",width:"100%",textAlign:"center",margin:"0",userSelect:"none"}},J=function(e){var t=e.id,n=e.range,r=e.color,i=e.value,a=e.steps,c=e.onChange;return o.createElement("div",null,o.createElement(w.BS,{width:100,height:100,zoom:.4,style:{margin:"2px"}},n?o.createElement("text",{x:"50",y:"65",fontSize:"40px",textAnchor:"middle",fill:r,style:{userSelect:"none"}},i):o.createElement("path",{fill:"none",d:V[t],strokeWidth:2,stroke:r}),o.createElement(X,{range:n,onChange:c,value:i,steps:a,color:r})),o.createElement("p",{style:Z.label},t))},$=function(e){var t=e.items,n=e.values,r=e.onChange;return o.createElement(o.Fragment,null,t.map(function(e){var t=e.id,i=e.range,a=e.steps;return o.createElement(J,{id:t,key:t,color:"#555",range:i,steps:a,value:n[t],onChange:function(e){return r(t,e)}})}))},ee={main:{display:"flex",fontSize:"10px",alignItems:"flex-start",padding:"5px"}},et=function(){var e=p(),t=e[0],n=t.wave,r=t.filter,i=e[1];return o.createElement("div",{style:ee.main},o.createElement(K,null),o.createElement(m,{id:"wave",label:"Oscillators",size:4},o.createElement($,{values:n,items:[{id:"sine"},{id:"square"},{id:"saw"},{id:"saw2"},{id:"tech"},{id:"noise"},{id:"offset"},{id:"fm"},{id:"fmFreq"},{id:"voices",range:[1,12],steps:11},{id:"octave",range:[-4,4],steps:8}],onChange:function(e,t){return i({type:"SET_WAVE",id:e,payload:t})}})),o.createElement(m,{id:"filter",label:"Filter",optional:!0},o.createElement($,{items:[{id:"cutoff"},{id:"resonance"},{id:"envelope"}],values:r,onChange:function(e,t){return i({type:"SET_FILTER",id:e,payload:t})}})),o.createElement("div",null,o.createElement(N,null),o.createElement(D,null)))},en=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],er=en.length,ei=function(e){var t=en[e%er],n=Math.min(4,Math.floor(e/er));return"".concat(t).concat(n)},ea=function(e){var t=e.length-1,n=Math.min(4,Number(e.charAt(t)));e=e.slice(0,t);var r=en.indexOf(e.toUpperCase());if(-1===r)throw Error("invalid Note");return r+n*er},eo={toNote:function(e){return ei(e-1)},fromNote:function(e){return ea(e)+1}},ec=function(e){var t=e.id,n=e.onClick,r=e.color,i=void 0===r?c.prime:r;return o.createElement("svg",{viewBox:"0 0 100 100",width:"20px",height:"20px",onClick:n,style:{cursor:"pointer",padding:"5px"}},o.createElement("path",{stroke:i,strokeWidth:10,strokeLinecap:"round",strokeLinejoin:"round",d:Q[t],fill:"none"}))},es={container:{display:"flex",background:c.background,padding:"2px",border:"0.05em solid #BBB",alignItems:"center"},label:{margin:"0px 16px",fontSize:"16px",padding:"0 24px",borderLeft:"1px solid gray"}},el=function(e){var t=e.label,n=e.actionType,r=e.dispatch;return o.createElement("section",{style:es.container},o.createElement(ec,{id:"draw",color:c.button("draw"===n),onClick:function(){return r("draw")}}),o.createElement(ec,{id:"select",color:c.button("select"===n),onClick:function(){return r("select")}}),o.createElement("p",{style:es.label},t))},eu=function(e){var t=e.at,n=e.strength,r=e.height,i=e.div,a=void 0===i?1:i;return o.createElement("line",{x1:t,x2:t,y1:0,y2:r?r/a:"100%",stroke:"black",fill:"none",strokeWidth:Math.pow(n/a,1.6)})},ed=function(e){var t=e.size,n=e.strength,r=e.height;return o.createElement(o.Fragment,null,o.createElement(eu,{div:1,at:0,strength:n,height:r}),o.createElement(eu,{div:4,at:t,strength:n,height:r}),o.createElement(eu,{div:6,at:2*t,strength:n,height:r}),o.createElement(eu,{div:4,at:3*t,strength:n,height:r}),o.createElement(eu,{div:2,at:4*t,strength:n,height:r}),o.createElement(eu,{div:4,at:5*t,strength:n,height:r}),o.createElement(eu,{div:6,at:6*t,strength:n,height:r}),o.createElement(eu,{div:4,at:7*t,strength:n,height:r}),o.createElement(eu,{div:1,at:8*t,strength:n,height:r}))},ef=function(e){var t=e.height,n=e.size,r=e.strength,i=o.useId();return o.createElement("g",null,o.createElement("defs",null,o.createElement("pattern",{width:n,height:t,patternUnits:"userSpaceOnUse",id:i},o.createElement("rect",{width:n,height:t,fill:c.background}),o.createElement(ed,{size:n/8,strength:void 0===r?.4:r,height:t}))),o.createElement("rect",{width:"100%",height:t,y:-t,fill:"url(#".concat(i,")")}))},eh=function(e){var t=e.time,n=e.timeline,r=e.height,i=e.size;return o.createElement("g",null,o.createElement(ef,{height:n,size:i}),o.createElement("line",{x1:t,x2:t,y1:-n,y2:r,stroke:"red",strokeWidth:.6}))},ep=function(e){var t=e.notes,n=e.color,r=void 0===n?c.notes:n,i=e.mouseDown,a=e.scale,s=e.height,l=e.noteHeight;return o.createElement("g",null,t.map(function(e,t){var n=e.x,u=e.length,d=s-e.y*l;return o.createElement("g",{key:t,fill:e.origin?c.notesSelected:r},o.createElement("rect",{x:n,y:d,width:u,height:l,onMouseDown:function(t){return i&&i(t,e)},stroke:"#000",strokeWidth:.25}),o.createElement("rect",{width:1,height:l,fill:"gray",fillOpacity:.1,onMouseDown:function(t){return null==a?void 0:a(t,e)},style:{cursor:"e-resize"},key:"s"+t,x:n+u-1,y:d}))}))},ev=function(e,t){var n=t[0],r=t[1];return n<e&&e<r},em=function(e,t){return e<t?[e,t]:[t,e]},ey=function(e,t){var n=t[0],r=t[1],i=n<e[0]&&e[1]<r;return ev(n,e)||ev(r,e)||i},eg=function e(t,n){var r=this;this.map=function(t){return new e(t({x:r.x1,y:r.y1}),t({x:r.x2,y:r.y2}))},this.isOverlaping=function(e){var t=e.x1,n=e.x2,i=e.y1,a=e.y2;return ey([r.x1,r.x2],[t,n])&&ey([r.y1,r.y2],[i,a])};var i=em(t.x,n.x),a=em(t.y,n.y);this.x1=i[0],this.x2=i[1],this.y1=a[0],this.y2=a[1]},eE=function(e,t){return function(n){return e(ex(n,t))}},ex=function(e,t){return Math.round(e/t)*t},ek=function(e){var t,n=e[0];return Math.round(e[1].x-(null!==(t=null==n?void 0:n.x)&&void 0!==t?t:0))},ew=function(e){var t,n=e[0];return Math.round(e[1].y-(null!==(t=null==n?void 0:n.y)&&void 0!==t?t:0))},eb=function(e,t,n){if(n||2==arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},eM=function(e){var t=(0,w.wu)(),n=o.useState(),r=n[0],i=n[1],a=o.useState(void 0),c=a[0],s=a[1],l=T({move:function(t,n){var r=c?[c,t]:void 0;switch(n){case"select":var a=r?new(eg.bind.apply(eg,eb([void 0],r,!1))):void 0;return i(a),e.onMove.select(a);case"move":if(!r)return;return e.onMove.move(ek(r),ew(r));case"scale":if(!r)return;return e.onMove.scale(ek(r))}},end:function(t){var n;i(void 0),s(void 0),null===(n=e.onEnd)||void 0===n||n.call(e,t)}}),u=function(n){return function(r,i){var a;l(n),s(t(r)),void 0!==i&&(null===(a=e.onStart)||void 0===a||a.call(e,i))}};return{area:r,onElement:u,onBackground:function(n){var r,i=null===(r=e.onBackground)||void 0===r?void 0:r.call(e,t(n));i&&u(i)(n)}}},eS=function(e){var t=e.x,n=e.y;return{x1:t,x2:t+e.length,y1:n-1,y2:n+1}},eC=function(){return(eC=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},eT=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},eO=function(e){var t=eT(e,[]);return eC(eC({},t),{origin:eC({},t)})},eA=function(e){return"origin"in e?(e.origin,eT(e,["origin"])):e},eP=function(e,t){var n=[],r=[];return e.forEach(function(e){return t(e)?n.push(e):r.push(e)}),[n,r]},eI=function(e){return e.join(":")},e_=function(e,t){void 0===t&&(t=[]);var n=e("KEY_UP"),r=e("KEY_DOWN");o.useEffect(function(){return document.addEventListener("keydown",r),document.addEventListener("keyup",n),function(){document.removeEventListener("keydown",r),document.removeEventListener("keyup",n)}},t)},eN=function(e,t){void 0===t&&(t=[]),e_(function(){return function(t){if("Backspace"===t.key)return e()}},t)},eF=function(e,t,n){if(n||2==arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},eR=function(e){return eF(eF([],e.selected,!0),e.inactive,!0)},eL=function(e,t,n){void 0===n&&(n=t);var r=(0,o.useState)({selected:[],inactive:e}),i=r[0],a=r[1],c=function(e,t){a(function(n){var r=eP(e(n),t),i=r[0],a=r[1];return{selected:i.map(eO),inactive:a.map(eA)}})},s=function(e){return a(function(t){return{selected:[],inactive:e(t).map(eA)}})};return eN(function(){return s(function(e){return e.inactive})},[i.selected,i.inactive]),(0,o.useEffect)(function(){return a(function(n){var r=eR(n);if(e.length!==r.length)return{selected:[],inactive:e.map(eA)};var i=Object.fromEntries(n.selected.map(function(e){return[t(e),e]})),a=eP(e,function(e){return!!i[t(e)]}),o=a[0],c=a[1];return{selected:o.map(eO),inactive:c.map(eA)}})},[e.map(n).join("-")]),{add:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(function(t){return{selected:e.map(eO),inactive:eR(t).map(eA)}})},edit:function(e){return a(function(t){var n=t.selected,r=t.inactive;return{selected:n.map(function(t){return t.origin?eC(eC({},t),e(t.origin)):t}),inactive:r}})},all:eR(i),clear:function(){return s(eR)},selectWith:function(e){return c(eR,e)},removeWith:function(e){return s(function(t){return eR(t).filter(function(t){return!e(t)})})},selected:i.selected,dispatcher:function(e){return function(){a(function(t){return requestAnimationFrame(function(){return e(t)}),t})}}}},ej=function(e){var t=o.useContext(f),n=t[0],r=n.currentFragment,i=n.midiFragments,a=t[1],c=null!=e?e:r,s=i[c],l=s.notes,u=s.loop,d=o.useMemo(function(){return l.map(function(e){var t=e.id,n=e.at,r=e.length;return{x:n,y:eo.fromNote(t),length:r}})},[l]),h=u[0],p=u[1];return{loopStart:h,loopEnd:p,loopWidth:p-h,notes:d,loop:u,id:c,syncNotes:function(e){return a({id:c,type:"SET_MIDI_FRAGMENT",payload:{notes:e.map(function(e){var t=e.length,n=e.x,r=e.y;return{at:n,id:eo.toNote(r),length:t}})}})},syncLoop:function(e){return a({id:c,type:"SET_MIDI_FRAGMENT",payload:{loop:e}})}}},ez=function(e,t,n){if(n||2==arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},eB=function(e){return[e.x,e.y,e.length].join(":")},eD=function(){var e=ej(),t=e.notes,n=e.syncNotes,r=eL(t,eB),i=r.all,a=r.add,o=r.clear,c=r.edit,s=r.selectWith,l=r.removeWith;return{all:i,clear:o,selectIn:function(e){return s(function(t){var n;return null!==(n=null==e?void 0:e.isOverlaping(eS(t)))&&void 0!==n&&n})},remove:function(e){return l(function(t){return t===e})},select:function(e){return s(function(t){return t==e})},addAt:function(e){return a({length:1,x:e.x,y:e.y})},move:function(e,t){return c(function(n){return{x:n.x+e,y:n.y-t}})},scale:function(e){return c(function(t){return{length:t.length+e}})},sync:(0,r.dispatcher)(function(e){return n(ez(ez([],e.selected,!0),e.inactive,!0))})}},eq=function(){var e=(0,o.useContext)(f)[0];return e.time,e.tracks,0},eU=function(e){var t=e.area;return o.createElement("rect",{stroke:"red",fill:"red",fillOpacity:.1,x:t.x1,y:t.y1,width:t.x2-t.x1,height:t.y2-t.y1})},eG=function(e){var t=e.opacity,n=e.height;return o.createElement("g",{fill:"black",fillOpacity:void 0===t?1:t},[1,3,5,8,10].map(function(e){return o.createElement("rect",{key:e,y:e*n,width:"100%",height:n,stroke:"none"})}))},eW=function(e){var t=e.width,n=e.ocatveHeight,r=e.count,i=e.noteHeight;return o.createElement("g",null,o.createElement("defs",null,o.createElement("pattern",{width:"100%",height:n,patternUnits:"userSpaceOnUse",id:"start_keys"},o.createElement(eG,{height:i}))),o.createElement("rect",{x:-t,width:t,height:n*r,fill:"url(#start_keys)",stroke:"none"}))},eK=function(e){var t=e.timelineHeight,n=e.loop,r=n[0],i=n[1],a=e.height,s=e.moveStart,l=e.moveEnd,u=e.controlerWidth;return o.createElement(o.Fragment,null,o.createElement("line",{x1:r,y1:0,x2:i,y2:0,stroke:c.critical,strokeWidth:.4}),o.createElement("rect",{fillOpacity:.4,y:-t,height:t,x:r-u/2,width:u,fill:c.critical,stroke:c.critical,strokeWidth:.1,onMouseDown:s}),o.createElement("rect",{fillOpacity:.4,y:-t,height:t,x:i-u/2,width:u,fill:c.critical,stroke:c.critical,strokeWidth:.1,onMouseDown:l}),o.createElement("line",{x1:i,y1:0,x2:i,y2:a,stroke:c.critical,strokeWidth:.4}),o.createElement("line",{x1:r,y1:0,x2:r,y2:a,stroke:c.critical,strokeWidth:.4}))},eH=function(){var e=ej(),t=e.loop,n=e.syncLoop,r=o.useState(void 0),i=r[0],a=r[1],c=o.useState(void 0),s=c[0],l=c[1],u=o.useState(t),d=u[0],f=u[1];o.useEffect(function(){return f(t)},[t]);var h=d[0],p=d[1];return{target:s,startMove:function(e){a("start"===e?h:p),l(e)},endMove:function(){a(void 0),l(void 0),n(d)},state:d,move:function(e){if(void 0!==i){var t=d[0],n=d[1];switch(s){case"start":return f([i+e,n]);case"end":return f([t,i+e])}}}}},eY=function(e){var t=e.strength,n=e.children,r=e.patternHeight,i=e.height,a=e.size,c=o.useId();return o.createElement("g",null,o.createElement("defs",null,o.createElement("pattern",{width:a,height:void 0===r?"100%":r,patternUnits:"userSpaceOnUse",id:c},n,o.createElement(ed,{size:a/8,strength:void 0===t?.4:t}))),o.createElement("rect",{width:"100%",height:void 0===i?"100%":i,fill:"url(#".concat(c,")")}))},eV=function(e){var t=e.onMouseDown,n=(0,w.UT)(),r=n.height,i=n.width;return o.createElement("rect",{y:0,onMouseDown:t,height:r,width:i,opacity:0})},eQ=2*er,eX=4*eQ,eZ=(r={noteHeight:2,canvasHeight:eX},function(e){var t=e.x,n=e.y;return{x:Math.floor(t),y:Math.floor(1+(r.canvasHeight-n)/r.noteHeight)}}),eJ=function(e){var t=e.actionType,n=e.loopAccuracy,r=eq(),i=eD(),a=eH(),c={draw:function(e){return i.remove(e)},select:function(e){return i.select(e)}},s=eM({onMove:{select:function(e){return i.selectIn(e?e.map(eZ):void 0)},scale:i.scale,move:function(e,t){return a.target?a.move(ex(e,n)):i.move(e,Math.round(t/2))}},onBackground:{draw:function(e){return i.addAt(eZ(e)),"scale"},select:function(){return i.clear(),"select"}}[t],onStart:function(e){return e.origin?void 0:c[t](e)},onEnd:function(e){return a.target?a.endMove():"select"!==e?i.sync():void 0}}),l=function(e){return function(t){a.startMove(e),s.onElement("move")(t)}};return o.createElement("g",null,o.createElement(eY,{size:64,patternHeight:eQ,height:4*eQ},o.createElement(eG,{opacity:.07,height:2})),o.createElement(eW,{width:20,ocatveHeight:eQ,count:4,noteHeight:2}),o.createElement(eV,{onMouseDown:s.onBackground}),o.createElement("g",null,o.createElement(ep,{noteHeight:2,height:eX,notes:i.all,mouseDown:s.onElement("move"),scale:s.onElement("scale")})),o.createElement(eh,{size:64,time:r,timeline:8,height:8+eX}),o.createElement(eK,{controlerWidth:4,timelineHeight:8,loop:a.state,height:eX,moveStart:l("start"),moveEnd:l("end")}),s.area?o.createElement(eU,{area:s.area}):null)},e$=function(){var e=o.useState("select"),t=e[0],n=e[1],r=ej(),i=r.id,a=r.loop;return o.createElement(o.Fragment,null,o.createElement(el,{label:i,actionType:t,dispatch:n}),o.createElement("div",{style:{width:"560px",overflow:"scroll",height:"330px"}},o.createElement(w.BS,{width:a[1]+64,height:eX,paddingLeft:20,paddingTop:8,zoom:4,style:{background:"#FFF"}},o.createElement(eJ,{actionType:t,loopAccuracy:8}))))},e0=function(){return(e0=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},e1=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},e2=function(e,t,n){if(n||2==arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},e5=[{id:"C"},{semi:!0,id:"C#",left:9.2},{id:"D"},{semi:!0,id:"D#",left:23.6},{id:"E"},{id:"F"},{semi:!0,id:"F#",left:52.1},{id:"G"},{semi:!0,id:"G#",left:66.5},{id:"A"},{semi:!0,id:"A#",left:81.5},{id:"B"}].map(function(e,t){return e0(e0({},e),{index:t,left:e.left?e.left+"%":void 0})}),e4=e2(e2([],e5.filter(function(e){return!e.semi}),!0),e5.filter(function(e){return e.semi}),!0),e3={display:"block",border:"none",borderBottomLeftRadius:"2px",borderBottomRightRadius:"2px",flexGrow:0,boxShadow:"1px 3px 1px rgba(0, 0, 0, 0.2)",width:"14%",paddingTop:125,background:"#EEE"},e6={li:{listStyleType:"none",cursor:"pointer",display:"flex",position:"relative",width:"180px",userSelect:"none",justifyContent:"space-between",alignItems:"start"},black:{pressedColor:"#333",base:e0(e0({},e3),{background:c.black,width:"10%",position:"absolute",paddingTop:100})},white:{base:e3,pressedColor:"#DDD"}},e8=function(e){var t,n=e.index,r=e.active,i=e.keyPress,a=e.keyUp,c=e.left,s=e.semi,l=function(){return i(n)},u=function(){return a(n)},d=r.includes(n),f=s?e6.black:e6.white,h=f.base,p=f.pressedColor;return o.createElement("div",{style:e0(e0({},h),{paddingTop:d?(null!==(t=h.paddingTop)&&void 0!==t?t:0)-10:h.paddingTop,background:d?p:h.background,left:c}),onTouchStart:l,onMouseDown:l,onTouchEnd:u,onMouseUp:u})},e7=function(e){var t=e.octave,n=e1(e,["octave"]);return o.createElement("li",{style:e6.li},e4.map(function(e){var r=e.index,i=e.left,a=e.semi;return o.createElement(e8,e0({key:r,semi:a,index:12*t+r,left:i},n))}))},e9=["z","s","x","d","c","v","g","b","h","n","j","m","q","2","w","3","e","r","5","t","6","y","7","u"],te=function(e){if("number"==typeof e)return e;var t=e9.indexOf(e.key);return -1===t?void 0:t+er},tt=function(){var e=o.useContext(f),t=e[0].notes,n=e[1],r=function(e){return function(t){var r=te(t);r&&n({type:e,payload:r})}};return e_(r),o.createElement("ul",{style:{borderTop:"2px solid #c8c8c8",display:"flex",padding:"0px",margin:"0px"}},[1,2,3].map(function(e){return o.createElement(e7,{key:e,octave:e,keyPress:r("KEY_DOWN"),keyUp:r("KEY_UP"),active:t})}))},tn={container:{display:"flex",background:c.background,padding:"5px",border:"0.05em solid #BBB",alignItems:"center",gap:"5px"},bpm:{display:"flex",padding:"5px",alignItems:"center",fontFamily:"sans-serif",fontSize:"14px"},bpmInput:{userSelect:"none",outline:"none",border:"0",background:c.secondary,fontSize:"14px",marginLeft:"4px",borderRadius:"3px"}},tr=function(){var e=(0,o.useContext)(f),t=e[0],n=t.isPlaying,r=t.bpm,i=e[1],a=function(e){i({type:"SET_BPM",payload:Math.min(Math.max(0,Number(e)),200)})};return o.createElement("section",{style:tn.container},o.createElement(ec,{id:n?"pause":"play",onClick:function(){return i({type:n?"PAUSE":"PLAY"})}}),o.createElement(ec,{id:"stop",onClick:function(){return i({type:"STOP"})}}),o.createElement("div",{style:tn.bpm},o.createElement("label",{htmlFor:"bpm-input"},"BPM"),o.createElement("input",{id:"bpm-input",type:"number",value:r,onChange:function(e){return a(e.target.value)},min:0,max:200,style:tn.bpmInput})))},ti=function(e){var t=e.height,n=e.size,r=(0,w.wu)(),i=o.useContext(f),a=(i[0],i[1]),s=o.useContext(f)[0].time;return o.createElement("g",null,o.createElement(ef,{height:t,size:n}),o.createElement("rect",{y:-t,height:(0,w.UT)().height+t,width:1,x:s,fill:c.critical}),o.createElement("rect",{fillOpacity:"0",y:-t,height:t,width:"100%",onMouseDown:function(e){return a({type:"SET_TIME",payload:Math.floor(r(e).x)})}}))},ta=function(e){var t=e.name,n=e.id,r=e.active,i=e.y,a=e.width,s=e.height,l=o.useContext(f),u=l[0].tracks,d=l[1],h=u[n].gain;return o.createElement(o.Fragment,null,o.createElement("text",{x:-(.9*a),y:i+s/2,fill:r?c.notes:"gray",fontFamily:"sanf-serif",textAnchor:"center",dominantBaseline:"middle",pointerEvents:"none",style:{userSelect:"none"}},t),o.createElement("rect",{fill:"black",opacity:r?.03:.1,y:i,x:-a,width:a,height:s,onClick:function(){return d({type:"SET_CURRENT_TRACK",payload:n})},style:{border:"none",cursor:"pointer"}}),o.createElement(X,{onChange:function(e){return d({type:"SET_GAIN",id:n,payload:e})},value:h,color:c.black,size:16,steps:48,y:i+s/6,x:-48,stepOpacity:.2,bold:.1}))},to=function(){return(to=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},tc=function(){var e=o.useContext(f),t=e[0],n=t.currentTrack,r=t.tracks,i=e[1],a=Math.max.apply(Math,r.flatMap(function(e){return e.midi.map(function(e){return e.end})})),c=r.length;return{panels:r.map(function(e,t){return{index:t,active:t===n,name:e.name}}),tracks:r.flatMap(function(e,t){return e.midi.map(function(e,n){return to(to({},e),{id:[t,n]})})}),currentTrack:n,setMidis:function(e){return i({type:"SET_TRACK_MIDI",payload:new Map(e.map(function(e){var t=e.id,n=e.start,r=e.end;return[eI(t),{start:n,end:r}]}))})},setCurrent:function(e){return i({type:"SET_CURRENT_FRAGMENT",payload:e})},length:a,count:c}},ts=function(){return(ts=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},tl=function(e,t,n){if(n||2==arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},tu=function(e){return function(t){return eI(e)===eI(t.id)}},td=function(e){return eI(e.id)},tf=function(e){return eI(tl(tl([],e.id,!0),[e.start,e.end,e.fragmentId],!1))},th=function(){var e=tc(),t=e.panels,n=e.tracks,r=e.setMidis,i=e.setCurrent,a=eL(n,td,tf),o=a.dispatcher(function(e){return r(e.selected)});return{panels:t,tracks:n.map(function(e){var t,n=e.id,r=e.fragmentId,i=e.start,o=e.end,c=null!==(t=a.all.find(tu(n)))&&void 0!==t?t:{id:n,fragmentId:r,start:i,end:o};return ts({selected:!!c.origin},c)}),clear:function(){o(),a.clear()},move:function(e){return a.edit(function(t){return{start:t.start+e,end:t.end+e}})},scale:function(e){return a.edit(function(t){return{start:t.start,end:t.end+e}})},select:function(e){a.selectWith(tu(e));var t,n=null===(t=a.all.find(tu(e)))||void 0===t?void 0:t.fragmentId;n&&i(n)},selectIn:function(e){return function(t){return a.selectWith(function(n){var r;return null!==(r=null==t?void 0:t.isOverlaping(e(n)))&&void 0!==r&&r})}},isSelected:function(e){return!!a.selected.find(tu(e))},sync:o}},tp=function(e){var t=e.fragmentId,n=e.start,r=e.end,i=e.startMove,a=e.startScale,s=e.y,l=e.color,u=e.height,d=ej(t),f=d.notes,h=d.loopStart,p=d.loopWidth,v=o.useId(),m=r-n,y=n+m;return o.createElement("g",null,o.createElement("defs",null,o.createElement("pattern",{width:p,height:u,patternUnits:"userSpaceOnUse",id:v,x:n%p},o.createElement("g",{fill:c.notes},f.map(function(e,t){return o.createElement("rect",{key:t,width:e.length,height:1,x:e.x-h,y:u-e.y})})),o.createElement("rect",{fill:l,opacity:.4,width:"100%",height:"100%"}))),o.createElement("text",{color:c.black,x:n+4,y:s+u/3,fontSize:"8px",textAnchor:"start",fontFamily:"sans-serif",opacity:.6,width:m},t),o.createElement("rect",{y:s,onMouseDown:function(e){return null==i?void 0:i(e)},x:n,width:m,height:u,fill:"url(#"+v+")",stroke:c.notesBackground,strokeWidth:.3}),o.createElement("rect",{x:y-5,y:s,width:5,height:u,fill:"gray",fillOpacity:.05,onMouseDown:function(e){return null==a?void 0:a(e)},style:{cursor:"e-resize"}}))},tv={container:{width:"100%",height:"auto",position:"relative"}},tm=function(e){var t=e.start,n=e.end,r=e.id,i=r[0];return r[1],{x1:t,x2:n,y1:48*i,y2:(i+1)*48}},ty=function(){var e=th(),t=e.tracks,n=e.panels,r=e.clear,i=e.move,a=e.scale,s=e.select,l=e.selectIn,u=e.isSelected,d=e.sync,f=eM({onMove:{select:l(tm),move:eE(i,8),scale:eE(a,8)},onEnd:function(e){return"select"!==e?d():void 0},onStart:function(e){u(e)||s(e)},onBackground:function(){return r(),"select"}});return o.createElement("g",null,o.createElement(eV,{onMouseDown:f.onBackground}),t.map(function(e,t){var n=e.fragmentId,r=e.start,i=e.end,a=e.id,s=e.selected;return o.createElement(tp,{key:t,y:48*a[0],start:r,end:i,fragmentId:n,height:48,startMove:function(e){return f.onElement("move")(e,a)},startScale:function(e){return f.onElement("scale")(e,a)},color:s?c.notesSelected:c.notesBackground})}),n.map(function(e){var t=e.name,n=e.index,r=e.active;return o.createElement(ta,{key:n,active:r,name:t,id:n,width:160,y:48*n,height:48})}),f.area?o.createElement(eU,{area:f.area}):null)},tg=function(){var e=tc(),t=e.count,n=e.length;return o.createElement("div",{style:tv.container},o.createElement(w.BS,{width:n+64,height:48*t,paddingLeft:160,paddingTop:32},o.createElement(eY,{size:64}),o.createElement(ty,null),o.createElement(ti,{height:32,size:64})))},tE={container:{position:"relative",background:"#FFF",border:"1px solid #BBB",display:"block",borderRadius:"5px"}},tx=function(){return o.createElement("div",{style:tE.container},o.createElement(tg,null),o.createElement(tr,null))},tk={daw:{display:"flex",position:"relative",justifyContent:"center",fontFamily:"sans-serif"},synth:{position:"relative",width:"540px",height:"340px",borderRadius:"2px",background:c.background,border:"1px solid #CCC"},midi:{position:"relative"},tracks:{padding:"10px",justifyContent:"center",display:"flex",position:"relative"}},tw=function(){return o.createElement("div",null,o.createElement("div",{style:tk.daw},o.createElement("section",{style:tk.synth},o.createElement(et,null),o.createElement(tt,null)),o.createElement("section",{style:tk.midi},o.createElement(e$,null))),o.createElement("section",{style:tk.tracks},o.createElement(tx,null)))},tb=function(){var e=this;this.open=function(t){var n=new AudioContext,r=n.createScriptProcessor(2048,1,1);r.connect(n.destination),r.onaudioprocess=function(e){for(var n=e.outputBuffer.getChannelData(0),r=n.length,i=0;i<r;++i)n[i]=t.next()},e.context=n,e.context.resume()},this.close=function(){var t;null===(t=e.context)||void 0===t||t.close()}},tM=function(e){try{var t=new tb,n=function(){t.open(e),r()},r=function(){document.removeEventListener("click",n),document.removeEventListener("keypress",n)};return document.addEventListener("click",n),document.addEventListener("keypress",n),function(){t.close(),r()}}catch(e){return console.error("could not create audio context: ",e),function(){}}},tS={isPlayingChanged:function(e){return"boolean"==typeof e?e:void 0},timeChanged:function(e){return"number"==typeof e?e:void 0}},tC=function(){var e=this;this.target=new EventTarget,this.dispatch=function(t,n){return e.target.dispatchEvent(new CustomEvent(t,{detail:n}))},this.addEventListener=function(t,n){return e.target.addEventListener(t,function(e){if(e instanceof CustomEvent){var r=tS[t](e.detail);return void 0===r?void 0:n(r)}})}},tT=function(){function e(e){var t=this;this.sampleRate=e,this.counter=0,this.subStep=0,this.size=1,this.setBPM=function(e){t.BPM=e,t.adjust()},this.BPM=130,this.adjust()}return e.prototype.adjust=function(){var e=60*this.sampleRate/(8*this.BPM);this.subStep=1/e},e.prototype.next=function(){return this.counter+=this.subStep,this.counter>this.size&&(this.counter=0,!0)},e}(),tO=function(){function e(e,t,n){var r=this;this.events=e,this.tracks=t,this.sampleRate=n,this.isPlaying=!1,this.time=0,this.tempo=new tT(this.sampleRate),this.setTime=function(e){r.time=e,r.events.dispatch("timeChanged",e)},this.setBPM=this.tempo.setBPM,this.next=function(){return r.tempo.next()&&(r.tracks.nextActions(r.isPlaying,r.time),r.isPlaying&&r.setTime(r.time+r.tempo.size),r.tracks.isDone(r.time)&&r.setTime(0)),r.tracks.next()},this.play=function(){r.setIsPlaying(!0)},this.pause=function(){r.setIsPlaying(!1),r.tracks.clear()}}return e.prototype.setIsPlaying=function(e){this.isPlaying=e,this.events.dispatch("isPlayingChanged",e)},e.prototype.stop=function(){this.setTime(0),this.pause()},e}(),tA=function(){function e(){var e=this;this.index=0,this.notes=new Set([]),this.next=function(t){var n,r=e.notes;if(t.enabled){if(e.index%2!=0){e.index++,e.index>=32&&(e.index=0);return}var i=e.index/2,a=r.size,o=Array.from(r).sort(function(e,t){return e>t?1:-1}),c=a?null===(n=t[i])||void 0===n?void 0:n.map(function(e){return o[--e%a]+12*Math.floor(e/a)}):void 0;e.index++,e.index>=32&&(e.index=0);var s=e.last;return e.last=c,{start:c,end:s}}}}return e.prototype.startNote=function(e){this.notes.has(e)||(this.index=0),this.notes.add(e)},e.prototype.endNote=function(e){this.notes.delete(e)},e.prototype.clear=function(){this.notes.clear()},e}(),tP=function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=c(0),o.throw=c(1),o.return=c(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},tI=function(e,t){return Array.from({length:e},t)};function t_(e,t,n,r){void 0===e&&(e=.5),void 0===t&&(t=1),void 0===n&&(n=0);var i,a,o=void 0===r?{}:r,c=o.power,s=void 0===c?3:c,l=o.steps,u=void 0===l?2048:l;return tP(this,function(r){switch(r.label){case 0:if(0===e)return[2,n];i=0,a=n-t,e*=u,r.label=1;case 1:if(!(++i<e))return[3,3];return[4,t+a*Math.pow(i/e,s)];case 2:return r.sent(),[3,1];case 3:return[2,n]}})}!function(e){e[e.ATTACK=0]="ATTACK",e[e.DEACY=1]="DEACY",e[e.SUSTAIN=2]="SUSTAIN",e[e.RELEASE=3]="RELEASE"}(i||(i={}));var tN=function(e){return Math.min(Math.pow(3*e,3),200)},tF=function(){var e=this;this.stage=i.ATTACK,this.level=0,this.live=!1,this.next=function(t){if(!e.live||!e.iter)return 0;switch(e.stage){case i.ATTACK:var n=e.iter.next(),r=n.value,a=n.done;return a&&(e.iter=t_(tN(t.decay),r,t.sustain),e.stage=i.DEACY,e.level=r),r;case i.DEACY:var o=e.iter.next(),r=o.value,a=o.done;return e.level=r,a&&(e.stage=i.SUSTAIN),r;case i.SUSTAIN:return e.level;default:var c=e.iter.next();return e.live=!c.done,c.value}},this.open=function(t){e.live=!0,e.stage=i.ATTACK,e.iter=t_(tN(t.attack),0,1)},this.close=function(t){var n=tN(t.release);e.iter=t_(n,e.level,0),e.stage=i.RELEASE},this.kill=function(){e.live=!1}},tR=function(){function e(e){this.sampleRate=e,this.phase=0,this.length=.1,this.fmPhase=0,this.freq=0}return e.prototype.set=function(e){this.freq=e,this.phase=Math.random(),this.length=this.freq/this.sampleRate,this.fmPhase=Math.random()},e.prototype.next=function(e){var t,n=this.length,r=e.fm;if(this.phase=(this.phase+n)%1,0===r)return q(this.phase,e);var i=0===e.fmFreq?1/16:4*e.fmFreq;return this.fmPhase=this.fmPhase+n*i,q(this.phase*((Math.sin(this.fmPhase)+(t=2/Math.pow(t=r,2)))/t),e)},e}(),tL=function(){function e(e){var t=this;this.sampleRate=e,this.all=tI(12,function(){return new tR(t.sampleRate)}),this.poly=[]}return e.prototype.open=function(e,t){var n=Math.min(11,Math.max(1,e.voices)),r=440*Math.pow(2,(Math.max(t+12*Math.floor(e.octave),0)-49)/12),i=Math.floor((n+1)/2),a=2*e.offset;this.poly=this.all.slice(n-1),this.poly.forEach(function(e,t){return e.set(r+(t-i)*a)})},e.prototype.next=function(e){for(var t=0,n=0,r=this.poly;n<r.length;n++)t+=r[n].next(e);return t/(this.poly.length+1)},e}(),tj=function(){function e(){var e=this;this.frequency=0,this.diff=0,this.input=new Float32Array(5).fill(0),this.output=new Float32Array(5).fill(0),this.pole=function(t){return .3*e.input[t]+e.diff*e.output[t]},this.compute=function(t,n,r){var i=Math.pow(n,2);e.diff=1-n,e.frequency=4*r*(1-.15*i),t-=e.output[4]*e.frequency,e.output[0]=.35013*Math.pow(i,2)*t;for(var a=0;a<5;a++){var o=a+1;e.output[o]=e.output[a]+e.pole(o),e.input[o]=e.output[a]}return e.output[4]}}return e.prototype.next=function(e,t,n){var r=e.enabled,i=e.cutoff,a=e.envelope,o=e.resonance;return r?this.compute(t,Math.min(1,Math.max(i+n*a,.002)),o):t},e}(),tz=function(e){var t=this;this.sampleRate=e,this.gainEnvelope=new tF,this.filterEnvelope=new tF,this.oscillators=new tL(this.sampleRate),this.filter=new tj,this.open=function(e,n){t.oscillators.open(e.wave,n),t.gainEnvelope.open(e.envelopes.gain),t.filterEnvelope.open(e.envelopes.filter)},this.next=function(e){var n=e.filter,r=e.wave,i=e.envelopes;return t.gainEnvelope.next(i.gain)*t.filter.next(n,t.oscillators.next(r),Math.pow(t.filterEnvelope.next(i.filter),4))},this.close=function(e){t.gainEnvelope.close(e.envelopes.gain),t.filterEnvelope.close(e.envelopes.filter)},this.kill=function(){t.gainEnvelope.kill(),t.filterEnvelope.kill()},this.isLive=function(){return t.gainEnvelope.live}},tB=function(){function e(e){var t=this;this.sampleRate=e,this.osc=function(e){return t.stack.filter(function(t){return e===t.isLive()})},this.clear=function(){t.stack.forEach(function(e){return e.kill()}),t.notes={}},this.next=function(e){return Math.min(Math.max(t.osc(!0).reduce(function(t,n){return t+n.next(e)},0),-1),1)},this.setNotes=function(e,n,r){null==n||n.forEach(function(n){return t.open(e,n)}),null==r||r.forEach(function(n){return t.close(e,n)})},this.stack=tI(6,function(){return new tz(t.sampleRate)}),this.notes={}}return e.prototype.newEvent=function(){var e=new tz(this.sampleRate);return this.stack.push(e),e},e.prototype.open=function(e,t){if(!this.notes[t]){var n,r=null!==(n=this.osc(!1)[0])&&void 0!==n?n:this.newEvent();this.notes[t]=r,r.open(e,t)}},e.prototype.close=function(e,t){this.notes[t]&&(this.notes[t].close(e),delete this.notes[t])},e}(),tD=function(e,t){return e.sequence.enabled?void 0:[t]},tq=function(){function e(e){this.sampleRate=e,this.sound=new tB(this.sampleRate),this.arp=new tA,this.next=this.sound.next}return e.prototype.startNote=function(e,t){this.arp.startNote(t),this.sound.setNotes(e,tD(e,t))},e.prototype.endNote=function(e,t){this.arp.endNote(t),this.sound.setNotes(e,void 0,tD(e,t))},e.prototype.destroy=function(){this.sound.clear()},e.prototype.clear=function(){this.sound.clear(),this.arp.clear()},e.prototype.nextActions=function(e,t){var n,r,i,a=this;null===(n=null==t?void 0:t.start)||void 0===n||n.forEach(function(e){return a.arp.startNote(e)}),null===(r=null==t?void 0:t.end)||void 0===r||r.forEach(function(e){return a.arp.endNote(e)});var o=null!==(i=this.arp.next(e.sequence))&&void 0!==i?i:t;this.sound.setNotes(e,null==o?void 0:o.start,null==o?void 0:o.end)},e}(),tU=function(){function e(e,t){var n=this;this.synth=e,this.preset=t,this.loops=[],this.gain=1,this.size=0,this.startNote=function(e){return n.synth.startNote(n.preset,e)},this.endNote=function(e){return n.synth.endNote(n.preset,e)},this.nextActions=function(e,t){if(e&&t>n.size){n.clear();return}for(var r=0,i=n.loops;r<i.length;r++){var a=i[r];(a.start<=t&&t<=a.end||!e)&&n.synth.nextActions(n.preset,e?a.get(t):void 0)}},this.next=function(){return n.synth.next(n.preset)*n.gain},this.clear=function(){return n.synth.clear()},this.setNoteLoops=function(e){var t=e.loops,r=e.size;n.loops=t,n.size=r},this.setPreset=function(e){n.preset=e}}return e.prototype.setGain=function(e){this.gain=e},e}(),tG=function(e,t,n){var r=this;this.start=e,this.end=t,this.size=n,this.samples=4,this.get=function(e){var t=(e-r.offset)%r.size;return r.buffer[r.samples*t]},this.startKey=function(e,t){var n,i=r.lookup(e);i.start=null!==(n=i.start)&&void 0!==n?n:[],i.start.push(t)},this.endKey=function(e,t){var n,i=r.lookup(e);i.end=null!==(n=i.end)&&void 0!==n?n:[],i.end.push(t)},this.lookup=function(e){var t,n=e*r.samples;return r.buffer[n]=null!==(t=r.buffer[n])&&void 0!==t?t:{}},this.offset=e%n,this.buffer=Array(n*this.samples).fill(void 0)},tW=function(e,t){return{loops:e.map(function(e){var n=e.end,r=e.start,i=t[e.fragmentId],a=i.notes,o=i.loop,c=o[0],s=new tG(r,n,o[1]-c);return a.forEach(function(e){var t=e.at-c;if(!(t<0)){var n=ea(e.id);s.startKey(t,n),s.endKey(t+e.length-1,n)}}),s}),size:Math.max.apply(Math,e.map(function(e){return e.end}))}},tK=function(){function e(e,t){var n,r=this;this.tracks=e,this.sampleRate=t,this.size=(n=this.tracks,Math.max.apply(Math,n.map(function(e){return e.size}))),this.get=function(e){return r.tracks[e]},this.set=function(e){var t=e.tracks,n=e.midiFragments,i=e.presets;r.tracks=t.map(function(e,t){var a=e.midi,o=e.presetId,c=e.gain,s=new tU(new tq(r.sampleRate),i[o]);return s.setNoteLoops(tW(a,n)),s.setGain(c),s}),r.refresh()},this.nextActions=function(e,t){for(var n=0,i=r.tracks;n<i.length;n++)i[n].nextActions(e,t)},this.next=function(){for(var e=0,t=0,n=r.tracks;t<n.length;t++)e+=n[t].next();return e},this.clear=function(){for(var e=0,t=r.tracks;e<t.length;e++)t[e].clear()},this.isDone=function(e){return e>=r.size},this.setGain=function(e,t){r.tracks[e].setGain(t)},this.setMidi=function(e,t,n){var i=tW(t,n);r.tracks[e].setNoteLoops(i),r.refresh()},this.setPreset=function(e,t){return r.get(e).setPreset(t)},this.refresh()}return e.prototype.refresh=function(){this.size=Math.max.apply(Math,this.tracks.map(function(e){return e.size}))},e}(),tH=function(){function e(){var e=this;this.sampleRate=44100,this.events=new tC,this.tracks=new tK([],this.sampleRate),this.player=new tO(this.events,this.tracks,this.sampleRate),this.addEventListener=this.events.addEventListener,this.play=this.player.play,this.pause=this.player.pause,this.stop=this.player.stop,this.setBPM=this.player.setBPM,this.setTime=this.player.setTime,this.setGain=this.tracks.setGain,this.setMidi=this.tracks.setMidi,this.setTracks=this.tracks.set,this.setPreset=this.tracks.setPreset,this.startNote=function(t,n){return e.tracks.get(t).startNote(n)},this.endNote=function(t,n){return e.tracks.get(t).endNote(n)},this.closeContext=tM(this.player)}return e.prototype.destroy=function(){this.tracks.clear(),this.closeContext()},e}(),tY=function(e){var t=(0,o.useState)({reducer:function(e,t){return e}}),n=t[0],r=t[1],i=function(e){return l({type:"REFRESH_IS_PLAYING",payload:e})},a=function(e){return l({type:"REFRESH_TIME",payload:e})};(0,o.useEffect)(function(){var t=new tH;return t.setTracks(s),t.setBPM(s.bpm),t.addEventListener("isPlayingChanged",i),t.addEventListener("timeChanged",a),r({reducer:e(t)}),function(){return t.destroy()}},[e]);var c=(0,o.useReducer)(n.reducer,d()),s=c[0],l=c[1];return[s,l]},tV=function(){return(tV=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},tQ=function(e,t,n){var r,i=t.midiFragments;return{midiFragments:tV(tV({},i),((r={})[e]=tV(tV({},i[e]),n),r))}},tX=function(e,t,n){return{tracks:t.tracks.map(function(t,r){return e===r?tV(tV({},t),n(t)):t})}},tZ=function(e,t,n){var r,i=t.presets;return{presets:tV(tV({},i),((r={})[e]=tV(tV({},i[e]),n(i[e])),r))}},tJ=function(){return(tJ=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},t$=function(e,t,n){if(n||2==arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},t0=function(e,t){var n,r=e.currentTrack,i=e.tracks,a=e.notes,o=i[r].presetId;switch(t.type){case"SET_CURRENT_TRACK":return{currentTrack:t.payload};case"SET_CURRENT_FRAGMENT":return{currentFragment:t.payload};case"SET_BPM":return{bpm:t.payload};case"SET_SEQUENCE":return tZ(o,e,function(){return{sequence:t.payload}});case"TOGGLE_PANEL":return tZ(o,e,function(e){var n;return"wave"===t.id?{}:((n={})[t.id]=tJ(tJ({},e[t.id]),{enabled:!e[t.id].enabled}),n)});case"SET_TRACK_MIDI":return n=function(e,n){return{midi:e.midi.map(function(e,r){var i=eI([n,r]),a=t.payload.get(i);return a?tJ(tJ({},e),a):e})}},{tracks:e.tracks.map(function(e,t){return tV(tV({},e),n(e,t))})};case"SET_MIDI_FRAGMENT":return tQ(t.id,e,t.payload);case"SET_GAIN":return tX(t.id,e,function(){return{gain:t.payload}});case"SET_ENVELOPE":return tZ(o,e,function(e){var n,r=e.envelopes;return{envelopes:tJ(tJ({},r),((n={})[t.id]=tJ(tJ({},r[t.id]),t.payload),n))}});case"SET_WAVE":return tZ(o,e,function(e){var n,r=e.wave;return{wave:tJ(tJ({},r),((n={})[t.id]=t.payload,n))}});case"SET_FILTER":return tZ(o,e,function(e){var n,r=e.filter;return{filter:tJ(tJ({},r),((n={})[t.id]=t.payload,n))}});case"SET_PRESET":return tX(r,e,function(){return{presetId:t.payload}});case"REFRESH_TIME":return{time:t.payload};case"REFRESH_IS_PLAYING":return{isPlaying:t.payload};case"KEY_DOWN":return{notes:t$(t$([],a,!0),[t.payload],!1)};case"KEY_UP":return{notes:[t.payload].filter(function(e){return e!==t.payload})};default:return}},t1=function(e,t,n){var r=e.tracks,i=e.midiFragments,a=e.currentTrack,o=e.presets[r[a].presetId];switch(n.type){case"PLAY":return t.play();case"PAUSE":case"STOP":return t.pause();case"KEY_UP":return t.endNote(a,n.payload);case"KEY_DOWN":return t.startNote(a,n.payload);case"SET_TIME":return t.setTime(n.payload);case"SET_MIDI_FRAGMENT":case"SET_TRACK_MIDI":return r.forEach(function(e,n){var r=e.midi;return t.setMidi(n,r,i)});case"SET_CURRENT_TRACK":return;case"SET_GAIN":return t.setGain(n.id,n.payload);case"SET_BPM":return t.setBPM(n.payload);case"SET_SEQUENCE":case"TOGGLE_PANEL":case"SET_ENVELOPE":case"SET_WAVE":case"SET_FILTER":case"SET_PRESET":return t.setPreset(a,o)}},t2=function(e){return function(t,n){var r=t0(t,n),i=r?tJ(tJ({},t),r):t;return t1(i,e,n),i}};let t5=function(){var e=tY(t2),t=e[0],n=e[1];return o.createElement(f.Provider,{value:[t,n]},o.createElement(tw,null))},t4=()=>(0,a.jsx)("div",{children:(0,a.jsx)(t5,{})});function t3(){return(0,a.jsx)(t4,{})}},6721:(e,t,n)=>{"use strict";n.d(t,{BS:()=>s,UT:()=>a,wu:()=>c});var r=n(4041),i=r.createContext({toPoint:function(){return{x:0,y:0}},width:0,height:0,left:0,top:0}),a=function(){return r.useContext(i)},o=function(){return{x:0,y:0}},c=function(){return r.useContext(i).toPoint},s=function(e){var t,n=e.width,a=e.height,c=e.style,s=e.children,l=e.paddingLeft,u=void 0===l?0:l,d=e.paddingTop,f=void 0===d?0:d,h=e.zoom,p=void 0===h?1:h,v=r.useState(!1)[1],m=r.useRef(null);r.useEffect(function(){return v(!0)},[]);var y=n+u,g=f+a;return r.createElement("svg",{width:y*p,height:g*p,style:c,ref:m,viewBox:[-u,-f,y,g].join(" ")},r.createElement(i.Provider,{value:{left:u,top:f,width:n,height:a,toPoint:m.current?(t=m.current,function(e){var n,r=e.clientX,i=e.clientY,a=t.createSVGPoint();return a.x=r,a.y=i,a.matrixTransform(null===(n=t.getScreenCTM())||void 0===n?void 0:n.inverse())}):o}},s))}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(9865)),_N_E=e.O()}]);